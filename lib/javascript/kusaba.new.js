"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},style_cookie,style_cookie_txt,style_cookie_site,kumod_set=!1,ispage,is_entering=!1,_messages={en:{noLocalStorage:"Your browser does not support LocalStorage",oops:"Something went wrong...",blankResponse:"blank response",watchlistAdd:"\u0422\u0440\u0435\u0434 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u044B\u0445.",expandingThread:"Expanding thread...",newThread:"new thread",NewThread:"New thread",replyTo:"reply to",cancel:"Cancel",update:"Update",updatingCounts:"Updating...",couldntFetch:"Cold not fetch this post",noNewPosts:"No new posts",replies:"Replies",settings_fxEnabled:"Animation effects",settings_showReplies:"Show replies inside posts",settings_sfwMode:"NSFW mode",settings_expandImgFull:"Expand images to full size",settings_constrainWidth:"Constrain content width",delete:"Delete post",deleteAndBan:"Delete post and ban poster",enterCaptcha:"Please enter captcha.",selectText:"Select some text",dcls:"Double click to show source",watchOn:"Watch on",captcharot:"Captcha has rotted",threadUpdationAutomatically:"Tread is being updated automatically.",stopFuckingDolls:"<b>\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u0435 AJAX-\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0443 \u043F\u043E\u0441\u0442\u043E\u0432 \u0438 AJAX-\u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u0440\u0435\u0434\u0430.</b><br />(\u041A\u043B\u0438\u043A\u043D\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u0440\u044B\u0442\u044C)",del:"Delete",delandban:"Delete and ban",ban:"Ban",stickthread:"Stick thread",unstickthread:"Unstick thread",lockthread:"Lock thread",unlockthread:"Unlock thread",returnDesktop:"Switch to desktop interface",returnTouch:"Switch to touch interface",forceDesktop:"Force Desktop interface",okay:"Okay",captchalang:"Captcha language",reply:"Reply",imageDownscaledBy:"Image was downscaled by",videoDownscaledBy:"Video was downscaled by",toFit:"to feet screen",newReplies:"New replies",newThreadsAvailable:"New threads available.",loading:"Loading",anonymous:"Anonymous",sortBy:"Sort by",bumpOrder:"Bump order",lastReply:"Last reply",creationDate:"Creation date",replyCount:"Reply count",doStick:"Respect stickied",showHidden:"Show hidden",doNotStick:"Ignore stickied",hideHidden:"Hide hidden",search:"Search",threadOnPage:"Thread is on page",goToThread:"Go to thread",smallPics:"Small pictures",largePics:"Large pictures",legacyMode:"Legacy mode",threads:"Threads",comments:"Replies",active_since:"Active since",last_active:"Last seen",active_on:"Active on",tryAgain:"Try again",xhrError:"XHR error",details:"details",post:"Post",posts:"Posts",deleted:"has been deleted",deletedMulti:"have been deleted",reported:"has been reported",reportedMulti:"have been reported",fileRemoved:"File<br>removed.",file:"File",collapse:"Collapse",deleteAsMod:"Delete as Mod",deleteAsModVerbose:"If the password does not match, delete posts using Moderator privelege"},ru:{noLocalStorage:"localStorage \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043E\u043C",oops:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A...",blankResponse:"\u043F\u0443\u0441\u0442\u043E\u0439 \u043E\u0442\u0432\u0435\u0442",watchlistAdd:"\u0422\u0440\u0435\u0434 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u044B\u0445.",watchlistRemove:"\u0422\u0440\u0435\u0434 \u0443\u0434\u0430\u043B\u0435\u043D \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u044B\u0445.",expandingThread:"\u0420\u0430\u0437\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u043C \u0442\u0440\u0435\u0434...",newThread:"\u043D\u043E\u0432\u044B\u0439 \u0442\u0440\u0435\u0434",NewThread:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0442\u0440\u0435\u0434",replyTo:"\u043E\u0442\u0432\u0435\u0442 \u043D\u0430",cancel:"\u041E\u0442\u043C\u0435\u043D\u0430",update:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C",updatingCounts:"\u0418\u0449\u0435\u043C \u043D\u043E\u0432\u044B\u0435 \u043F\u043E\u0441\u0442\u044B...",couldntFetch:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u043F\u043E\u0441\u0442",noNewPosts:"\u041D\u0435\u0442 \u043D\u043E\u0432\u044B\u0445 \u043F\u043E\u0441\u0442\u043E\u0432",replies:"\u041E\u0442\u0432\u0435\u0442\u044B",settings_fxEnabled:"\u0410\u043D\u0438\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u044D\u0444\u0444\u0435\u043A\u0442\u044B",settings_showReplies:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442\u044B \u0432\u043D\u0443\u0442\u0440\u0438 \u043F\u043E\u0441\u0442\u0430",settings_sfwMode:"\u041C\u0430\u043C\u043A\u0430 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",settings_expandImgFull:"\u0420\u0430\u0437\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438 \u0434\u043E \u0438\u0441\u0445\u043E\u0434\u043D\u043E\u0433\u043E \u0440\u0430\u0437\u043C\u0435\u0440\u0430",settings_constrainWidth:"\u041E\u0433\u0440\u0430\u043D\u0438\u0447\u0438\u0432\u0430\u0442\u044C \u0448\u0438\u0440\u0438\u043D\u0443 \u043A\u043E\u043D\u0442\u0435\u043D\u0442\u0430",delete:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u0441\u0442",deleteAndBan:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u0441\u0442 \u0438 \u0437\u0430\u0431\u0430\u043D\u0438\u0442\u044C \u043F\u043E\u0441\u0442\u0435\u0440\u0430",enterCaptcha:"\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u0430\u043F\u0447\u0443.",selectText:"\u0422\u0435\u043A\u0441\u0442 \u043D\u0435 \u0432\u044B\u0434\u0435\u043B\u0435\u043D",dcls:"Double click to show source",watchOn:"\u0421\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u043D\u0430",odc:"javascript:LatexIT.replaceWithSrc(this);",captcharot:"\u041A\u0430\u043F\u0447\u0430 \u043F\u0440\u043E\u0442\u0443\u0445\u043B\u0430",threadUpdationAutomatically:"\u0422\u0440\u0435\u0434 \u043E\u0431\u043D\u043E\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438",stopFuckingDolls:"<b>\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u0435 AJAX-\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0443 \u043F\u043E\u0441\u0442\u043E\u0432 \u0438 AJAX-\u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u0440\u0435\u0434\u0430.</b><br />(\u041A\u043B\u0438\u043A\u043D\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u0440\u044B\u0442\u044C)",del:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",delandban:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438 \u0437\u0430\u0431\u0430\u043D\u0438\u0442\u044C",ban:"\u0417\u0430\u0431\u0430\u043D\u0438\u0442\u044C",stickthread:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0442\u0440\u0435\u0434",unstickthread:"\u041E\u0442\u043B\u0435\u043F\u0438\u0442\u044C \u0442\u0440\u0435\u0434",lockthread:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u0442\u0440\u0435\u0434",unlockthread:"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0442\u0440\u0435\u0434",returnDesktop:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C\u0441\u044F \u043D\u0430 \u0434\u0435\u0441\u043A\u0442\u043E\u043F\u043D\u044B\u0439 \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",returnTouch:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C\u0441\u044F \u043D\u0430 \u0442\u0430\u0447-\u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",forceDesktop:"Force Desktop interface",okay:"\u042F\u0441\u043D\u043E",captchalang:"\u042F\u0437\u044B\u043A \u043A\u0430\u043F\u0447\u0438",reply:"\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C",imageDownscaledBy:"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u0443\u0436\u0430\u0442\u0430 \u043D\u0430",videoDownscaledBy:"\u0412\u0438\u0434\u0435\u043E \u0443\u0436\u0430\u0442\u043E \u043D\u0430",toFit:"\u043F\u043E \u0440\u0430\u0437\u043C\u0435\u0440\u0443 \u043E\u043A\u043D\u0430",newReplies:"\u041D\u043E\u0432\u044B\u0445 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",newThreadsAvailable:"\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043D\u043E\u0432\u044B\u0435 \u0442\u0440\u0435\u0434\u044B.",loading:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C",anonymous:"\u0410\u043D\u043E\u043D\u0438\u043C",sortBy:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E",bumpOrder:"\u0431\u0430\u043C\u043F\u0430\u043C",lastReply:"\u0434\u0430\u0442\u0435 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",creationDate:"\u0434\u0430\u0442\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F",replyCount:"\u0447\u0438\u0441\u043B\u0443 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",doStick:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u044F\u0442\u044C",showHidden:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0441\u043A\u0440\u044B\u0442\u044B\u0435",doNotStick:"\u041D\u0435 \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u044F\u0442\u044C",hideHidden:"\u0421\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0441\u043A\u0440\u044B\u0442\u044B\u0435",search:"\u041F\u043E\u0438\u0441\u043A",threadOnPage:"\u0422\u0440\u0435\u0434 \u0440\u0430\u0441\u043F\u043E\u043B\u0430\u0433\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435",goToThread:"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0442\u0440\u0435\u0434",smallPics:"\u041C\u0435\u043B\u043A\u0438\u0435 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438",largePics:"\u0411\u043E\u043B\u044C\u0448\u0438\u0435 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438",legacyMode:"\u041E\u043B\u0434\u0444\u0430\u0436\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C",threads:"\u0422\u0440\u0435\u0434\u043E\u0432",comments:"\u041E\u0442\u0432\u0435\u0442\u043E\u0432",active_since:"\u041F\u0440\u0438\u0441\u043E\u0435\u0434\u0438\u043D\u0438\u043B\u0441\u044F",last_active:"\u0411\u044B\u043B \u0430\u043A\u0442\u0438\u0432\u0435\u043D",active_on:"\u0410\u043A\u0442\u0438\u0432\u0435\u043D \u043D\u0430",tryAgain:"\u041F\u043E\u043F\u0440\u043E\u0431\u043E\u0432\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430",xhrError:"\u041E\u0448\u0438\u0431\u043A\u0430 XHR",details:"\u043F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438",post:"\u041F\u043E\u0441\u0442",posts:"\u041F\u043E\u0441\u0442\u044B",deleted:"\u0443\u0434\u0430\u043B\u0435\u043D",deletedMulti:"\u0443\u0434\u0430\u043B\u0435\u043D\u044B",reported:": \u0436\u0430\u043B\u043E\u0431\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430",reportedMulti:": \u0436\u0430\u043B\u043E\u0431\u044B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u044B",fileRemoved:"\u0424\u0430\u0439\u043B<br>\u0443\u0434\u0430\u043B\u0435\u043D.",file:"\u0424\u0430\u0439\u043B",collapse:"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C",deleteAsMod:"\u0423\u0434\u0430\u043B\u044F\u0442\u044C \u043E\u0442 \u043B\u0438\u0446\u0430 \u043C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440\u0430",deleteAsModVerbose:"\u0415\u0441\u043B\u0438 \u043F\u0430\u0440\u043E\u043B\u044C \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u0435\u0442, \u0443\u0434\u0430\u043B\u044F\u0442\u044C \u0447\u0443\u0436\u0438\u0435 \u043F\u043E\u0441\u0442\u044B \u0441 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u0435\u043C \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u0438\u0432\u043D\u044B\u0445 \u043F\u0440\u0438\u0432\u0435\u043B\u0435\u0433\u0438\u0439"}},_l="undefined"!=typeof locale&&_messages.hasOwnProperty(locale)?_messages[locale]:_messages.ru;function trace(){if(console.log){var t=arguments.callee.caller,o=arguments[0];for(""==o&&(o+="trace()");null!=t;){var d=/function ([^\(]+)/,l=d.exec(t.toString());l=null==l?"":l[1];for(var p=[],u=0;u<t.arguments.length;u++)p.push(t.arguments[u]);l+="("+p.join(", ")+")",o+=" <- "+l,t=t.caller}console.log(o)}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var o=this.length,d=+arguments[1]||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=o);d<o;d++)if(d in this&&this[d]===t)return d;return-1});var Utf8={encode:function encode(t){t=t.replace(/\r\n/g,"\n");for(var l,o="",d=0;d<t.length;d++)l=t.charCodeAt(d),128>l?o+=String.fromCharCode(l):127<l&&2048>l?(o+=String.fromCharCode(192|l>>6),o+=String.fromCharCode(128|63&l)):(o+=String.fromCharCode(224|l>>12),o+=String.fromCharCode(128|63&l>>6),o+=String.fromCharCode(128|63&l));return o},decode:function decode(t){for(var o="",d=0,l=0,u=0,y=0;d<t.length;)l=t.charCodeAt(d),128>l?(o+=String.fromCharCode(l),d++):191<l&&224>l?(u=t.charCodeAt(d+1),o+=String.fromCharCode((31&l)<<6|63&u),d+=2):(u=t.charCodeAt(d+1),y=t.charCodeAt(d+2),o+=String.fromCharCode((15&l)<<12|(63&u)<<6|63&y),d+=3);return o}};function Cookie(t){if(1==arguments.length){var o=new RegExp("(^|;\\s+)"+t+"=(.*?)(;|$)"),d=o.exec(document.cookie);return d&&2<d.length?Utf8.decode(unescape(replaceAll(d[2],"+","%20"))):""}var l=arguments[1],p=arguments[2],u="";if(p){var y=new Date;y.setTime(y.getTime()+1e3*(60*(60*(24*p)))),u="; expires="+y.toGMTString()}document.cookie=t+"="+l+u+"; path=/"}function replaceAll(t,o,d){for(var l=t.indexOf(o);-1<l;)t=t.replace(o,d),l=t.indexOf(o);return t}function insert(t){var o=($("#postclone").length&&"none"!==$("#postclone").css("display")?$("#postclone"):$("#postform")).find("textarea")[0];if(o){if(o.createTextRange&&o.caretPos){var d=o.caretPos;d.text=" "==d.text.charAt(d.text.length-1)?t+" ":t}else if(o.setSelectionRange){var l=o.selectionStart,p=o.selectionEnd;o.value=o.value.substr(0,l)+t+o.value.substr(p),o.setSelectionRange(l+t.length,l+t.length)}else o.value+=t+" ";o.focus()}return"none"===$("#postclone").css("display")&&void 0}function markup(t,o,d,l,p){var u=t.find("textarea").get(0);if(u.selectionStart||"0"==u.selectionStart){u.focus();var y=u.selectionStart,k=u.selectionEnd,T=u.value.substring(y,k);-1===T.indexOf("\n")&&"undefined"!=typeof l&&"undefined"!=typeof p&&(o=l,d=p),u.value=u.value.substring(0,y)+o+u.value.substring(y,k)+d+u.value.substring(k,u.value.length)}else u.value+=o+d}function bullets(t,o,d,l){var p=t.find("textarea"),u=p.get(0),y=u.selectionStart,k=u.selectionEnd,T=p.val().substring(y,k);if(-1===T.indexOf("\n")&&"undefined"!=typeof d&&"undefined"!=typeof l)u.value=u.value.substring(0,y)+d+u.value.substring(y,k)+l+u.value.substring(k,u.value.length);else{T=p.val().substring(y,k).split("\n");for(var S="",M=0;M<T.length;M++)S+=o+T[M],M<T.length-1&&(S+="\n");p.val(p.val().substring(0,y)+S+p.val().substring(k))}}function quote(b,a){var v=eval("document."+a+".message");v.value+=">>"+b+"\n",v.focus()}function checkhighlight(){var t;(t=/#i([0-9]+)/.exec(document.location.toString()))&&!$("#postform textarea").val()&&insert(">>"+t[1]),(t=/#([0-9]+)/.exec(document.location.toString()))&&highlight(t[1])}function highlight(t){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;$(".highlight").removeClass("highlight");var d=$("#delform a[name=\""+t+"\"]").parents(".reply, .op"),l=d[0];if(!l)return"not-found";d.addClass("highlight"),o&&setTimeout(function(){return d.removeClass("highlight")},o);var p=l.getBoundingClientRect(),u=document.documentElement.clientHeight;if(p.bottom>u||0>p.top){var y=p.top+document.documentElement.scrollTop,k=u-p.height;window.scrollTo(0,y-(k?Math.ceil(k/2):0))}}function get_password(t){var o=getCookie(t);if(o)return o;var d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";o="";for(var p,l=0;8>l;l++)p=Math.floor(Math.random()*d.length),o+=d.substring(p,p+1);return Cookie(t,o,365),o}function togglePassword(){var t=$("#passwordbox").html().toLowerCase(),o="<td></td><td></td>";return t==o&&(o="<td class=\"postblock\">Mod</td><td><input type=\"text\" name=\"modpassword\" size=\"28\" maxlength=\"75\">&nbsp;<acronym title=\"Display staff status (Mod/Admin)\">D</acronym>:&nbsp;<input type=\"checkbox\" name=\"displaystaffstatus\" checked>&nbsp;<acronym title=\"Lock\">L</acronym>:&nbsp;<input type=\"checkbox\" name=\"lockonpost\">&nbsp;&nbsp;<acronym title=\"Sticky\">S</acronym>:&nbsp;<input type=\"checkbox\" name=\"stickyonpost\">&nbsp;&nbsp;<acronym title=\"Raw HTML\">RH</acronym>:&nbsp;<input type=\"checkbox\" name=\"rawhtml\">&nbsp;&nbsp;<acronym title=\"Name\">N</acronym>:&nbsp;<input type=\"checkbox\" name=\"usestaffname\"></td>"),$("#passwordbox").html(o).show(),!1}function toggleOptions(){trace("deprecated!")}function getCookie(t){return Cookie(t)}function set_cookie(t,o,d){return Cookie(t,o,d)}var Styles={all:[],titles:[],init:function init(){_.each(document.getElementsByTagName("link"),function(o){-1!=o.getAttribute("rel").indexOf("style")&&o.getAttribute("title")&&(this.all.push(o),this.titles.push(o.getAttribute("title")),-1===o.getAttribute("rel").indexOf("alternate")&&(this._default=o.getAttribute("title")),o.hasAttribute("data-custom")&&(this.custom=o.getAttribute("title")))},this),this.current=this._default;var t=getCookie("bypasscustom");this.customBypass=t.length&&"undefined"!=typeof this_board_dir&&in_array(this_board_dir,t.split("|")),this.initiated=!0},decide:function decide(){this.init();var t=localStorage["testing-css"]||null;if(t){var o=this.addStyle(t);this.setStyle(o);var d=$("<a href=\"#\">\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0442\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 "+o+".css</a>");return d.click(function(p){p.preventDefault(),Styles.quitTest(),$(this).parent().slideUp()}),void(this.$cancelLink=$("<div style=\"font-weight: bold\"></div>").append(d))}if(this.hasOwnProperty("custom")&&!this.customBypass)return this.setCustom();var l=getCookie(style_cookie);l&&in_array(l,this.titles)?this.setStyle(l):(this.setDefault(),set_cookie("kustyle_site",this._default,365),set_cookie("kustyle",this._default,365))},change:function change(t){in_array(t,this.titles)&&this.current!==t&&(this.setStyle(t),this.hasOwnProperty("custom")&&this.custom===t?this.removeBypass():(this.hasOwnProperty("custom")&&this.addBypass(),set_cookie("kustyle_site",t,365),set_cookie("kustyle",t,365)))},removeBypass:function removeBypass(){if(this.customBypass&&"undefined"!=typeof this_board_dir){this.customBypass=!1;var t=getCookie("bypasscustom").split("|"),o=[];_.each(t,function(d){d!==this_board_dir&&o.push(d)}),o=o.length?o.join("|"):"",set_cookie("bypasscustom",o,365)}},addBypass:function addBypass(){if(!(this.customBypass||"undefined"==typeof this_board_dir)){this.customBypass=!0;var t=getCookie("bypasscustom").split("|");in_array(this_board_dir,t)||(t.push(this_board_dir),set_cookie("bypasscustom",t.join("|"),365))}},setDefault:function setDefault(){this.hasOwnProperty("_default")&&this.current!==this._default&&this.setStyle(this._default)},setCustom:function setCustom(){this.hasOwnProperty("custom")&&this.setStyle(this.custom)},setStyle:function setStyle(t){in_array(t,this.titles)&&(scrollAnchor&&scrollAnchor.save&&scrollAnchor.save("setstyle",".postnode",window,"v"),_.each(this.all,function(o){o.disabled=!0,o.getAttribute("title")===t&&(o.disabled=!1)}),scrollAnchor&&scrollAnchor.restore&&scrollAnchor.restore("setstyle"),this.current=t)},onTest:null,addStyle:function addStyle(t){var o=/(?:.+\/)?(.+)\.css/i.exec(t);if(o){var d=_.capitalize(_.escape(o[1]));if(!in_array(d,this.titles)){var l=$("<link rel=\"stylesheet\" type=\"text/css\" href=\""+t+"\" title=\""+d+"\" disabled>");$("head").append(l),this.titles.push(d),this.all.push(l[0])}return d}},testStyle:function testStyle(t){this.onTest=t;var o=this.addStyle(t);this.setStyle(o),popupMessage("\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u0441\u0442\u0438\u043B\u044C "+o+".","none");var d=$("<button>OK</button>").click(this.confirmLongTermTest.bind(this)),l=$("<button>"+_l.cancel+"</button>").click(this.quitTest.bind(this)),p=$("<div class=\"pmsg-form\"></div>").append(d,l);$("#popupMessage").append(p)},confirmLongTermTest:function confirmLongTermTest(){this.onTest&&localStorage.setItem("testing-css",this.onTest)},quitTest:function quitTest(){localStorage.removeItem("testing-css"),this.decide()}};style_cookie&&Styles.decide();function moddelcheckbox(){$(".userdelete").append("<label for=\"delasmod\" title=\""+_l.deleteAsModVerbose+"\"><input"+(+localStorage.deleteasmod?" checked":"")+" id=\"delasmod\" type=\"checkbox\" name=\"moddelete\" val=\"1\">&nbsp;"+_l.deleteAsMod+"</label>"),$("#delasmod").change(function(){var t=$(this).is(":checked");localStorage.deleteasmod=+t})}function delandbanlinks(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:$("body");t.find("span[id^=dnb]").each(function(){var l=$(this).attr("id").split("-"),p="\n      <a href=\""+ku_cgipath+"/manage_page.php?action=bans&amp;banboard="+l[1]+"&amp;banpost="+l[2]+"\" title=\""+_l.ban+"\">\n        <svg class=\"icon b-icon\">\n          <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-ban\"></use>\n        </svg>\n      </a>\n    ";"y"==l[3]&&(p+="\n        <a class=\"stickypost-btn\" onclick=\"Ajax.modThread(this, 'stickypost'); return false\" \n        href=\""+ku_cgipath+"/manage_page.php?action=stickypost&amp;board="+l[1]+"&amp;postid="+l[2]+"\" title=\""+_l.stickthread+"\">\n          <svg class=\"icon b-icon\">\n            <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-pin\"></use>\n          </svg>\n        </a>\n        <a class=\"unstickypost-btn\" onclick=\"Ajax.modThread(this, 'unstickypost'); return false\" \n        href=\""+ku_cgipath+"/manage_page.php?action=unstickypost&amp;board="+l[1]+"&amp;postid="+l[2]+"\" title=\""+_l.unstickthread+"\">\n          <svg class=\"icon b-icon\">\n            <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-unpin\"></use>\n          </svg>\n        </a>\n        <a class=\"lockpost-btn\" onclick=\"Ajax.modThread(this, 'lockpost'); return false\" \n        href=\""+ku_cgipath+"/manage_page.php?action=lockpost&amp;board="+l[1]+"&amp;postid="+l[2]+"\" title=\""+_l.lockthread+"\">\n          <svg class=\"icon b-icon\">\n            <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-lock\"></use>\n          </svg>\n        </a>\n        <a class=\"unlockpost-btn\" onclick=\"Ajax.modThread(this, 'unlockpost'); return false\" \n        href=\""+ku_cgipath+"/manage_page.php?action=unlockpost&amp;board="+l[1]+"&amp;postid="+l[2]+"\" title=\""+_l.unlockthread+"\">\n          <svg class=\"icon b-icon\">\n            <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-unlock\"></use>\n          </svg>\n        </a>\n      "),$(this).html(p)})}var HiddenThreads={list:function list(){if(null==localStorage)return trace(_l.noLocalStorage),[];var t=localStorage.getItem("hiddenThreads."+this_board_dir);return null==t?[]:t.split(",")},isHidden:function isHidden(t){return-1!=HiddenThreads.list().indexOf(t)},hide:function hide(t){if(null==localStorage)alert(_l.noLocalStorage);else{var o=HiddenThreads.list();o.push(t.toString()),localStorage.setItem("hiddenThreads."+this_board_dir,o.join(","))}},unhide:function unhide(t){if(null==localStorage)alert(_l.noLocalStorage);else{var o=HiddenThreads.list(),d=o.indexOf(t.toString());if(-1==d)return;var l=o.slice(0,d);l=l.concat(o.slice(d+1)),localStorage.setItem("hiddenThreads."+this_board_dir,l.join(","))}}};function togglethread(t){return HiddenThreads.isHidden(t)?($("#unhidethread"+t+this_board_dir).slideUp(),$("#thread"+t+this_board_dir).slideDown(),HiddenThreads.unhide(t)):($("#unhidethread"+t+this_board_dir).slideDown(),$("#thread"+t+this_board_dir).slideUp(),HiddenThreads.hide(t)),!1}function toggleblotter(){$(".blotter-entries").each(function(){$(this).slideToggle(function(){$(this).is(":hidden")?Cookie("ku_showblotter","0",365):Cookie("ku_showblotter","1",365)})})}function hideblotter(){$(".blotter-entries").each(function(){$(this).hide()})}function expandthread(t,o,d){d.preventDefault();var l=$("#thread"+t+o);return l.length&&function(){var p=+l.find(".postnode.op").find("input[type=checkbox]").val(),u=+l.find(".postnode:not(.op):first").find("input[type=checkbox]").val(),y=l.find(".omittedposts");y.find("a").hide();var k=y.find("span");k.length||(k=$("<span></span>").prependTo(y)),k.text(_l.loading+"..."),HTMLoader.getThread(o,+t,[p,u],function(T,S){S?(l.find(".omittedposts").replaceWith(S),replyMap.showReplies()):(k.text(_l.oops+(!1===T?"":" ("+T+")")),y.find("a").text(_l.tryAgain).show())})}(),!1}function getnewposts(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){return"error"};if(null===t){if(ispage)return d();t=$("input[name=replythread]").val()}var l=$(".qrl[data-parent=\""+t+"\"]").last(),p=l.data("postnum")||l.data("parent");if(!p)return d();var u,y;if(!ispage)y=$("#newposts_get"),y.removeClass("upd-counting").addClass("upd-updating"),u=document.querySelector(".replies");else if(u=document.querySelector("#thread"+t+this_board_dir+" .replies"),!u)return d();return HTMLoader.getThread(this_board_dir,+t,[+p,Infinity],function(T,S){if(ispage||y.removeClass("upd-updating"),S){if(u.insertAdjacentHTML("beforeend",S),o){var M=u.querySelectorAll(".reply"),E="last"==o?M[M.length-1]:Array.prototype.find.call(M,function(L){return L.querySelector("a[name=\""+o+"\"]")});if(!E)return d();highlight(o,5e3)}replyMap.showReplies()}else{if(o)return d();popupMessage(""===S?_l.noNewPosts:_l.oops+(!1===T?"":" ("+T+")"))}},!1,!0),!1}function showLinks(){var o=$(this).attr("href");return $("#directLink").val(ku_boardspath+o),$("#quoteLink").val(">>"+o.split("/res/")[0]+"/"+o.split("#")[1]),$("#viewlink").css({top:$(this).offset().top+$(this).height(),left:$(this).offset().left}).fadeIn("fast"),!1}"pinned"===localStorage.pinPreference&&(localStorage.pinForm=0),"unpinned"===localStorage.pinPreference&&(localStorage.pinForm=1),localStorage.removeItem("pinPreference");var goingExternal=!1;function quickreply(){var o=$(this).data("boardname");o===this_board_dir&&(o=!1);var d=$(this).data("parent"),l=$(this).data("postnum")||d,p=!!+localStorage.pinForm,u="none"===$("#postclone").css("display");return $("#postclone").show(),isTouch?$("#postclone").css({bottom:"0px",left:"0px",position:"fixed",opacity:1}):p?$("#postclone").css({top:$(this).offset().top+$(this).height(),left:Math.round($(window).width()/2-$("#postclone").width()/2),position:"absolute"}):u&&$("#postclone").css({top:$(this).offset().top+$(this).height()-$(document).scrollTop(),left:Math.round($(window).width()/2-$("#postclone").width()/2),position:"fixed"}),$("#postclone input[name=\"replythread\"]").val(d),o?($("#postclone input[name=\"board\"]").val(o),$("#postclone .posttypeindicator").html("<a href=\""+ku_boardspath+"/"+o+"/res/"+d+".html?i#"+l+"\"> &gt;&gt;/"+o+"/"+d+"</a>")):$("#postclone .posttypeindicator").html("<a class=\"xlink\" href=\"#"+l+"\"> &gt;&gt;"+d+"</a>"),insert(">>"+l+"\n"),!1}function getwatchedthreads(t,o){""!=$("#watchedthreadlist").get()&&($("#watchedthreadlist").html(_l.loading+"..."),$.ajax({url:ku_boardspath+"/threadwatch.php?board="+o+"&threadid="+t,success:function success(d){$("#watchedthreadlist").html(d||_l.oops+" ("+_l.blankResponse+")")},error:function error(d,l){$("#watchedthreadlist").html(_l.oops+" ("+l+")")}}))}function popupMessage(t){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;""==$("#popupMessage").get()&&($("body").children().last().after("<div id=\"popupMessage\" class=\"reply postername\"></div>"),$("#popupMessage").hide()),$("#popupMessage").html(t.trim()).fadeIn(150),"none"===o?$("#popupMessage").click(function(){$(this).fadeOut(300)}):$("#popupMessage").delay(o).fadeOut(300)}function addtowatchedthreads(t,o){""!=$("#watchedthreadlist").get()&&$.ajax({url:ku_boardspath+"/threadwatch.php?do=addthread&board="+o+"&threadid="+t,success:function success(){popupMessage(_l.watchlistAdd),getwatchedthreads("0",o)},error:function error(d,l){popupMessage(_l.oops+" ("+l+")")}})}function removefromwatchedthreads(t,o){""!=$("#watchedthreadlist").get()&&$.ajax({url:ku_boardspath+"/threadwatch.php?do=removethread&board="+o+"&threadid="+t,success:function success(){popupMessage(_l.watchlistRemove),getwatchedthreads("0",o)},error:function error(d,l){popupMessage(_l.oops+" ("+l+")")}})}function hidewatchedthreads(){Cookie("showwatchedthreads","0",30),$("#watchedthreads").fadeOut()}function showwatchedthreads(){Cookie("showwatchedthreads","1",30),window.location.reload(!0)}var Captcha={init:function init(){$(".captchawrap").click(this.refresh.bind(this)),injector.inject("captcha-rotting",".cw-running .rotting-indicator {\n  -webkit-animation-duration: "+captchaTimeout+"s;\n       -o-animation-duration: "+captchaTimeout+"s;\n          animation-duration: "+captchaTimeout+"s;\n}\n.cw-running .captchaimage, \n.cw-running .rotten-msg {\n  -webkit-animation-delay: "+captchaTimeout+"s;\n       -o-animation-delay: "+captchaTimeout+"s;\n          animation-delay: "+captchaTimeout+"s;}")},refresh:function refresh(){if($(".captchawrap").length){this.shownOnce=!0;var _t=$(".captchawrap").css("color").match(/([0-9]+(?:\.[0-9]+)?)/g);_t=3<=_t.length?"&color="+_t.slice(0,3).join(","):"",$(".captchaimage").attr("src",ku_boardspath+"/captcha.php?"+Math.random()+_t),$(".captchawrap").removeClass("cw-initial cw-running").each(function(){void this.offsetWidth}).addClass("cw-running"),Array.prototype.forEach.call(document.querySelectorAll("input[name=\"captcha\"]"),function(o){return o.value=null})}},refreshOnce:function refreshOnce(){return this.shownOnce||this.refresh(),!1},shownOnce:!1};function checkcaptcha(t){if(0<$("input[name=captcha]").length){if(""==$("#"+t+" input[name=captcha]").val())return popupMessage(_l.enterCaptcha),!1;if(0<+$(".rotten-msg").css("opacity"))return popupMessage(_l.captcharot),!1}return!0}function handleSubmit(t){var o=t.querySelector("input[name=captcha]");return o&&!o.value.length?popupMessage(_l.enterCaptcha):void("postclone"===t.id&&ffdata.save(),Ajax.submitPost(t))}var Ajax={submitPost:function submitPost(t){t.classList.add("form-sending");var o=new FormData(t),d=new XMLHttpRequest;o.append("AJAX",1),d.open("POST",t.action),d.onload=function(){if(t.classList.remove("form-sending"),200!==d.status)return void popupMessage(_l.xhrError);[].forEach.call(t.querySelectorAll(".error-in-attachment"),function(u){return u.classList.remove("error-in-attachment")}),Captcha.refresh();var p=null;try{p=JSON.parse(d.response)}catch(u){return popupMessage(_l.xhrError),void console.error("Malformed response (JSON expected):",d.response)}if(p.error){if(p.error_verbose&&(p.error=p.error+"<br>"+p.error_verbose),!p.error_type)popupMessage(p.error);else if("ban"==p.error_type&&popupMessage(p.error+" (<a href=\""+ku_cgipath+"/banned.php\" target=\"_blank\">"+_l.details+"</a>)","none"),"duplicate_file"==p.error_type&&(popupMessage(p.error,"none"),t.querySelector("input[name=\"imagefile\"]").value=null),"upload_error"==p.error_type){popupMessage(p.error,"none");var u=t.querySelector(".multiembedwrap[data-pos=\""+p.error_data.attachmenttype+"-"+(p.error_data.position+1)+"\"]");u&&u.classList.add("error-in-attachment")}return}resetForm(t),"postclone"==t.id&&$(t).hide();var _u=t.querySelector("input[name=\"redirecttothread\"]").checked;0==p.thread_replyto?_u?document.location.href=ku_boardspath+"/"+p.board+"/res/"+p.post_id+".html":document.location.href=ku_boardspath+"/"+p.board:getnewposts(ispage?p.thread_replyto:null,+p.post_id,function(){document.location.href=ku_boardspath+"/"+p.board+"/res/"+p.thread_replyto+".html#"+p.post_id,ispage||document.location.reload()})},d.send(o)},deletePost:function deletePost(t){var o=new FormData(t),d=new XMLHttpRequest;o.append("AJAX",1),o.append("deletepost",1),d.open("POST",t.action),d.onload=function(){if(200!==d.status)return void popupMessage(_l.xhrError);var p=null;try{p=JSON.parse(d.response)}catch(u){return popupMessage(_l.xhrError),void console.error("Malformed response (JSON expected):",d.response)}return p.error?(p.error_verbose&&(p.error=p.error+"<br>"+p.error_verbose),void popupMessage(p.error,"none")):void function(){var u=[],y=[];p.data.forEach(function(T){if(!T.success)return void y.push(T);var S=$("#delform [id^=thread"+T.id+"]"),M=$("#delform [id^=reply"+T.id+"]");if(S.length)S.prev().remove(),S.next().remove(),S.next().remove(),S.remove();else if(M.length){var E=$("#delform [id^=reply"+T.id+"]");E.length&&E.parents(".postnode").remove()}u.push(T.id),$("input[name=\"post[]\"]:checked").length||$(".userdelete").removeClass("ud-active")});var k="";u.length&&(u=u.map(function(T){return"#"+T}),k+=1<u.length?_l.posts+" "+u.join(", ")+" "+_l.deletedMulti+".":_l.post+" "+u[0]+" "+_l.deleted+"."),y.forEach(function(T){k+="\n"+_l.post+" #"+T.id+": "+T.message}),popupMessage(k,700+300*u.length+600*y.length)}()},d.send(o)},reportPost:function reportPost(t){var o=new FormData(t),d=new XMLHttpRequest;o.append("AJAX",1),o.append("reportpost",1),d.open("POST",t.action),d.onload=function(){if(200!==d.status)return void popupMessage(_l.xhrError);var p=null;try{p=JSON.parse(d.response)}catch(u){return popupMessage(_l.xhrError),void console.error("Malformed response (JSON expected):",d.response)}return p.error?(p.error_verbose&&(p.error=p.error+"<br>"+p.error_verbose),void popupMessage(p.error,"none")):void function(){var u=[],y=[];p.data.forEach(function(T){return T.success?void(u.push(T.id),!$("input[name=\"post[]\"]:checked").length&&$(".userdelete").removeClass("ud-active")):void y.push(T)});var k="";u.length&&(u=u.map(function(T){return"#"+T}),k+=1<u.length?_l.posts+" "+u.join(", ")+" "+_l.reportedMulti+".":_l.post+" "+u[0]+" "+_l.reported+"."),y.forEach(function(T){k+="\n"+_l.post+" #"+T.id+": "+T.message}),popupMessage(k,700+300*u.length+600*y.length)}()},d.send(o)},deleteFile:function deleteFile(t){var o=new FormData,d=new XMLHttpRequest;o.append("AJAX",1),o.append("delete-file[]",t),o.append("moddelete",+$("input[name=\"moddelete\"]").is(":checked"));["board","postpassword"].forEach(function(l){o.append(l,$("#delform input[name=\""+l+"\"]").val())}),d.open("POST",$("#delform").attr("action")),d.onload=function(){if(200!==d.status)return void popupMessage(_l.xhrError);var p=null;try{p=JSON.parse(d.response)}catch(u){return popupMessage(_l.xhrError),void console.error("Malformed response (JSON expected):",d.response)}return p.error?(p.error_verbose&&(p.error=p.error+"<br>"+p.error_verbose),void popupMessage(p.error,"none")):void function(){var y=[];p.data.forEach(function(T){return T.success?void $("figure[data-fileid="+T.id+"]").replaceWith("<div class=\"nothumb\">"+_l.fileRemoved+"</div>"):void y.push(T)});var k="";y.forEach(function(T){k+="\n"+_l.file+" #"+T.id+": "+T.message}),k&&popupMessage(k,700+600*y.length)}()},d.send(o)},modThread:function modThread(t,o){var d=$(t),l=new FormData,p=new XMLHttpRequest;d.addClass("spin-around"),l.append("AJAX",1),p.open("POST",t.getAttribute("href")),p.onload=function(){if(d.removeClass("spin-around"),200!==p.status)return void popupMessage(_l.xhrError);var y=null;try{y=JSON.parse(p.response)}catch(k){return popupMessage(_l.xhrError),void console.error("Malformed response (JSON expected):",p.response)}if(y.error)return y.error_verbose&&(y.error=y.error+"<br>"+y.error_verbose),void popupMessage(y.error,"none");var k=d.parents(".posthead"),T=k.find(".extrabtns");"stickypost"==o&&(T.prepend("<svg class=\"icon i-icon i-pin\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-pin\"></use></svg>"),k.addClass("thread-stickied")),"unstickypost"==o&&(T.find("svg.i-icon.i-pin").remove(),k.removeClass("thread-stickied")),"lockpost"==o&&(T.prepend("<svg class=\"icon i-icon i-lock\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-lock\"></use></svg>"),k.addClass("thread-locked")),"unlockpost"==o&&(T.find("svg.i-icon.i-lock").remove(),k.removeClass("thread-locked")),popupMessage(y.message,1e3)},p.send(l)}};function inspectFormData(t){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,o,_iterator=t.entries()[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)o=_step.value,console.log(o[0]+", "+o[1])}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}function expandimg(t,o,d,l,p,u,y){var k=document.getElementById("thumb"+t);if(null==k)return!1;var T=$(k),S=T.parents(".postbody"),M=T.parents("figure").find(".fc-filename"),E;if("undefined"!=typeof event&&2===event.which)return!0;if("full"!=k.getElementsByTagName("img")[0].getAttribute("alt").substring(0,4)){if(T.html("<img src=\""+o+"\" alt=\"full"+t+"\" class=\"thumb\" height=\""+p+"\" width=\""+l+"\">"),!Settings.expandImgFull()){for(var F=k.getElementsByTagName("img")[0],j=document.documentElement?document.documentElement.clientWidth:document.body.clientWidth,H=50,G=F;null!=G;)H+=G.offsetLeft,G=G.offsetParent;var L=j-H;if(F.width>L){var I=F.width/F.height,O=1-L/F.width,N=document.createElement("div");N.setAttribute("class","filesize"),N.style.textDecoration="underline";var R=document.createTextNode(_l.imageDownscaledBy+" "+Math.round(100*O)+"% "+_l.toFit);N.appendChild(R),k.insertBefore(N,F),$(F).width(L),$(F).height(L/I)}E=L}else E=l;S&&S.addClass("postbody-expanded")}else k.innerHTML="<img src=\""+d+"\" alt=\""+t+"\" class=\"thumb\" height=\""+y+"\" width=\""+u+"\">",E=u,S&&S.removeClass("postbody-expanded");return M[0].style.maxWidth=E-50+"px",!1}var PostPreviews={zindex:3,cached:{},parent:{},_parseURL:function _parseURL(t){var o=t.match(/\/(.+)\/res\/([0-9]+)\.html#([0-9]+)|postbynumber\.php\?b=(.+)&p=([0-9]+)/i);return o?{board:o[1]||o[4],parent:o[2]||"?",post:o[3]||o[5]}:null},_mouseover:function _mouseover(t){var _this=this;t.stopPropagation();var o=this.getAttribute("href"),d=$(this).hasClass("catalog-entry"),l=PostPreviews._parseURL(o);if(!l)return!1;var p=l.board,u=l.parent,y=l.post,k="preview_"+p+"_"+y,T=$("#"+k);0==T.length&&($("body").children().first().before("<div id=\""+k+"\"></div>"),T=$("#"+k),T.addClass("reflinkpreview content-background pre-hidden actual-reflinkpreview"),T.mouseleave(PostPreviews._mouseout),T.mouseover(PostPreviews.onMouseOver));var S=$(this).parents("div[id^=preview]");if(0<S.length){if(k==S.attr("id"))return;for(var M in PostPreviews.parent)if(M==k||PostPreviews.parent[M]==k)return;PostPreviews.parent[k]=S.attr("id")}else PostPreviews.parent=[];var E;t.clientY<$(window).height()/1.5?(T.css({top:t.pageY+5}),E="top "):(T.css({bottom:$(window).height()-t.pageY+5}),E="bottom "),t.clientX<$(window).width()/1.5?(T.css({left:t.pageX+15}),E+="left"):(T.css({right:$(window).width()-t.pageX+15}),E+="right"),T.css({zIndex:PostPreviews.zindex++,"transform-origin":E}),this.style.cursor="progress",HTMLoader.getPost(p,u,y,function(L,I){window.setTimeout(function(){T.html(I?I:_l.oops+(!1===L?"":" ("+L+")")).removeClass("pre-hidden"),_this.style.cursor="pointer"},0)}),t.preventDefault()},onMouseOver:function onMouseOver(){var t=$(this);if($(this).is("a")){var o=PostPreviews._parseURL(this.getAttribute("href"));if(!o)return;var d=o.board,l=o.post;t=$("#preview_"+d+"_"+l).first()}for(;0<t.length;)clearTimeout(t[0].fadeout),t=$("#"+PostPreviews.parent[t.attr("id")])},_mouseout:function _mouseout(){var t=$(this);if($(this).is("a")){this.predelay&&clearTimeout(this.predelay);var o=PostPreviews._parseURL(this.getAttribute("href"));if(!o)return;var d=o.board,l=o.post;t=$("#preview_"+d+"_"+l).first()}for(var _loop=function(){clearTimeout(t[0].fadeout);var o=t;t[0].fadeout=setTimeout(function(){o.addClass("pre-hidden"),setTimeout(function(){delete PostPreviews.parent[o.attr("id")],o.remove()},PostPreviews._timings.transition)},PostPreviews._timings.fade),t=$("#"+PostPreviews.parent[t.attr("id")])};0<t.length;)_loop()},_timings:{predelay:50,transition:200,fade:400}};function postpreview(){}function set_inputs(t){var o=document.getElementById(t);if(o){var d=o.querySelector("input[name=name]");d&&!d.value&&(d.value=getCookie("name")),o.em.value||(o.em.value=getCookie("email")),o.postpassword.value||(o.postpassword.value=get_password("postpassword"))}}function set_delpass(t){var o=document.getElementById(t);if(o){var _d=o.postpassword;_d&&!_d.value&&(_d.value=get_password("postpassword"))}}(function(t){t.event.special.load={add:function add(o){1===this.nodeType&&"img"===this.tagName.toLowerCase()&&""!==this.src&&(this.complete||4===this.readyState?o.handler.apply(this):"uninitialized"===this.readyState&&0===this.src.indexOf("data:")?t(this).trigger("error"):t(this).bind("load",o.handler))}}})(jQuery);var Settings={_checkbox:function _checkbox(t,o,d){return null==localStorage?void trace(_l.noLocalStorage):(null==localStorage[o]&&(localStorage[o]=d),!0==t?localStorage[o]=$("#settings_"+o).is(":checked"):"true"==localStorage[o]?$("#settings_"+o).attr("checked","checked"):$("#settings_"+o).removeAttr("checked"),"true"==localStorage[o]||!0==localStorage[o])},fxEnabled:function fxEnabled(t){var o=Settings._checkbox(t,"fxEnabled",!0);return null!=t&&($.fx.off=!o),o},showReplies:function showReplies(t){var o=Settings._checkbox(t,"showReplies",!0);return null!=t&&(scrollAnchor.save("replymap",".postnode",window,"v"),o?(replyMap.showReplies(),injector.remove("hide-replies")):injector.inject("hide-replies",".replieslist {display: none}"),scrollAnchor.restore("replymap")),o},sfwMode:function sfwMode(t){var o=Settings._checkbox(t,"sfwMode",!1);return o?injector.inject("sfwMode",".thumb { opacity: 0.05;} .thumb:hover { opacity: 1;}"):injector.remove("sfwMode"),o},expandImgFull:function expandImgFull(t){return Settings._checkbox(t,"expandImgFull",!1)},constrainWidth:function constrainWidth(t){var o=Settings._checkbox(t,"constrainWidth",!1);o?injector.inject("constrainWidth","body {\n        max-width: 960px;\n        margin: 0px auto;\n      }"):injector.remove("constrainWidth")}},rswap={i:!0,swap:function swap(){this.i?$("#delform").before($("#rswapper")).after($(".postarea")):$("#delform").before($(".postarea")).after($("#rswapper")),this.i=!this.i}},isTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||!1;"desktop"==localStorage.interfaceType&&(isTouch=!1),"touch"==localStorage.interfaceType&&(isTouch=!0);var captchalang=getCookie("captchalang")||"ru";function setCaptchaLang(t){in_array(t,["ru","en","num"])&&(captchalang=t,set_cookie("captchalang",t,365))}function readyset(){if($("body").addClass("js-supported"),$(".make-me-readonly").each(function(){$(this).attr("readonly",!0).on("focus",function(){$(this).removeAttr("readonly")})}),ispage||$(".mgoback").show(),isTouch?$("#js_settings").prepend("<a href=\"javascript: localStorage.setItem('interfaceType', 'desktop'); location.reload();\">"+_l.returnDesktop+"</a><br>"):$("#js_settings").prepend("<a href=\"javascript: localStorage.setItem('interfaceType', 'touch'); location.reload();\">"+_l.returnTouch+"</a><br>"),$("#js_settings").prepend(_l.captchalang+": <a href=\"javascript:setCaptchaLang('ru');\">Cyrillic</a> | <a href=\"javascript:setCaptchaLang('en');\">Latin</a> | <a href=\"javascript:setCaptchaLang('num');\">Numeral</a><br />"),Styles.$cancelLink&&$("#js_settings").prepend(Styles.$cancelLink),LatexIT.init(),checkhighlight(),checkgotothread(),checknamesave(),bnrs.init(),cloud20.init(),$("#boardselect").on("input",function(){cloud20.filter($(this).val())}),getCookie("ku_menutype")){var t=Cookie("ku_menutype");"default"!=t&&""!=t&&(document.getElementById("overlay_menu").style.position=t)}if(processNodeInsertion(),kumod_set&&moddelcheckbox(),isTouch?($("body").addClass("touch-mode"),$(".sect-exr:not([data-toexpand=\"_options\"])").parent().hide(),$(".sect-exr").click(function(){return $("#js_settings").is(":visible")?menu_show("_off_"):menu_show("ms-_options"),!1}),$("body").click(function(){menu_show("_off_"),$("[id^=preview]").addClass("pre-hidden"),setTimeout(function(){$("[id^=preview]").remove()},PostPreviews._timings.transition)}),$(".mobile-nav").show(),$("body").on("click","a[class^='ref']",PostPreviews._mouseover),injector.inject("mb","body {margin-bottom: 350px;}")):($(".mobile-nav").hide(),$(".sect-exr").mouseenter(function(){menu_show("ms-"+$(this).data("toexpand"))}),$("#overlay_menu").mouseleave(function(){menu_show("_off_")}),$("body").on("mouseenter","a[class^='ref']",function(u){var _this2=this;this.predelay=setTimeout(function(){return PostPreviews._mouseover.bind(_this2)(u)},PostPreviews._timings.predelay)}),$("body").on("mouseleave","a[class^='ref']",PostPreviews._mouseout),$("body").on("click","a[class^='ref']",function(u){u.preventDefault();var y=this.getAttribute("href");"not-found"==highlight(y.split("#")[1])&&(document.location.href=y)})),$("body").on("click",".uib-mup",function(){return markup($(this).parents("form"),$(this).data("mups"),$(this).data("mupe"),$(this).data("imups"),$(this).data("imupe")),!1}),$(".opt-exp").click(function(){$(this).find(".expandee").toggleClass("expanded")}).mouseleave(function(){$(this).find(".expandee").removeClass("expanded")}),$(".code_markup_select").change(function(){markup($(this).parents("form"),"[code="+$(this).val()+"]","[/code]")}),$("body").on("click",".uib-bul",function(){return bullets($(this).parents("form"),$(this).data("bul"),$(this).data("imups"),$(this).data("imupe")),!1}),$("body").on("click",".uib-tx",function(){var u=$(this).data("target");return head.js("http://latex.codecogs.com/editor3.js",function(){OpenLatexEditor(u,"phpBB","en-us",!1,"","full")}),!1}),$("body").on("click",".movie",function(u){expandwebm($(this),u)}),$("body").on("click",".qrl",quickreply),$("#postclone label").each(function(){var u=$(this).attr("for"),y=u+"_clone";$(this).parents("form").find("#"+u).attr("id",y),$(this).attr("for",y)}),$("#postform textarea").attr("id","top-textarea"),$("#postform .uib-tx").data("target","top-textarea"),$("#postclone textarea").attr("id","pop-textarea"),$("#postclone .uib-tx").data("target","pop-textarea"),!isTouch){$("input, textarea, select, label").hover(function(){$("#postclone").dragsOff()},function(){$("#postclone").drags()});var o=+localStorage.pinForm?"pinned":"unpinned",d="<a href=\"#\" class=\"pinner "+o+"\" onclick=\"javascript:$('#postclone').pin();return false;\" title=\"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C / \u041E\u0442\u043A\u0440\u0435\u043F\u0438\u0442\u044C\"><svg class=\"icon b-icon\"><use class=\"use-pin\" xlink:href=\"#i-pin\"></use><use class=\"use-unpin\" xlink:href=\"#i-unpin\"></use></svg></a>"}else var d="";if(ffdata.load(),$("<span class=\"extrabtns postboxcontrol\">"+d+"&nbsp;<a href=\"#\" onclick=\"javascript:$('#postclone').hide();return false;\" title=\"\u0417\u0430\u043A\u0440\u044B\u0442\u044C\"><svg class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a></span>").appendTo("#postclone"),$("body").on("submit","#postform, #postclone",function(u){u.preventDefault(),handleSubmit(this)}),$("#delform").on("submit",function(u){u.preventDefault(),Ajax.deletePost(this)}),$("input[name=reportpost]").click(function(u){u.preventDefault(),Ajax.reportPost($(this).parents("form")[0])}),$("body").on("click",".delete-file",function(u){u.preventDefault(),u.stopPropagation();var y=$(this);Ajax.deleteFile(y.parents("figure")[0].dataset.fileid)}),$("#delform").after("<div id=\"rswapper\">[<a onclick=\"javascript:rswap.swap();return false;\" href=\"#\">"+(ispage?_l.NewThread:_l.reply)+"</a>]<hr /></div>"),Settings.sfwMode(!1),localStorage)for(var l in Settings)"_"!=l.substring(0,1)&&($("#js_settings").append("<label><input type=\"checkbox\" onchange=\"javascript:Settings."+l+"(true)\" name=\"settings_"+l+"\" id=\"settings_"+l+"\" value=\"true\"> "+_l["settings_"+l]+"</label><br />"),Settings[l](!1));else $("#js_settings").append("<span style=\"color:#F00\">"+_l.noLocalStorage+"</span><br />\u0422\u0432\u043E\u0439 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u2014 \u0433\u043E\u0432\u043D\u043E. \u0421\u043A\u0430\u0447\u0430\u0439 <a href=\"/web/20110329072959/http://google.com/chrome\" target=\"_blank\">Chome</a>, \u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440.");var p=document.getElementById("message");p&&(p.onfocus=function(){is_entering=!0},p.onblur=function(){is_entering=!1}),$("body").on("click",".posttypeindicator a",function(){var u=$(this),y=$("[name=\""+u.attr("href").substr(1)+"\"]").offset()||$("[name=\""+u.text().split(">>")[1]+"\"]").offset()||!1;return y&&$("html, body").animate({scrollTop:y.top-($("#overlay_menu").height()+10)},250),!1}),$("body").on("click",".dice",function(){"undefined"==typeof $(this).data("html")&&$(this).data("html",$(this).html());var u=stripHTML($(this).html());$(this).html($(this).attr("title")),$(this).attr("title",u)}),$("<div id=\"viewlink\"></div>").addClass("content-background reflinkpreview qreplyform").html("<a style=\"float:left;\" href=\"#\" onclick=\"javascript:$('#viewlink').hide();return false;\"><svg style=\"margin-left:0\" class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a><div style=\"display:inline-block\"><input type=\"text\" id=\"directLink\"><br /><input type=\"text\" id=\"quoteLink\"></div>").hide().appendTo("body"),$("body").on("click",".shl",showLinks),$("#directLink, #quoteLink").on("click",function(){$(this).select()}),$("body").on("click",".embed-play-button",function(u){u.preventDefault(),unwrapEmbed($(this).parents("figure"))}),$("body").on("click",".collapse-video",function(u){u.preventDefault(),wrapEmbed($(this).parents("figure"))}),$(document).on("animationstart webkitAnimationStart MSAnimationStart oanimationstart",function(u){var y=$(u.target);"nodeInserted"!=u.originalEvent.animationName||y.hasClass("_inserted_")||processNodeInsertion(y)}),$("body").on("mouseenter","._country_",function(){"undefined"==typeof $(this).attr("title")&&$(this).attr("title",countries[$(this).attr("src").split("flags/")[1].split(".png")[0].toUpperCase()])}),dcxt.performTasks(),$("body").on("click",".audiowrap",function(u){u.preventDefault();var y=$(this),k=y.attr("href"),T=y.parents("figure");T.hasClass("unwrapped")||T.addClass("unwrapped unwrapped-audio");var S=T.find(".filesize");S.find(".collapse-btn").length||S.append("\n        <button title=\""+_l.collapse+"\" class=\"emb-button collapse-video\">\n          <svg class=\"icon b-icon\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-shrink\"></use></svg>\n        </button>"),y.find("audio").length||y.append("<audio src=\""+k+"\" controls autoplay=\"true\"></audio>"),S.find(".collapse-video").click(function(){T.removeClass("unwrapped unwrapped-audio").find("audio")[0].pause()})}),$("input[name^=embed]").on("input",function(){var u=embedLinks.process($(this).val());u&&$(this).val(u.code).parents(".multiembedwrap").find("[name^=embedtype]").val(u.site)}),$("input[name^=imagefile]").on("change",function(){var u=$(this);if(u.val()){var y=u.parent().next();y.length&&y.prop("checked",!0)}}),"undefined"!=typeof is_catalog&&is_catalog&&catalog.init(),$(".userdelete").addClass("content-background reflinkpreview"),$("body").on("change","input[name=\"post[]\"]",function(){$(".userdelete").hasClass("ud-active")?!$("input[name=\"post[]\"]").is(":checked")&&$(".userdelete").removeClass("ud-active"):$(".userdelete").addClass("ud-active")}),$("<div id=\"tripinfo\"></div>").addClass("content-background reflinkpreview qreplyform").hide().appendTo("body"),$("#delform").on("click",".postertrip",function(u){u.preventDefault();var y=$(this).text().split("!")[1],k=$(this).offset(),T=$(this).height();$.getJSON("/tripinfo.php",{trip:y}).done(function(S){var M=[];_.each(S.active_on,function(E){M.push("<a target=\"_blank\" href=\""+ku_boardspath+"/"+E+"/\">/"+E+"/</a>")}),$("#tripinfo").html("<div><b class=\"postertrip\">!"+y+"</b> [<a href=\"https://www.google.com/search?q=!"+y+"\" target=\"_blank\">G</a>]</div><a style=\"float:left;\" href=\"#\" onclick=\"javascript:$('#tripinfo').hide();return false;\"><svg style=\"position: absolute; top: 3px; right: 3px;\" class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a><div class=\"trip-info-line\">"+_l.threads+": "+S.threads+", "+_l.comments+": "+S.comments+"</div><div class=\"trip-info-line\">"+_l.active_since+": "+catalog.formatDate(S.active_since,!0)+"</div><div class=\"trip-info-line\">"+_l.last_active+": "+catalog.formatDate(S.last_active,!0)+"</div>"+(M.length?"<div class=\"trip-info-line\">"+_l.active_on+": "+M.join(", ")+"</div>":"")).css({top:k.top+T,left:k.left}).fadeIn("fast")}).fail(function(S){console.error(S)})}),$("body").on("click",".csswrap",function(u){u.preventDefault();var y=$(this).attr("href");Styles.testStyle(y)}),$("input[name=disable_name]").on("change",function(){var u=$(this).is(":checked");$(this).parents("form").find("input[name=name]").attr("disabled",u),localStorage.setItem("post_anonymously",+u)}).prop("checked",!!+localStorage.post_anonymously).trigger("change"),unreadCounter.update(),Captcha.init()}function processNodeInsertion(t){"undefined"==typeof t?t=$("body"):(t.addClass("_inserted_"),t=t.parents(":eq(1)")),t.find(".prettyprint").length&&prettyPrint.apply(window),LatexIT.render(t),processEmbeds(t),kumod_set&&delandbanlinks(t)}var dcxt={tries:10,enabled:!1,tasks:[],changed:0,openSettings:function openSettings(){$("#de-content-cfg").length||(injector.inject("dcxt-hide","#de-content-cfg {opacity: 0!important}"),$("#de-btn-settings")[0].click())},closeSettings:function closeSettings(){$("#de-content-cfg").length&&($("#de-btn-settings")[0].click(),injector.remove("dcxt-hide"))},addTask:function addTask(t){this.enabled?t():this.tasks.push(t)},performTasks:function performTasks(){!this.enabled&&$("#de-btn-settings").length?(this.enabled=!0,$("#gotothread").prop("checked",!0),_.each(this.tasks,function(t){t()}),this.tasks=[],this.changed&&location.reload()):this.tries&&(setTimeout(function(){dcxt.performTasks()},500),this.tries--)}},updater={ajaxPosting:!1,newThreads:[],showNewThreads:function showNewThreads(){$("#wild_thread_appeared").remove(),_.each(this.newThreads,function(t){$.get(ku_boardspath+"/read.php?b="+this_board_dir+"&t="+this_board_dir+"&p="+t+"&single&replink=1",function(o){$("#delform").prepend(o+"<br clear=\"left\" /><hr />")})}),this.newThreads=[]},update:function update(t){_typeof(t.token)!==void 0&&($("input[name=token][value="+t.token+"]").length?(clearfields($("input[name=token][value="+t.token+"]").parents("form")),!this.ajaxPosting&&getnewposts()):getnewposts());var o=localStorage.lastvisits?JSON.parse(localStorage.lastvisits)||{}:{};"undefined"!=typeof t.timestamp&&(o[boardid]=t.timestamp,localStorage.setItem("lastvisits",JSON.stringify(o)))},bpageNotify:function bpageNotify(t){if(!$("input[name=token][value="+t.token+"]").length)if("newthreads"==t.room){if(dcxt.enabled)return;updater.newThreads.push(t.newthread),$("#wild_thread_appeared").length||$(".postarea").after("<a class=\"xlink\" href=\"javascript:updater.showNewThreads();return false;\" id=\"wild_thread_appeared\">"+_l.newThreadsAvailable+"<hr /></a>")}else{var o=$("[id^=replies"+t.room+"]");o.find(".fresh-replies").text(_l.newReplies+": "+(+o.find(".fresh-replies").text().split(":")[1]+1)).length||o.append("<a href=\"/"+this_board_dir+"/res/"+t.room+".html\" class=\"xlink fresh-replies\">"+_l.newReplies+": 1</a>").find(".fresh-replies").click(function(d){d.preventDefault();var l=$(this),p=/\d+/.exec(o.find(".reply").last().attr("id"));$.ajax({url:ku_boardspath+"/expand.php?after="+p+"&board="+this_board_dir+"&threadid="+t.room,success:function success(u){u?(o.append($(u)),replyMap.showReplies()):popupMessage(_l.noNewPosts),l.remove()},error:function error(u,y){popupMessage(_l.oops+" ("+y+")")}})})}},send:function send(t){return this.ajaxPosting||xsend(t.attr("id")),!1}};function processEmbeds(t){t.find(".embed:not(.title-given)").each(function(){var o=$(this),d=o.data("id");"youtube"===o.data("site")&&($.get("https://www.googleapis.com/youtube/v3/videos?part=id%2Csnippet&id="+d+"&key="+ku_youtube_apikey,function(l){if(!l.error&&l.items.length){var p=l.items[0].snippet.title;o.append($("<a target=\"_blank\" title=\""+_l.watchOn+" Youtube\"></a>").addClass("yt-title-overlay").text(p).attr("href","http://www.youtube.com/watch?v="+d).click(function(u){u.stopPropagation()}))}}),o.addClass("title-given")),"vimeo"===o.data("site")&&($.get("http://vimeo.com/api/v2/video/"+d+".json",function(l){var p=l[0].title,u=l[0].thumbnail_large;o.css({"background-image":"url("+u+")"}).append($("<a target=\"_blank\" title=\""+_l.watchOn+" Vimeo\"></a>").addClass("vi-title-overlay").text(p).attr("href","http://vimeo.com/"+d).click(function(y){y.stopPropagation()}))}),o.addClass("title-given")),"coub"===o.data("site")&&($.get(ku_boardspath+"/corpsy.php?code="+d,function(l){var p=l.title,u=l.thumbnail_url;o.css({"background-image":"url("+u+")"}).append($("<a target=\"_blank\" title=\""+_l.watchOn+" Coub\"></a>").addClass("co-title-overlay").text(p).attr("href","http://coub.com/view/"+d).click(function(y){y.stopPropagation()}))}),o.addClass("title-given"))})}if(+localStorage.localmod)kumod_set=!0;else{var t=getCookie("kumod");""!==t&&("allboards"===t?kumod_set=!0:kumod_set=in_array(this_board_dir,t.split("|")))}var mp3playerid=0;function expandmp3(t,o){mp3playerid==t?(document.getElementById("player"+t).innerHTML="",document.getElementById("player"+t).style.display="none",mp3playerid=0):(0!=mp3playerid&&(document.getElementById("player"+mp3playerid).innerHTML="",document.getElementById("player"+mp3playerid).style.display="none"),document.getElementById("player"+t).innerHTML="<embed src=\"/web/20110329072959/http://www.0chan.ru/mediaplayer.swf?type=mp3&file="+o+"\" width=\"320\" height=\"20\">",document.getElementById("player"+t).style.display="block",mp3playerid=t)}var swfplayerid=0;function expandswf(t,o,d,l){swfplayerid==t?(document.getElementById("swfplayer"+t).innerHTML="",document.getElementById("swfplayer"+t).style.display="none",swfplayerid=0):(0!=swfplayerid&&(document.getElementById("swfplayer"+swfplayerid).innerHTML="",document.getElementById("swfplayer"+swfplayerid).style.display="none"),document.getElementById("swfplayer"+t).innerHTML="<embed src=\""+o+"\" width=\""+d+"\" height=\""+l+"\">",document.getElementById("swfplayer"+t).style.display="block",swfplayerid=t)}function expandwebm(t,o){t.parents(".reply");if("1"!==t.data("expanded")){var l,p,u,y,k,T,S,M,E,L,I,O,P,N,R;(function(){if(o.preventDefault(),l=t.attr("href"),p=t.data("height"),u=t.data("width"),y=t.data("thumb"),k=t.data("id"),T="_vframe_"+makeid()+new Date().getTime(),t.replaceWith(function(){return"<span id=\""+T+"\" data-thumb=\""+y+"\" data-width=\""+u+"\"\" data-height=\""+p+"\" data-href=\""+l+"\">"+this.innerHTML+"</span>"}),t=$("#"+T),t.find("img").hide(),S=t.find("video").show(),M="",S.length?S.get(0).play():t.find(".playable-thumb").append("<video class=\"thumb\" src=\""+l+"\" controls loop autoplay height=\""+p+"\" width=\""+u+"\"></video>").promise().done(function(){S=t.find("video")}),!Settings.expandImgFull()){for(E=50,L=S[0],I=document.documentElement?document.documentElement.clientWidth:document.body.clientWidth;null!=L;)E+=L.offsetLeft,L=L.offsetParent;O=I-E,u>O&&(P=u/p,N=1-O/u,R=O/P,S.width(O),S.height(R),M=_l.videoDownscaledBy+" "+Math.round(100*N)+"% "+_l.toFit)}var F=t.parents("figure");F.hasClass("unwrapped")||F.addClass("unwrapped");var j=t.parent().find(".filesize");j.find(".collapse-btn").length||(j.append("\n        <button title=\""+_l.collapse+"\" class=\"emb-button collapse-video\">\n          <svg class=\"icon b-icon\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-shrink\"></use></svg>\n        </button>"),t.parent().find(".collapse-video").click(function(){F.removeClass("unwrapped");var H="_vframe_"+makeid()+new Date().getTime();return t.replaceWith(function(){return"<a class=\"movie\" id=\""+H+"\" data-thumb=\""+y+"\" data-width=\""+u+"\"\" data-height=\""+p+"\" href=\""+l+"\">"+this.innerHTML+"</a>"}).data("expanded","0"),t=$("#"+H),t.find("video").hide()[0].pause(),t.find("img").show(),$(this).remove(),t.parents(".reply").removeClass("reply-expanded"),!1})),t.parents(".reply").addClass("reply-expanded")})()}}function makeid(){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;5>d;d++)t+=o.charAt(Math.floor(Math.random()*o.length));return t}function checknamesave(){var t=""!=getCookie("name");var o=document.getElementById("save");null!=o&&(o.checked=t)}function checkgotothread(){var t;t=!("on"!=getCookie("tothread")),$("#gotothread").attr("checked",t)}function navigatepages(t){if(document.getElementById&&!is_entering&&(window.event&&(t=window.event),t.ctrlKey)){var o=null,d=null,l=document.location.toString();if(-1!=l.indexOf("/res/"))13==(t.keyCode?t.keyCode:t.which?t.which:null)&&$("textarea[name=\"message\"]:focus").parents("form").submit();else{if(-1==l.indexOf(".html")||-1!=l.indexOf("board.html"))var p=0,u=l.substr(0,l.lastIndexOf("/")+1);else{var p=l.substr(l.lastIndexOf("/")+1);p=+p.substr(0,p.indexOf(".html"));var u=l.substr(0,l.lastIndexOf("/")+1)}if(0==p)var y=u;else var y=u+p+".html";var M;if(M=/#s([0-9]+)/.exec(l))var k=+M[1];else var k=-1;for(var T=0;0<document.getElementsByName("s"+ ++T).length;);switch(t.keyCode?t.keyCode:t.which?t.which:null){case 13:$("textarea[name=\"message\"]:focus").parents("form").submit();break;case 37:o=document.getElementById("prevPage");break;case 39:o=document.getElementById("nextPage");break;case 40:if(k==T-1)break;else var S=k+1;d=y+"#s"+S;break;case 38:if(-1==k||0==k)break;else var S=k-1;d=y+"#s"+S;break;case 36:document.location=u;}o&&o.action&&(document.location=o.action),d&&(document.location.href=d)}}}window.document.addEventListener?window.document.addEventListener("keydown",navigatepages,!1):window.document.attachEvent("onkeydown",navigatepages),NodeList.prototype.forEach=Array.prototype.forEach;var replyMap={showReplies:function showReplies(t){var _this3=this;(t||document).querySelectorAll(".postnode").forEach(function(o){var d=o.querySelector(".reflink a:last-child").innerHTML,l=o.querySelector(".postmessage"),p=o.querySelector(".replieslist");_this3.posts[d]?_this3.posts[d].container=p:_this3.posts[d]={container:p,replies:[]};var u=l.querySelectorAll("a[class^=ref\\|"+this_board_dir+"]");u.length&&u.forEach(function(y){var k=y.className.split(" ")[0].split("|"),T=k[3],S=""===k[2]?ku_boardspath+"/postbynumber.php?b="+k[1]+"&p="+k[3]:"/"+k[1]+"/res/"+k[2]+".html#"+d,M="<a class=\"ref-reply\" href=\""+S+"\">&gt;&gt;"+d+"</a>";_this3.posts[T]?!_.includes(_this3.posts[T].replies,M)&&_this3.posts[T].replies.push(M):_this3.posts[T]={replies:[M]},_this3.posts[T].skip=!1})}),_.each(this.posts,function(o){!o.skip&&o.replies.length&&o.container&&(o.container.innerHTML=_l.replies+": "+o.replies.join(", "),o.skip=!0)})},posts:{}},scrollAnchor={save:function save(t,o,d,l){d=d||window,l=l||"vh";var p=[window.innerWidth/2,window.innerHeight/2],u=[],y=d==window?{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight}:d.getBoundingClientRect();d!=window&&(0>=y.left&&0>=y.right||0>=y.top&&0>=y.bottom||y.left>=window.innerWidth||y.top>=window.innerHeight)&&(p=[y.left+y.width/2,y.top+y.height/2]);var k=(d==window?document:d).querySelectorAll(o);if(k.length){k.forEach(function(M){var E=M.getBoundingClientRect(),L=Math.pos(E.width-(Math.pos(y.left-E.left)+Math.pos(E.right-y.right)))/E.width,I=Math.pos(E.height-(Math.pos(y.top-E.top)+Math.pos(E.bottom-y.bottom)))/E.height,O=Math.abs(p[0]-(E.left+E.width/2)),P=Math.abs(p[1]-(E.top+E.height/2));u.push({el:M,primaryVisibility:"h"==l[0]?L:I,secondaryVisibility:"v"==l[0]?L:I,primaryOffset:"h"==l[0]?O:P,secondaryOffset:"v"==l[0]?O:P})}),u.sort(function(M,E){return E.primaryVisibility===M.primaryVisibility?1<l.length&&E.secondaryVisibility!==M.secondaryVisibility?E.secondaryVisibility-M.secondaryVisibility:M.primaryOffset===E.primaryOffset?1<l.length?M.secondaryOffset-E.secondaryOffset:void 0:M.primaryOffset-E.primaryOffset:E.primaryVisibility-M.primaryVisibility});var _T=u[0].el,_S=_T.getBoundingClientRect();this.saved[t]={anchor:_T,left:_S.left,top:_S.top,parent:d,dimensions:l}}},restore:function restore(t){var o=this.saved[t];o&&window.requestAnimationFrame(function(){var d=o.anchor.getBoundingClientRect();o.parent.scrollBy(-1===o.dimensions.indexOf("h")?0:d.left-o.left,-1===o.dimensions.indexOf("v")?0:d.top-o.top)})},saved:{}};Math.pos=function(t){return 0<=t?t:0},function(){for(var t=0,o=["ms","moz","webkit","o"],d=0;d<o.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[o[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[o[d]+"CancelAnimationFrame"]||window[o[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(l){var u=new Date().getTime(),y=Math.max(0,16-(u-t)),k=window.setTimeout(function(){l(u+y)},y);return t=u+y,k}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(l){clearTimeout(l)})}();var menu_current="",menu_last="";function menu_show(t){if(""!=menu_current){var o="_off_"==t?125:0;$("#"+menu_current).delay(o).slideUp(100),menu_last=menu_current}""!=t&&(menu_last==t&&"undefined"!=typeof $("#"+t).queue()&&0<$("#"+t).queue().length?$("#"+t).clearQueue():$("#"+t).slideDown(150)),menu_current=t}function menu_pin(){"absolute"==document.getElementById("overlay_menu").style.position?(document.getElementById("overlay_menu").style.position="fixed",Cookie("ku_menutype","fixed",365)):(document.getElementById("overlay_menu").style.position="absolute",Cookie("ku_menutype","absolute",365))}function set_oldmenu(t){t&&Cookie("ku_oldmenu","yes",90);var o=document.getElementById("boardlist_header"),d=document.getElementById("boardlist_footer");o&&d&&(o.innerHTML=d.innerHTML+" <a href=\"#\" onclick=\"javascript:set_cookie('ku_oldmenu', 'no', 90);parent.document.location.reload(true);\">[overlay]</a>")}var LatexIT={mode:"gif",init:function init(){document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(this.mode="svg")},odc:"javascript:LatexIT.replaceWithSrc(this);",dcls:"Double click to show source",pre:function pre(eqn){var txt=eqn.innerHTML;if(!txt.match(/<img.*?>/i)&&!txt.match(/<object.*?>/i)){txt=txt.replace(/<br>/gi,"").replace(/<br \/>/gi,"").replace(/&amp;/mg,"&");var atxt="[tex]"+txt+"[/tex]";txt=escape(txt.replace(/\\/mg,"\\"));var c=eval("LatexIT.normalize"+$(eqn).parent().css("color")),extxt="{\\color[rgb]{"+c.r+","+c.g+","+c.b+"}"+txt+"}";txt=" <img src=\"http://latex.codecogs.com/"+this.mode+".latex?"+extxt+"\" title=\""+this.dcls+"\" alt=\""+atxt+"\" ondblclick=\""+this.odc+"\" border=\"0\" class=\"latex\" /> "}return txt},replaceWithSrc:function replaceWithSrc(t){var o=$(t).attr("alt");$(t).parent().html(o)},render:function render(t){for(var o="undefined"==typeof t?window.document:t[0],d=o.getElementsByTagName("*"),l=0;l<d.length;l++)("latex"==d[l].getAttribute("lang")||"latex"==d[l].getAttribute("xml:lang"))&&(d[l].innerHTML=this.pre(d[l]))},normalizergb:function normalizergb(t,o,d){return{r:(t/255).toFixed(3),g:(o/255).toFixed(2),b:(d/255).toFixed(2)}},normalizergba:function normalizergba(t,o,d){return this.normalizergb(t,o,d)}};function in_array(t,o){return"object"==("undefined"==typeof o?"undefined":_typeof(o))?_.includes(o,t):t===o}(function(t){function o(d,l){if(d.fireEvent)d.fireEvent("on"+l);else{var p=document.createEvent("Events");p.initEvent(l,!0,!1),d.dispatchEvent(p)}}t.fn.drags=function(d){if(d=t.extend({handle:"",cursor:"move"},d),""===d.handle)var l=this;else var l=this.find(d.handle);return l.css("cursor",d.cursor).on("mousedown",function(p){if(""===d.handle)var u=t(this).addClass("draggable");else var u=t(this).addClass("active-handle").parent().addClass("draggable");var y=u.css("z-index"),k=u.outerHeight(),T=u.outerWidth(),S=u.offset().top+k-p.pageY,M=u.offset().left+T-p.pageX;u.css("z-index",1e3).parents().on("mousemove",function(E){t(".draggable").offset({top:E.pageY+S-k,left:E.pageX+M-T}).on("mouseup",function(){t(this).removeClass("draggable").css("z-index",y)})}),p.preventDefault()}).on("mouseup",function(){""===d.handle?t(this).removeClass("draggable"):t(this).removeClass("active-handle").parent().removeClass("draggable")})},t.fn.dragsOff=function(d){if(d=t.extend({handle:"",cursor:"default"},d),""===d.handle){var l=this;t(this).removeClass("draggable")}else{var l=this.find(d.handle);t(this).removeClass("active-handle").parent().removeClass("draggable")}return l.css("cursor","default").off("mousedown").off("mouseup").off("mousemove")},t.fn.pin=function(){if("fixed"!==this.css("position")){var d={top:this.position().top-t(document).scrollTop(),left:this.position().left-t(document).scrollLeft()};this.css({position:"fixed",left:d.left,top:d.top}),this.find(".pinner").removeClass("pinned").addClass("unpinned"),localStorage.pinForm=0}else{var d={top:this.position().top+t(document).scrollTop(),left:this.position().left+t(document).scrollLeft()};this.css({position:"absolute",left:d.left,top:d.top}),this.find(".pinner").removeClass("unpinned").addClass("pinned"),localStorage.pinForm=1}},t.fn.triggerNative=function(d){return this.each(function(){var l=t(this).get(0);o(l,d)})}})(jQuery);function unwrapEmbed(t){t.addClass("unwrapped");var o=t.find(".emb-iframe-wrapper");o.data("h")>o.data("w")&&o.addClass("vertical-video"),o.css({paddingBottom:100*(o.data("h")/o.data("w"))+"%"});var d=o.data("code"),l="frameborder=\"0\" scrolling=\"no\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"";"Youtube"==o.data("site")&&o.append("<iframe src=\"https://www.youtube.com/embed/"+d+"?autoplay=1\" "+l+"></iframe>"),"Vimeo"==o.data("site")&&o.append("<iframe src=\"//player.vimeo.com/video/"+d+"?badge=0&autoplay=1\" "+l+"></iframe>"),"Coub"==o.data("site")&&o.append("<iframe src=\"http://coub.com/embed/"+d+"?muted=false&autostart=true&originalSize=false&hideTopBar=false&noSiteButtons=false&startWithHD=false\" "+l+"></iframe>");var p=t.find(".embed-wrap");p.find(".collapse-video").length||t.find(".embed-wrap").append("\n      <button title=\""+_l.collapse+"\" class=\"emb-button collapse-video\">\n        <svg class=\"icon\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-shrink\"></use></svg>\n      </button>")}function wrapEmbed(t){t.removeClass("unwrapped"),t.find(".emb-iframe-wrapper").empty()}function xsend(t){return"undefined"==typeof t&&(t="postform"),$("#"+t).ajaxSubmit({beforeSubmit:function beforeSubmit(){$("#"+t).addClass("form-sending")},success:function success(o){$("#"+t).removeClass("form-sending");var u=$("<html></html>").append(o);""===u.find("h1").text()?""!==u.find(".big-shit").text()&&("\u0412\u044B \u0437\u0430\u0431\u0430\u043D\u0435\u043D\u044B!"===u.find(".big-shit").text()&&(window.location.href=ku_cgipath+"/banned.php"),popupMessage(u.find(".big-shit").text()),clearfields($(t),!0)):(popupMessage(u.find("h2").text()),clearfields($(t),!0))}}),!1}function clearfields(t,o){"undefined"==typeof o&&(o=!1),o||(t.find("[name=\"message\"]").val(""),t.find("[name=\"captcha\"]").val(""),t.find("[name=\"subject\"]").val(""),t.find("[name=\"imagefile\"]").val(""),t.find("[name=\"name\"]").val(""),t.find("[name=\"embed\"]").val(""),t.find("[name=\"token\"]").val(randomString())),dcxt.enabled||($(".captchawrap").stop(),clearTimeout(rottencaptcha),rotCaptcha())}function resetForm(t){var o=t.querySelectorAll("input[type=text]:not([name=name]), input[type=file], textarea");Array.prototype.forEach.call(o,function(d){return d.value=null})}var injector={inject:function inject(t,o){var d="injector:"+t,l=document.getElementById(d);if(l)return void(l.innerHTML=o);var p=document.head||document.getElementsByTagName("head")[0],u=document.createElement("style");u.type="text/css",u.id=d,u.styleSheet?u.styleSheet.cssText=o:u.appendChild(document.createTextNode(o)),p.appendChild(u)},remove:function remove(t){var o="injector:"+t,d=document.getElementById(o);if(d){var l=document.head||document.getElementsByTagName("head")[0];l&&l.removeChild(document.getElementById(o))}}};function randomString(){for(var t="",o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",l=10;0<l;--l)t+=o[Math.round(Math.random()*(o.length-1))];return t}var cloud20={init:function init(){$.getJSON(ku_cgipath+"/boards20.json",function(t){cloud20.allboards=t,cloud20.filter("")})},filter:function filter(t){var o=[];"undefined"==typeof this.allboards||(""==t?o=this.allboards:(t=t.toLowerCase(),_.each(this.allboards,function(d){(-1!==d.name.toLowerCase().search(t)||-1!==d.desc.toLowerCase().search(t))&&o.push(d)})),this.display(o))},display:function display(t){var o="",d="";_.each(t,function(l){o+="<a class=\"menu-item\" title=\""+l.desc+"\" href=\""+ku_boardsfolder+l.name+"/\">/"+l.name+"/ - "+l.desc+"</a>",d+="<option value=\""+l.name+"\">/"+l.name+"/ - "+l.desc+"</option>"}),$("#boards20").html(o),$(".boardsel20").append(d)}},countries={A1:"Anonymous Proxy",A2:"Satellite Provider",O1:"Other Country",AD:"Andorra",AE:"United Arab Emirates",AF:"Afghanistan",AG:"Antigua and Barbuda",AI:"Anguilla",AL:"Albania",AM:"Armenia",AO:"Angola",AP:"Asia/Pacific Region",AQ:"Antarctica",AR:"Argentina",AS:"American Samoa",AT:"Austria",AU:"Australia",AW:"Aruba",AX:"Aland Islands",AZ:"Azerbaijan",BA:"Bosnia and Herzegovina",BB:"Barbados",BD:"Bangladesh",BE:"Belgium",BF:"Burkina Faso",BG:"Bulgaria",BH:"Bahrain",BI:"Burundi",BJ:"Benin",BL:"Saint Bartelemey",BM:"Bermuda",BN:"Brunei Darussalam",BO:"Bolivia",BQ:"Bonaire, Saint Eustatius and Saba",BR:"Brazil",BS:"Bahamas",BT:"Bhutan",BV:"Bouvet Island",BW:"Botswana",BY:"Belarus",BZ:"Belize",CA:"Canada",CC:"Cocos (Keeling) Islands",CD:"Congo, The Democratic Republic of the",CF:"Central African Republic",CG:"Congo",CH:"Switzerland",CI:"Cote d'Ivoire",CK:"Cook Islands",CL:"Chile",CM:"Cameroon",CN:"China",CO:"Colombia",CR:"Costa Rica",CU:"Cuba",CV:"Cape Verde",CW:"Curacao",CX:"Christmas Island",CY:"Cyprus",CZ:"Czech Republic",DE:"Germany",DJ:"Djibouti",DK:"Denmark",DM:"Dominica",DO:"Dominican Republic",DZ:"Algeria",EC:"Ecuador",EE:"Estonia",EG:"Egypt",EH:"Western Sahara",ER:"Eritrea",ES:"Spain",ET:"Ethiopia",EU:"Europe",FI:"Finland",FJ:"Fiji",FK:"Falkland Islands (Malvinas)",FM:"Micronesia, Federated States of",FO:"Faroe Islands",FR:"France",GA:"Gabon",GB:"United Kingdom",GD:"Grenada",GE:"Georgia",GF:"French Guiana",GG:"Guernsey",GH:"Ghana",GI:"Gibraltar",GL:"Greenland",GM:"Gambia",GN:"Guinea",GP:"Guadeloupe",GQ:"Equatorial Guinea",GR:"Greece",GS:"South Georgia and the South Sandwich Islands",GT:"Guatemala",GU:"Guam",GW:"Guinea-Bissau",GY:"Guyana",HK:"Hong Kong",HM:"Heard Island and McDonald Islands",HN:"Honduras",HR:"Croatia",HT:"Haiti",HU:"Hungary",ID:"Indonesia",IE:"Ireland",IL:"Israel",IM:"Isle of Man",IN:"India",IO:"British Indian Ocean Territory",IQ:"Iraq",IR:"Iran, Islamic Republic of",IS:"Iceland",IT:"Italy",JE:"Jersey",JM:"Jamaica",JO:"Jordan",JP:"Japan",KE:"Kenya",KG:"Kyrgyzstan",KH:"Cambodia",KI:"Kiribati",KM:"Comoros",KN:"Saint Kitts and Nevis",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KY:"Cayman Islands",KZ:"Kazakhstan",LA:"Lao People's Democratic Republic",LB:"Lebanon",LC:"Saint Lucia",LI:"Liechtenstein",LK:"Sri Lanka",LR:"Liberia",LS:"Lesotho",LT:"Lithuania",LU:"Luxembourg",LV:"Latvia",LY:"Libyan Arab Jamahiriya",MA:"Morocco",MC:"Monaco",MD:"Moldova, Republic of",ME:"Montenegro",MF:"Saint Martin",MG:"Madagascar",MH:"Marshall Islands",MK:"Macedonia",ML:"Mali",MM:"Myanmar",MN:"Mongolia",MO:"Macao",MP:"Northern Mariana Islands",MQ:"Martinique",MR:"Mauritania",MS:"Montserrat",MT:"Malta",MU:"Mauritius",MV:"Maldives",MW:"Malawi",MX:"Mexico",MY:"Malaysia",MZ:"Mozambique",NA:"Namibia",NC:"New Caledonia",NE:"Niger",NF:"Norfolk Island",NG:"Nigeria",NI:"Nicaragua",NL:"Netherlands",NO:"Norway",NP:"Nepal",NR:"Nauru",NU:"Niue",NZ:"New Zealand",OM:"Oman",PA:"Panama",PE:"Peru",PF:"French Polynesia",PG:"Papua New Guinea",PH:"Philippines",PK:"Pakistan",PL:"Poland",PM:"Saint Pierre and Miquelon",PN:"Pitcairn",PR:"Puerto Rico",PS:"Palestinian Territory",PT:"Portugal",PW:"Palau",PY:"Paraguay",QA:"Qatar",RE:"Reunion",RO:"Romania",RS:"Serbia",RU:"Russian Federation",RW:"Rwanda",SA:"Saudi Arabia",SB:"Solomon Islands",SC:"Seychelles",SD:"Sudan",SE:"Sweden",SG:"Singapore",SH:"Saint Helena",SI:"Slovenia",SJ:"Svalbard and Jan Mayen",SK:"Slovakia",SL:"Sierra Leone",SM:"San Marino",SN:"Senegal",SO:"Somalia",SR:"Suriname",SS:"South Sudan",ST:"Sao Tome and Principe",SV:"El Salvador",SX:"Sint Maarten",SY:"Syrian Arab Republic",SZ:"Swaziland",TC:"Turks and Caicos Islands",TD:"Chad",TF:"French Southern Territories",TG:"Togo",TH:"Thailand",TJ:"Tajikistan",TK:"Tokelau",TL:"Timor-Leste",TM:"Turkmenistan",TN:"Tunisia",TO:"Tonga",TR:"Turkey",TT:"Trinidad and Tobago",TV:"Tuvalu",TW:"Taiwan",TZ:"Tanzania, United Republic of",UA:"Ukraine",UG:"Uganda",UM:"United States Minor Outlying Islands",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VA:"Holy See (Vatican City State)",VC:"Saint Vincent and the Grenadines",VE:"Venezuela",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",VN:"Vietnam",VU:"Vanuatu",WF:"Wallis and Futuna",WS:"Samoa",YE:"Yemen",YT:"Mayotte",ZA:"South Africa",ZM:"Zambia",ZW:"Zimbabwe",XX:"OMCK",T1:"Tor"},bnrs={initiated:!1,init:function init(){$.getJSON(ku_boardspath+"/bnrs.json",function(t){var o=[];1<t.length?_.each(t,function(d){d.link!==this_board_dir&&o.push(d)}):o=t,bnrs.data=o,bnrs.initiated=!0,bnrs.display()})},display:function display(){if(this.initiated&&this.data.length){var t=[];"undefined"==typeof this.current?t=this.data:_.each(this.data,function(p){p.path!==bnrs.current&&t.push(p)});var o=randomItem(t);this.current=o.path;var d=-1===o.link.indexOf("http")?ku_boardspath+"/"+o.link:o.link,l="<a class=\"bnrsupdate\" href=\"#\" onclick=\"javascript:bnrs.display();return false;\"></a><a href=\""+d+"\"><img src=\""+ku_boardspath+"/images/bnrs/"+o.path+"\" /></a>";$(".bnr").length?$(".bnr").html(l):$(".logo").before("<div class=\"bnr-wrap\"><div class=\"bnr\">"+l+"</div></div>")}}};function getRandomInt(t,o){return Math.floor(Math.random()*(o-t+1))+t}function randomItem(t){return t[getRandomInt(0,t.length-1)]}var ffdata={pos:["top","left"],save:function save(){var t={};_.each(ffdata.pos,function(d){t[d]=$("#postclone").css(d)});var o=new Date().getTime();return t.savedon=o,ffdata.savedOn=o,$("#postform [name=ffdata_savedon]").val(o),localStorage.setItem("ffdata_"+this_board_dir+"_"+(ispage?"page":$("#postform [name=replythread]").val()),JSON.stringify(t)),!0},savedOn:!1,unload:function unload(){$("#postform [name=ffdata_savedon]").val(ffdata.savedOn||new Date().getTime())},load:function load(){var t="ffdata_"+this_board_dir+"_"+(ispage?"page":$("#postform [name=replythread]").val());if(localStorage[t])try{(function(){var o=JSON.parse(localStorage[t]);o.savedon&&o.savedon==$("#postform [name=ffdata_savedon]").val()?(_.each(ffdata.pos,function(d){o.hasOwnProperty(d)&&$("#postclone").css(d,o[d])}),$("#postclone").show()):localStorage.removeItem(t)})()}catch(o){localStorage.removeItem(t),console.log("unable to load form data",o)}}},embedLinks={sites:[{id:"you",rx:/(?:youtu(?:\.be|be\.com)\/(?:.*v(?:\/|=)|(?:.*\/)?)([\w'-]+))/},{id:"vim",rx:/[\w\W]*vimeo\.com\/(?:.*?)([0-9]+)(?:.*)?/},{id:"cob",rx:/[\w\W]*coub\.com\/view\/([\w\W]*)[\w\W]*/}],process:function process(t){var o=null;return _.find(this.sites,function(d){var l=d.rx.exec(t);null!=l&&(o={site:d.id,code:l[1]})}),o}};window.onbeforeunload=ffdata.unload;var catalog={conf:{sortBy:"bumped",layout:"text",respectStickied:!0,showHidden:!0,expandOnHover:!0},saveConfig:function saveConfig(){localStorage.catalogSettings=JSON.stringify(this.conf)},init:function init(){if(localStorage.catalogSettings)try{var t=JSON.parse(localStorage.catalogSettings);_.each(t,function(k,T){this.conf[T]=k},this)}catch(k){console.error("Invalid catalog config"),localStorage.removeItem("catalogSettings")}_.each([["bumped","bumpOrder"],["replied","lastReply"],["timestamp","creationDate"],["reply_count","replyCount"]],function(k){"<option value=\""+k[0]+"\""+(k[0]==this.conf.sortBy?" selected":"")+">"+_l[k[1]]+"</option>"}.bind(this));var d="<div class=\"button-group\" data-select=\"sortBy\">";_.each([["bumped","bumpOrder","bump","i-20"],["timestamp","creationDate","creation","i-20"],["replied","lastReply","reply","i-16in20"],["reply_count","replyCount","replies","i-20"]],function(k){d+="<div class=\"bg-button"+(k[0]==this.conf.sortBy?" bgb-selected":"")+"\" data-val=\""+k[0]+"\" title=\""+_l.sortBy+" "+_l[k[1]]+"\">      <svg class=\"icon "+k[3]+"\"><use xlink:href=\"#i-"+k[2]+"\"></use></svg></div>"}.bind(this)),d+="</div>";var l="<div class=\"button-group"+("bumped"===this.conf.sortBy?"":" disabled")+"\" data-select=\"respectStickied\" id=\"pinControl\">";_.each([[1,"doStick","pin","i-16in20"],[0,"doNotStick","unpin","i-16in20"]],function(k){l+="<div class=\"bg-button"+(k[0]==this.conf.respectStickied?" bgb-selected":"")+"\" data-val=\""+k[0]+"\" title=\""+_l[k[1]]+"\">      <svg class=\"icon "+k[3]+"\"><use xlink:href=\"#i-"+k[2]+"\"></use></svg></div>"}.bind(this)),l+="</div>";var p="<div class=\"button-group\" data-select=\"showHidden\">";_.each([[0,"hideHidden","hide","i-16in20"],[1,"showHidden","unhide","i-16in20"]],function(k){p+="<div class=\"bg-button"+(k[0]==this.conf.showHidden?" bgb-selected":"")+"\" data-val=\""+k[0]+"\" title=\""+_l[k[1]]+"\">      <svg class=\"icon "+k[3]+"\"><use xlink:href=\"#i-"+k[2]+"\"></use></svg></div>"}.bind(this)),p+="</div>";var u="<div class=\"button-group\" data-select=\"layout\">";_.each([["text","smallPics","grid-small","i-20"],["gallery","largePics","gallery-grid","i-20"]],function(k){u+="<div class=\"bg-button"+(k[0]==this.conf.layout?" bgb-selected":"")+"\" data-val=\""+k[0]+"\" title=\""+_l[k[1]]+"\">      <svg class=\"icon "+k[3]+"\"><use xlink:href=\"#i-"+k[2]+"\"></use></svg></div>"}.bind(this)),u+="</div>";var y="<input name=\"subject\" autocomplete=\"false\" class=\"button-group\" type=\"text\" id=\"cat-search\" placeholder=\""+_l.search+"...\" /><input type=\"text\" name=\"FUCKYOUCHROMEFUCKYOU\" style=\"display:none;\"/>";$("#catalog-controls").html(d+l+y+p+u),this.load(),this.conf.expandOnHover&&$("#catalog-contents").addClass("expand-on-hover-enabled"),$("#catalog-contents").on("click",".namedate-overlay",function(){$(this).toggleClass("date-on name-on")}).on("click",".ce-text .bigThumb",function(k){k.stopPropagation(),k.preventDefault();var T=$(this).parents(".cat-entry");T.toggleClass("thumbExpanded")}).on("click",".bigThumb audio, .bigThumb video",function(k){k.stopPropagation()}).on("animationstart webkitAnimationStart MSAnimationStart oanimationstart",function(k){var T=$(k.target);"embed-image-insert"!=k.originalEvent.animationName||T.hasClass("_inserted_")||this.getEmbedThumb(T)}.bind(this)).on("mousedown",".cat-prv",function(k){k.preventDefault(),PostPreviews._mouseover.bind(this)(k)}).on("click",".cat-prv",function(k){k.stopPropagation(),k.preventDefault()}).on("mouseleave",".cat-prv",function(k){PostPreviews._mouseout.bind(this)(k)}).on("click",".i-hide",function(k){var T=$(k.currentTarget),S=T.parents(".cat-entry"),M=S.data("id"),E=_.findIndex(this.model,{id:M}),L=this.model[E];L.hidden=!L.hidden,L.hidden?(T[0].classList.add("hidden-on"),T.html("<use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-unhide\"></use>"),HiddenThreads.hide(M),S.addClass("thread-hidden")):(T[0].classList.remove("hidden-on"),T.html("<use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-hide\"></use>"),HiddenThreads.unhide(M),S.removeClass("thread-hidden")),this.model[E]=L,delete this.rendered[this.conf.layout][M]}.bind(this)),$(".bg-button").click(function(k){var T=$(k.currentTarget);if(!T.hasClass("bgb-selected")){var S=T.parent(),M=T.data("val"),E=S.data("select");S.find(".bg-button").removeClass("bgb-selected"),T.addClass("bgb-selected"),"sortBy"!==E&&"layout"!==E?M=!!M:"bumped"==M?$("#pinControl").removeClass("disabled"):$("#pinControl").addClass("disabled"),this.conf[E]=M,this.saveConfig(),"showHidden"===E?M?$("#catalog-contents").removeClass("hideHidden"):$("#catalog-contents").addClass("hideHidden"):this.build()}}.bind(this)),$("#refresh_catalog").click(function(k){k.preventDefault(),this.load()}.bind(this)),$("#cat-search").on("input",function(){var k=$(this).val().toLowerCase().replace(/\"/,"\\\"");try{injector.remove("cat-search")}catch(T){}k.length?injector.inject("cat-search","#catalog-contents .cat-entry:not([data-search *= \""+k+"\"]) { display:none; }"):injector.remove("cat-search")}).trigger("input")},load:function load(){this.rendered={text:{},gallery:{}},this.model=null,$.getJSON("catalog.json?v="+new Date().getTime()).done(this.build.bind(this)).fail(function(t){throw t})},fileTypes:{image:["jpg","gif","png"],jpgThumb:["webm","cob","vim","you"],iconsAvailable:["swf","mp3","ogg","css","flv"],audio:["mp3","ogg"],embed:["cob","vim","you"]},authorities:["","Admin","Mod","?","God"],formatDate:function formatDate(t,o){"undefined"==typeof o&&(o=!1);var d=new Date(1e3*t),l=this.dateLocal.dows.hasOwnProperty(locale)?this.dateLocal.dows[locale][d.getDay()]:this.dateLocal.dows.en[d.getDay()],p=_.padLeft(d.getFullYear()%100,2,0),u=_.padLeft(d.getMonth()+1,2,0),y="ru"===locale?this.dateLocal.mons.ru[d.getMonth()]:d.getMonth()+1,k=_.padLeft(d.getDate(),2,0),T=_.padLeft(d.getHours(),2,0),S=_.padLeft(d.getMinutes(),2,0),M=_.padLeft(d.getSeconds(),2,0);return(o?"ru"===locale?k+"."+u+"."+p+" \u0432 ":u+"/"+k+"/"+p+" @ ":"ru"===locale?l+" "+k+" "+y+"\u2019"+p+" \u0432 ":u+"/"+k+"/"+p+" ("+l+") @ ")+T+":"+S+":"+M},dateLocal:{dows:{ru:["\u041F\u043D\u0434","\u0412\u0442\u0440","\u0421\u0440\u0434","\u0427\u0442\u0432","\u041F\u0442\u043D","\u0421\u0431\u0442","\u0412\u0441\u043A"],en:["Sun","Mon","Tue","Wen","Thu","Fri","Sat"]},mons:{ru:["\u042F\u043D\u0432","\u0424\u0435\u0432","\u041C\u0430\u0440","\u0410\u043F\u0440","\u041C\u0430\u0439","\u0418\u044E\u043D","\u0418\u044E\u043B","\u0410\u0432\u0433","\u0421\u0435\u043D","\u041E\u043A\u0442","\u041D\u043E\u044F","\u0414\u0435\u043A"]}},build:function build(t){if("undefined"==typeof t&&(t=this.model),!!t){if(_.each(t,function(l,p){_.each(["id","reply_count","bumped","replied","reply_count","timestamp","page","locked","stickied","deleted_timestamp"],function(u){l[u]=~~l[u]}),t[p]=l}),"bumped"===this.conf.sortBy&&this.conf.respectStickied)this.model=_.sortByOrder(t,["stickied","bumped"],["desc","desc"]);else{var o=[this.conf.sortBy];"bumped"!==this.conf.sortBy&&o.push("bumped"),this.model=_.sortByOrder(t,o,_.repeat("desc",o.length))}var d="";_.each(this.model,function(l){d+=this.buildEntry(l)},this),$("#catalog-contents").html(d)}},getEmbedThumb:function getEmbedThumb(t){var o=t.data("site"),d=t.data("id"),p=t.parents(".cat-entry"),u=p.data("id");"cob"==o&&$.get(ku_boardspath+"/corpsy.php?code="+d,function(y){t.replaceWith("<img src=\""+y.thumbnail_url+"\">"),this.rendered[this.conf.layout][u]=p[0].outerHTML}.bind(this)),"vim"==o&&$.get("http://vimeo.com/api/v2/video/"+d+".json",function(y){t.replaceWith("<img src=\""+y[0].thumbnail_medium+"\">"),this.rendered[this.conf.layout][u]=p[0].outerHTML}.bind(this))},buildEntry:function buildEntry(t){if(this.rendered[this.conf.layout].hasOwnProperty(t.id))return this.rendered[this.conf.layout][t.id];if(!t.processed){t.url="/"+this_board_dir+"/res/"+t.id+".html";var L=t.embeds?t.embeds.find(function(I){return"removed"!=I.file})||"removed":null;if(!L||"removed"===L)t.smallThumb="<a href=\""+t.url+"\" class=\"smallThumb\">          <div class=\"nofile-removed ctx\">"+("removed"===L?"\u0423\u0434\u0430\u043B\u0451\u043D":"No File")+"</div></a>";else{if(_.includes(this.fileTypes.image,L.file_type)||_.includes(this.fileTypes.jpgThumb,L.file_type)||_.includes(this.fileTypes.audio,L.file_type)&&0<+L.thumb_w&&0<+L.thumb_h){var I=_.includes(this.fileTypes.image,L.file_type)?L.file_type:"jpg",O=_.includes(this.fileTypes.embed,L.file_type)?L.file_type+"-"+L.file+"-":L.file,P="mp3"==L.file_type?" onerror=\"switchFileType(this)\" extset=\"jpg,png,gif\"":"";t.smallThumb="<a href=\""+t.url+"\" class=\"smallThumb\">            <img src=\"thumb/"+O+"c."+I+"\""+P+"></a>",t.bigThumb="<img src=\"thumb/"+O+"s."+I+"\""+P+">"}else{var l=_.includes(this.fileTypes.iconsAvailable,L.file_type)?"/inc/filetypes/"+L.file_type+".png":"/inc/filetypes/generic"+(_.includes(this.fileTypes.embed,L.file_type)?"-embed":"")+".png",p=_.includes(this.fileTypes.embed,L.file_type)||_.includes(this.fileTypes.audio,L.file_type);t.smallThumb="<a href=\""+t.url+"\" class=\"smallThumb\">            <img src=\""+l+"\"></a>",_.includes(this.fileTypes.audio,L.file_type)&&(t.bigThumb="<audio src=\"src/"+L.file+"."+L.file_type+"\" controls></audio>")}t.bigThumb="<a target=\"_blank\" href=\""+t.url+"\" class=\"bigThumb\">"+t.bigThumb+"</a>"}t.op="<a target=\"_blank\" title=\""+_l.goToThread+"\" target=\"_blank\" href=\""+t.url+"\" class=\"op-number ctx\">#"+t.id+"</a>",t.preview="<a href=\""+t.url+"#"+t.id+"\" class=\"actor cat-prv\">        <svg class=\"icon\"><use xlink:href=\"#i-eye\"></use></svg>      </a>";var u="<svg class=\"icon\"><use xlink:href=\"#i-reply\"></use></svg>      <span class=\"ctx reply-count\">"+t.reply_count+"</span>";t.last_reply&&(u="<a href=\""+t.url+"#"+t.last_reply+"\" class=\"actor cat-prv\">"+u+"</a>");var y="<div class=\"infolabel\">"+u+"</div>",k="<div class=\"infolabel\">        <svg class=\"icon\"><use xlink:href=\"#i-picture\"></use></svg>        <span class=\"ctx image-count\">"+t.images+"</span>      </div>",T="<div class=\"infolabel il-page\">        <a title=\""+_l.threadOnPage+" "+t.page+"\" target=\"_blank\" href=\"/"+this_board_dir+"/"+(0<t.page?t.page+".html":"")+"#"+t.id+"\" class=\"actor\">          <svg class=\"icon\"><use xlink:href=\"#i-page\"></use></svg>          <span class=\"ctx page-number\">"+t.page+"</span>        </a>      </div>";t.countersCombined=y+k+T,t.posterauthority=+t.posterauthority,t.nameDatePriority="date",("name"==localStorage.cat_nameDatePriority||"date"!=localStorage.cat_nameDatePriority&&(t.name||t.tripcode||t.posterauthority))&&(t.nameDatePriority="name");var S=(t.name?"<span class=\"ctx postername\">"+t.name+"</span>":"")+(t.tripcode?"<span class=\"ctx postertrip\">!"+t.tripcode+"</span>":"")+(t.posterauthority?"<span class=\"ctx admin\">&nbsp;##"+this.authorities[t.posterauthority]+"##</span>":"");t.poster="<div class=\"cat-poster\"><span class=\"ctx\">by&nbsp;</span>"+(S||"<span class=\"ctx c-postername\">"+(this_board_defaultName||_l.anonymous)+"</span>")+"</div>";t.date="<div class=\"ctx cat-date cat-date-long\">"+this.formatDate(t.timestamp)+"</div>",t.dateCompact="<div class=\"ctx cat-date cat-date-short\">"+this.formatDate(t.timestamp,1)+"</div>",t.searchData=_.escape(stripHTML(t.subject+" "+t.message).toLowerCase()),t.message=t.message.replace(/\\"/mg,"\""),t.processed=!0,this.model[_.findIndex(this.model,{id:t.id})]=t}t=this.buildIndicators(t);var E=this.layouts[this.conf.layout].bind(this)(t);return this.rendered[this.conf.layout][t.id]=E,E},buildIndicators:function buildIndicators(t){t.hidden=_.includes((localStorage["hiddenThreads."+this_board_dir]||"").split(","),""+t.id);var o=t.stickied?"<svg class=\"foradmin-act icon i-layer-1 i-pin\"><use xlink:href=\"#i-pin\"></use></svg>":"",d=t.locked?"<svg class=\"foradmin-act icon i-layer-1 i-lock\"><use xlink:href=\"#i-lock\"></use></svg>":"",l=t.deleted_timestamp?"<svg class=\"foradmin-act icon i-layer-1 i-deathmark\"><use xlink:href=\"#i-skull\"></use></svg>":"",p="<svg class=\"actor icon i-layer-1 i-hide"+(t.hidden?" hidden-on":"")+"\"><use xlink:href=\"#i-"+(t.hidden?"unhide":"hide")+"\"></use></svg>";return t.indicatorsCombined="<div class=\"indicators\">"+"<svg class=\"actor icon i-burger foradmin-show\"><use xlink:href=\"#i-burger\"></use></svg>"+"<span class=\"i-layer-1\">"+l+o+d+p+"</span><span class=\"i-layer-2\">"+"<svg class=\"actor icon i-layer-2 i-delete foradmin-show\"><use xlink:href=\"#i-x\"></use></svg>"+"<svg class=\"actor icon i-layer-2 i-dnb foradmin-show\"><use xlink:href=\"#i-and\"></use></svg>"+"<svg class=\"actor icon i-layer-2 i-ban foradmin-show\"><use xlink:href=\"#i-ban\"></use></svg>"+"</span></div>",t},layouts:{text:function text(t){return"<div data-id=\""+t.id+"\" class=\"cat-entry ce-text"+(t.hidden?" thread-hidden":"")+"\" data-search=\""+t.searchData+"\">        <div class=\"cat-card\">          <div class=\"ce-heda\">"+t.smallThumb+"<div class=\"cat-infoline ci-op-link\">"+t.op+t.indicatorsCombined+"</div>            <div class=\"cat-infoline namedate-overlay "+t.nameDatePriority+"-on\">"+t.poster+t.date+"</div>            <div class=\"cat-infoline\">"+t.preview+t.countersCombined+"</div>          </div>          <div class=\"ce-opcontent ctx\">            <h5>"+t.subject+"</h5>"+t.message+"</div>        </div>"+t.bigThumb+"</div>"},gallery:function gallery(t){return"<div data-id=\""+t.id+"\" class=\"cat-entry ce-gallery"+(t.hidden?" thread-hidden":"")+"\" data-search=\""+t.searchData+"\">        <div class=\"cat-card\">"+t.bigThumb+"<div class=\"cat-infoline\">            <div class=\"ci-op-link\">"+t.op+"</div>            <div class=\"counters\">"+t.countersCombined+"</div>          </div>          <div class=\"cat-infoline\">"+t.preview+"<div class=\"namedate-overlay "+t.nameDatePriority+"-on\">"+t.poster+t.dateCompact+"</div>"+t.indicatorsCombined+"</div>          <div class=\"ce-opcontent ctx\">            <h5>"+t.subject+"</h5>"+t.message+"</div>        </div>      </div>"}}};function stripHTML(t){var o=document.implementation.createHTMLDocument("New").body;return o.innerHTML=t,o.textContent||o.innerText||""}var unreadCounter={init:function init(t){t||(t=+document.querySelector("meta[property=\"i0:buildtime\"]").content),this.lastvisits=localStorage.lastvisits?JSON.parse(localStorage.lastvisits)||{}:{};var o=this.lastvisits.hasOwnProperty(boardid)?parseInt(this.lastvisits[boardid]):0;o<t&&(this.lastvisits[boardid]=t,localStorage.setItem("lastvisits",JSON.stringify(this.lastvisits)))},update:function update(){this.lastvisits||this.init(),$.ajax({url:"/newpostscount.php",data:this.lastvisits,dataType:"json",success:function success(t){$(".newposts-counter").remove(),$(".got-updates").removeClass("got-updates"),_.each(t,function(o,d){if(0<+o){var l="<span class=\"newposts-counter\">\xA0("+o+")</span>",p=$(".menu-item[href=\"/"+d+"/\"]");p.length&&(p.append(l),$(".sect-exr[data-toexpand=\""+p.parents(".menu-sect").attr("id").split("ms-")[1]+"\"]").parent().addClass("got-updates")),$(".mobile-nav option[value=\""+d+"\"]").append(l)}})}})}},HTMLoader={loadThread:function loadThread(t,o,d,l){var _this4=this;$.get("?"===o?ku_boardspath+"/postbynumber.php?b="+t+"&p="+l:ku_boardspath+"/"+t+"/res/"+o+".html?"+(force_html_nocache?Math.random():"")).then(function(p){var u=p.match(/<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd:[0-9]+\s*?<\/div\s*?>[\s\S]+?<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd-end\s*?<\/div\s*?>/gi).map(function(y){var k=y.match(/<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd:([0-9]+)\s*?<\/div\s*?>([\s\S]+?)<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd-end\s*?<\/div\s*?>/i);return{id:+k[1],body:k[2]}});if("?"===o){var y=p.match(/<!--i0:thrno=([0-9]+)-->/);y&&(o=y[1])}if(u.length){var _y=u.map(function(k){return _this4.cached[t+"_"+k.id]=k.body,k.id});"?"!==o&&(_this4.threadMaps[t+"_"+o]=_y)}d()}).fail(function(p){d(p.status||"null")})},getPost:function getPost(t,o,d,l,p){var _this5=this,u=this.cached[t+"_"+d];if(u)return void l(!1,u);if(!p){var y=!1;if(t===this_board_dir){var k=$("a[name="+d+"]");if(k.length){var T=k.parents(".postnode")[0].outerHTML;this.cached[t+"_"+d]=T,y=!0,l(!1,T)}}y||this.loadThread(t,o,function(k){k?l(k):_this5.getPost(t,o,d,l,!0)},d)}else l(null)},getThread:function getThread(t,o,d,l,p,u){var _this6=this,y=!u&&this.threadMaps[t+"_"+o];y?(d&&(y=y.filter(function(k){return k>d[0]&&k<d[1]})),l(!1,y.reduce(function(k,T){return k+_this6.cached[t+"_"+T]},""))):p?l(null):this.loadThread(t,o,function(k){k?l(k):_this6.getThread(t,o,d,l,!0)})},cached:{},threadMaps:{}};function switchFileType(t){var o=/\.([a-z0-9]+)(?=$|\?)/i,d=t.src.match(o);if(d){var _l2=t.getAttribute("extset").toLowerCase().split(",");if(_l2.length){var _p=_l2.indexOf(d[1].toLowerCase());-1==_p||_p>=_l2.length-1||(t.src=t.src.replace(o,"."+_l2[_p+1]))}}}
//# sourceMappingURL=kusaba.new.js.map