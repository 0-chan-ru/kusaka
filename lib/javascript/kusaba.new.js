"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},style_cookie,style_cookie_txt,style_cookie_site,kumod_set=!1,ispage,is_entering=!1,_messages={en:{noLocalStorage:"Your browser does not support LocalStorage",oops:"Something went wrong...",blankResponse:"blank response",watchlistAdd:"\u0422\u0440\u0435\u0434 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u044B\u0445.",expandingThread:"Expanding thread...",newThread:"new thread",NewThread:"New thread",replyTo:"reply to",cancel:"Cancel",update:"Update",updatingCounts:"Updating...",couldntFetch:"Cold not fetch this post",noNewPosts:"No new posts",replies:"Replies",settings_fxEnabled:"Animation effects",settings_showReplies:"Show replies inside posts",settings_sfwMode:"NSFW mode",settings_expandImgFull:"Expand images to full size",deletePost:"Delete post",deleteAndBan:"Delete post and ban poster",enterCaptcha:"Please enter captcha.",selectText:"Select some text",dcls:"Double click to show source",watchOn:"Watch on",captcharot:"Captcha has rotted",threadUpdationAutomatically:"Tread is being updated automatically.",stopFuckingDolls:"<b>\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u0435 AJAX-\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0443 \u043F\u043E\u0441\u0442\u043E\u0432 \u0438 AJAX-\u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u0440\u0435\u0434\u0430.</b><br />(\u041A\u043B\u0438\u043A\u043D\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u0440\u044B\u0442\u044C)",del:"Delete",delandban:"Delete and ban",ban:"Ban",stickthread:"Stick thread",unstickthread:"Unstick thread",lockthread:"Lock thread",unlockthread:"Unlock thread",returnDesktop:"Switch to desktop interface",returnTouch:"Switch to touch interface",forceDesktop:"Force Desktop interface",okay:"Okay",captchalang:"Captcha language",reply:"Reply",imageDownscaledBy:"Image was downscaled by",videoDownscaledBy:"Video was downscaled by",toFit:"to feet screen",newReplies:"New replies",newThreadsAvailable:"New threads available.",loading:"Loading",anonymous:"Anonymous",sortBy:"Sort by",bumpOrder:"Bump order",lastReply:"Last reply",creationDate:"Creation date",replyCount:"Reply count",doStick:"Respect stickied",showHidden:"Show hidden",doNotStick:"Ignore stickied",hideHidden:"Hide hidden",search:"Search",threadOnPage:"Thread is on page",goToThread:"Go to thread",smallPics:"Small pictures",largePics:"Large pictures",legacyMode:"Legacy mode",threads:"Threads",comments:"Replies",active_since:"Active since",last_active:"Last seen",active_on:"Active on",tryAgain:"Try again",xhrError:"XHR error",details:"details"},ru:{noLocalStorage:"localStorage \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043E\u043C",oops:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A...",blankResponse:"\u043F\u0443\u0441\u0442\u043E\u0439 \u043E\u0442\u0432\u0435\u0442",watchlistAdd:"\u0422\u0440\u0435\u0434 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u0441\u043F\u0438\u0441\u043E\u043A \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u044B\u0445.",watchlistRemove:"\u0422\u0440\u0435\u0434 \u0443\u0434\u0430\u043B\u0435\u043D \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u044B\u0445.",expandingThread:"\u0420\u0430\u0437\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u043C \u0442\u0440\u0435\u0434...",newThread:"\u043D\u043E\u0432\u044B\u0439 \u0442\u0440\u0435\u0434",NewThread:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0442\u0440\u0435\u0434",replyTo:"\u043E\u0442\u0432\u0435\u0442 \u043D\u0430",cancel:"\u041E\u0442\u043C\u0435\u043D\u0430",update:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C",updatingCounts:"\u0418\u0449\u0435\u043C \u043D\u043E\u0432\u044B\u0435 \u043F\u043E\u0441\u0442\u044B...",couldntFetch:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u043F\u043E\u0441\u0442",noNewPosts:"\u041D\u0435\u0442 \u043D\u043E\u0432\u044B\u0445 \u043F\u043E\u0441\u0442\u043E\u0432",replies:"\u041E\u0442\u0432\u0435\u0442\u044B",settings_fxEnabled:"\u0410\u043D\u0438\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u044D\u0444\u0444\u0435\u043A\u0442\u044B",settings_showReplies:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442\u044B \u0432\u043D\u0443\u0442\u0440\u0438 \u043F\u043E\u0441\u0442\u0430",settings_sfwMode:"\u041C\u0430\u043C\u043A\u0430 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",settings_expandImgFull:"\u0420\u0430\u0437\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438 \u0434\u043E \u0438\u0441\u0445\u043E\u0434\u043D\u043E\u0433\u043E \u0440\u0430\u0437\u043C\u0435\u0440\u0430",deletePost:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u0441\u0442",deleteAndBan:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u0441\u0442 \u0438 \u0437\u0430\u0431\u0430\u043D\u0438\u0442\u044C \u043F\u043E\u0441\u0442\u0435\u0440\u0430",enterCaptcha:"\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u0430\u043F\u0447\u0443.",selectText:"\u0422\u0435\u043A\u0441\u0442 \u043D\u0435 \u0432\u044B\u0434\u0435\u043B\u0435\u043D",dcls:"Double click to show source",watchOn:"\u0421\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u043D\u0430",odc:"javascript:LatexIT.replaceWithSrc(this);",captcharot:"\u041A\u0430\u043F\u0447\u0430 \u043F\u0440\u043E\u0442\u0443\u0445\u043B\u0430",threadUpdationAutomatically:"\u0422\u0440\u0435\u0434 \u043E\u0431\u043D\u043E\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438",stopFuckingDolls:"<b>\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u0435 AJAX-\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0443 \u043F\u043E\u0441\u0442\u043E\u0432 \u0438 AJAX-\u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u0440\u0435\u0434\u0430.</b><br />(\u041A\u043B\u0438\u043A\u043D\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u0440\u044B\u0442\u044C)",del:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",delandban:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438 \u0437\u0430\u0431\u0430\u043D\u0438\u0442\u044C",ban:"\u0417\u0430\u0431\u0430\u043D\u0438\u0442\u044C",stickthread:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0442\u0440\u0435\u0434",unstickthread:"\u041E\u0442\u043B\u0435\u043F\u0438\u0442\u044C \u0442\u0440\u0435\u0434",lockthread:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u0442\u0440\u0435\u0434",unlockthread:"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0442\u0440\u0435\u0434",returnDesktop:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C\u0441\u044F \u043D\u0430 \u0434\u0435\u0441\u043A\u0442\u043E\u043F\u043D\u044B\u0439 \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",returnTouch:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C\u0441\u044F \u043D\u0430 \u0442\u0430\u0447-\u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",forceDesktop:"Force Desktop interface",okay:"\u042F\u0441\u043D\u043E",captchalang:"\u042F\u0437\u044B\u043A \u043A\u0430\u043F\u0447\u0438",reply:"\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C",imageDownscaledBy:"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u0443\u0436\u0430\u0442\u0430 \u043D\u0430",videoDownscaledBy:"\u0412\u0438\u0434\u0435\u043E \u0443\u0436\u0430\u0442\u043E \u043D\u0430",toFit:"\u043F\u043E \u0440\u0430\u0437\u043C\u0435\u0440\u0443 \u043E\u043A\u043D\u0430",newReplies:"\u041D\u043E\u0432\u044B\u0445 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",newThreadsAvailable:"\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043D\u043E\u0432\u044B\u0435 \u0442\u0440\u0435\u0434\u044B.",loading:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C",anonymous:"\u0410\u043D\u043E\u043D\u0438\u043C",sortBy:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E",bumpOrder:"\u0431\u0430\u043C\u043F\u0430\u043C",lastReply:"\u0434\u0430\u0442\u0435 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",creationDate:"\u0434\u0430\u0442\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F",replyCount:"\u0447\u0438\u0441\u043B\u0443 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",doStick:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u044F\u0442\u044C",showHidden:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0441\u043A\u0440\u044B\u0442\u044B\u0435",doNotStick:"\u041D\u0435 \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u044F\u0442\u044C",hideHidden:"\u0421\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0441\u043A\u0440\u044B\u0442\u044B\u0435",search:"\u041F\u043E\u0438\u0441\u043A",threadOnPage:"\u0422\u0440\u0435\u0434 \u0440\u0430\u0441\u043F\u043E\u043B\u0430\u0433\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435",goToThread:"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0442\u0440\u0435\u0434",smallPics:"\u041C\u0435\u043B\u043A\u0438\u0435 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438",largePics:"\u0411\u043E\u043B\u044C\u0448\u0438\u0435 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438",legacyMode:"\u041E\u043B\u0434\u0444\u0430\u0436\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C",threads:"\u0422\u0440\u0435\u0434\u043E\u0432",comments:"\u041E\u0442\u0432\u0435\u0442\u043E\u0432",active_since:"\u041F\u0440\u0438\u0441\u043E\u0435\u0434\u0438\u043D\u0438\u043B\u0441\u044F",last_active:"\u0411\u044B\u043B \u0430\u043A\u0442\u0438\u0432\u0435\u043D",active_on:"\u0410\u043A\u0442\u0438\u0432\u0435\u043D \u043D\u0430",tryAgain:"\u041F\u043E\u043F\u0440\u043E\u0431\u043E\u0432\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430",xhrError:"\u041E\u0448\u0438\u0431\u043A\u0430 XHR",details:"\u043F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438"}},_l="undefined"!=typeof locale&&_messages.hasOwnProperty(locale)?_messages[locale]:_messages.ru;function trace(){if(console.log){var I=arguments.callee.caller,P=arguments[0];for(""==P&&(P+="trace()");null!=I;){var N=/function ([^\(]+)/,R=N.exec(I.toString());R=null==R?"":R[1];for(var H=[],G=0;G<I.arguments.length;G++)H.push(I.arguments[G]);R+="("+H.join(", ")+")",P+=" <- "+R,I=I.caller}console.log(P)}}Array.prototype.indexOf||(Array.prototype.indexOf=function(I){var P=this.length,N=+arguments[1]||0;for(N=0>N?Math.ceil(N):Math.floor(N),0>N&&(N+=P);N<P;N++)if(N in this&&this[N]===I)return N;return-1});var Utf8={encode:function encode(I){I=I.replace(/\r\n/g,"\n");for(var R,P="",N=0;N<I.length;N++)R=I.charCodeAt(N),128>R?P+=String.fromCharCode(R):127<R&&2048>R?(P+=String.fromCharCode(192|R>>6),P+=String.fromCharCode(128|63&R)):(P+=String.fromCharCode(224|R>>12),P+=String.fromCharCode(128|63&R>>6),P+=String.fromCharCode(128|63&R));return P},decode:function decode(I){for(var P="",N=0,R=0,G=0,q=0;N<I.length;)R=I.charCodeAt(N),128>R?(P+=String.fromCharCode(R),N++):191<R&&224>R?(G=I.charCodeAt(N+1),P+=String.fromCharCode((31&R)<<6|63&G),N+=2):(G=I.charCodeAt(N+1),q=I.charCodeAt(N+2),P+=String.fromCharCode((15&R)<<12|(63&G)<<6|63&q),N+=3);return P}};function Cookie(I){if(1==arguments.length){var P=new RegExp("(^|;\\s+)"+I+"=(.*?)(;|$)"),N=P.exec(document.cookie);return N&&2<N.length?Utf8.decode(unescape(replaceAll(N[2],"+","%20"))):""}var R=arguments[1],H=arguments[2],G="";if(H){var q=new Date;q.setTime(q.getTime()+1e3*(60*(60*(24*H)))),G="; expires="+q.toGMTString()}document.cookie=I+"="+R+G+"; path=/"}function replaceAll(I,P,N){for(var R=I.indexOf(P);-1<R;)I=I.replace(P,N),R=I.indexOf(P);return I}function insert(I){var P=($("#postclone").length&&"none"!==$("#postclone").css("display")?$("#postclone"):$("#postform")).find("textarea")[0];if(P){if(P.createTextRange&&P.caretPos){var N=P.caretPos;N.text=" "==N.text.charAt(N.text.length-1)?I+" ":I}else if(P.setSelectionRange){var R=P.selectionStart,H=P.selectionEnd;P.value=P.value.substr(0,R)+I+P.value.substr(H),P.setSelectionRange(R+I.length,R+I.length)}else P.value+=I+" ";P.focus()}return"none"===$("#postclone").css("display")&&void 0}function markup(I,P,N,R,H){var G=I.find("textarea").get(0);if(G.selectionStart||"0"==G.selectionStart){G.focus();var q=G.selectionStart,U=G.selectionEnd,W=G.value.substring(q,U);-1===W.indexOf("\n")&&"undefined"!=typeof R&&"undefined"!=typeof H&&(P=R,N=H),G.value=G.value.substring(0,q)+P+G.value.substring(q,U)+N+G.value.substring(U,G.value.length)}else G.value+=P+N}function bullets(I,P,N,R){var H=I.find("textarea"),G=H.get(0),q=G.selectionStart,U=G.selectionEnd,W=H.val().substring(q,U);if(-1===W.indexOf("\n")&&"undefined"!=typeof N&&"undefined"!=typeof R)G.value=G.value.substring(0,q)+N+G.value.substring(q,U)+R+G.value.substring(U,G.value.length);else{W=H.val().substring(q,U).split("\n");for(var z="",V=0;V<W.length;V++)z+=P+W[V],V<W.length-1&&(z+="\n");H.val(H.val().substring(0,q)+z+H.val().substring(U))}}function quote(b,a){var v=eval("document."+a+".message");v.value+=">>"+b+"\n",v.focus()}function checkhighlight(){var I;(I=/#i([0-9]+)/.exec(document.location.toString()))&&!$("#postform textarea").val()&&insert(">>"+I[1]),(I=/#([0-9]+)/.exec(document.location.toString()))&&highlight(I[1])}function highlight(I){if(!isTouch){$(".highlight").removeClass("highlight").addClass("reply"),$("#reply"+I).removeClass("reply").addClass("highlight");var N=/^([^#]*)/.exec(document.location.toString());document.location=N[1]+"#"+I}}function get_password(I){var P=getCookie(I);if(P)return P;var N="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";P="";for(var H,R=0;8>R;R++)H=Math.floor(Math.random()*N.length),P+=N.substring(H,H+1);return Cookie(I,P,365),P}function togglePassword(){var I=$("#passwordbox").html().toLowerCase(),P="<td></td><td></td>";return I==P&&(P="<td class=\"postblock\">Mod</td><td><input type=\"text\" name=\"modpassword\" size=\"28\" maxlength=\"75\">&nbsp;<acronym title=\"Display staff status (Mod/Admin)\">D</acronym>:&nbsp;<input type=\"checkbox\" name=\"displaystaffstatus\" checked>&nbsp;<acronym title=\"Lock\">L</acronym>:&nbsp;<input type=\"checkbox\" name=\"lockonpost\">&nbsp;&nbsp;<acronym title=\"Sticky\">S</acronym>:&nbsp;<input type=\"checkbox\" name=\"stickyonpost\">&nbsp;&nbsp;<acronym title=\"Raw HTML\">RH</acronym>:&nbsp;<input type=\"checkbox\" name=\"rawhtml\">&nbsp;&nbsp;<acronym title=\"Name\">N</acronym>:&nbsp;<input type=\"checkbox\" name=\"usestaffname\"></td>"),$("#passwordbox").html(P).show(),!1}function toggleOptions(){trace("deprecated!")}function getCookie(I){return Cookie(I)}function set_cookie(I,P,N){return Cookie(I,P,N)}var Styles={all:[],titles:[],init:function init(){_.each(document.getElementsByTagName("link"),function(P){-1!=P.getAttribute("rel").indexOf("style")&&P.getAttribute("title")&&(this.all.push(P),this.titles.push(P.getAttribute("title")),-1===P.getAttribute("rel").indexOf("alternate")&&(this._default=P.getAttribute("title")),P.hasAttribute("data-custom")&&(this.custom=P.getAttribute("title")))},this),this.current=this._default;var I=getCookie("bypasscustom");this.customBypass=I.length&&"undefined"!=typeof this_board_dir&&in_array(this_board_dir,I.split("|")),this.initiated=!0},decide:function decide(){this.init();var I=localStorage["testing-css"]||null;if(I){var P=this.addStyle(I);this.setStyle(P);var N=$("<a href=\"#\">\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0442\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 "+P+".css</a>");return N.click(function(H){H.preventDefault(),Styles.quitTest(),$(this).parent().slideUp()}),void(this.$cancelLink=$("<div style=\"font-weight: bold\"></div>").append(N))}if(this.hasOwnProperty("custom")&&!this.customBypass)return this.setCustom();var R=getCookie(style_cookie);R&&in_array(R,this.titles)?this.setStyle(R):(this.setDefault(),set_cookie("kustyle_site",this._default,365),set_cookie("kustyle",this._default,365))},change:function change(I){in_array(I,this.titles)&&this.current!==I&&(this.setStyle(I),this.hasOwnProperty("custom")&&this.custom===I?this.removeBypass():(this.hasOwnProperty("custom")&&this.addBypass(),set_cookie("kustyle_site",I,365),set_cookie("kustyle",I,365)))},removeBypass:function removeBypass(){if(this.customBypass&&"undefined"!=typeof this_board_dir){this.customBypass=!1;var I=getCookie("bypasscustom").split("|"),P=[];_.each(I,function(N){N!==this_board_dir&&P.push(N)}),P=P.length?P.join("|"):"",set_cookie("bypasscustom",P,365)}},addBypass:function addBypass(){if(!(this.customBypass||"undefined"==typeof this_board_dir)){this.customBypass=!0;var I=getCookie("bypasscustom").split("|");in_array(this_board_dir,I)||(I.push(this_board_dir),set_cookie("bypasscustom",I.join("|"),365))}},setDefault:function setDefault(){this.hasOwnProperty("_default")&&this.current!==this._default&&this.setStyle(this._default)},setCustom:function setCustom(){this.hasOwnProperty("custom")&&this.setStyle(this.custom)},setStyle:function setStyle(I){in_array(I,this.titles)&&(scrollAnchor&&scrollAnchor.save&&scrollAnchor.save("setstyle",".postnode",window,"v"),_.each(this.all,function(P){P.disabled=!0,P.getAttribute("title")===I&&(P.disabled=!1)}),scrollAnchor&&scrollAnchor.restore&&scrollAnchor.restore("setstyle"),this.current=I)},onTest:null,addStyle:function addStyle(I){var P=/(?:.+\/)?(.+)\.css/i.exec(I);if(P){var N=_.capitalize(_.escape(P[1]));if(!in_array(N,this.titles)){var R=$("<link rel=\"stylesheet\" type=\"text/css\" href=\""+I+"\" title=\""+N+"\" disabled>");$("head").append(R),this.titles.push(N),this.all.push(R[0])}return N}},testStyle:function testStyle(I){this.onTest=I;var P=this.addStyle(I);this.setStyle(P),popupMessage("\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u0441\u0442\u0438\u043B\u044C "+P+".","none");var N=$("<button>OK</button>").click(this.confirmLongTermTest.bind(this)),R=$("<button>"+_l.cancel+"</button>").click(this.quitTest.bind(this)),H=$("<div class=\"pmsg-form\"></div>").append(N,R);$("#popupMessage").append(H)},confirmLongTermTest:function confirmLongTermTest(){this.onTest&&localStorage.setItem("testing-css",this.onTest)},quitTest:function quitTest(){localStorage.removeItem("testing-css"),this.decide()}};style_cookie&&Styles.decide();function delandbanlinks(I,P){"undefined"==typeof P&&(P=!1);(kumod_set||P)&&"undefined"!=typeof I&&I.find("span[id^=dnb]").each(function(){var H=$(this).attr("id").split("-"),G="&nbsp;<span class=\"btngroup\"><a href=\""+ku_cgipath+"/manage_page.php?action=delposts&boarddir="+H[1]+"&del";G+="y"==H[3]?"thread":"post",G+="id="+H[2]+"\" title=\""+_l.del+"\" onclick=\"return confirm('"+_l.delPost+"?');\"><svg class=\"icon b-icon sb-l\"><use xlink:href=\"#i-x\"></use></svg></a>",G+="<a href=\""+ku_cgipath+"/manage_page.php?action=delposts&boarddir="+H[1]+"&del",G+="y"==H[3]?"thread":"post",G+="id="+H[2]+"&postid="+H[2]+"\" title=\""+_l.delandban+"\" onclick=\"return confirm('"+_l.delPost+"?');\"><svg class=\"icon b-icon sb-c\"><use xlink:href=\"#i-and\"></use></svg></a>",G+="<a href=\""+ku_cgipath+"/manage_page.php?action=bans&banboard="+H[1]+"&banpost="+H[2]+"\" title=\""+_l.ban+"\"><svg class=\"icon b-icon sb-r\"><use xlink:href=\"#i-ban\"></use></svg></a></span>&nbsp;","y"==H[3]&&(G+="<span class=\"btngroup\"><a href=\""+ku_cgipath+"/manage_page.php?action=stickypost&board="+H[1]+"&postid="+H[2]+"\" title=\""+_l.stickthread+"\" ><svg class=\"icon b-icon sb-l\"><use xlink:href=\"#i-pin\"></use></svg></a><a href=\""+ku_cgipath+"/manage_page.php?action=unstickypost&board="+H[1]+"&postid="+H[2]+"\" title=\""+_l.unstickthread+"\" ><svg class=\"icon b-icon sb-r\"><use xlink:href=\"#i-unpin\"></use></svg></a></span>&nbsp;",G+="<span class=\"btngroup\"><a href=\""+ku_cgipath+"/manage_page.php?action=lockpost&board="+H[1]+"&postid="+H[2]+"\" title=\""+_l.lockthread+"\" ><svg class=\"icon b-icon sb-l\"><use xlink:href=\"#i-lock\"></use></svg></a><a href=\""+ku_cgipath+"/manage_page.php?action=unlockpost&board="+H[1]+"&postid="+H[2]+"\" title=\""+_l.unlockthread+"\" ><svg class=\"icon b-icon sb-r\"><use xlink:href=\"#i-unlock\"></use></svg></a></span>"),$(this).html(G)})}var HiddenThreads={list:function list(){if(null==localStorage)return trace(_l.noLocalStorage),[];var I=localStorage.getItem("hiddenThreads."+this_board_dir);return null==I?[]:I.split(",")},isHidden:function isHidden(I){return-1!=HiddenThreads.list().indexOf(I)},hide:function hide(I){if(null==localStorage)alert(_l.noLocalStorage);else{var P=HiddenThreads.list();P.push(I.toString()),localStorage.setItem("hiddenThreads."+this_board_dir,P.join(","))}},unhide:function unhide(I){if(null==localStorage)alert(_l.noLocalStorage);else{var P=HiddenThreads.list(),N=P.indexOf(I.toString());if(-1==N)return;var R=P.slice(0,N);R=R.concat(P.slice(N+1)),localStorage.setItem("hiddenThreads."+this_board_dir,R.join(","))}}};function togglethread(I){return HiddenThreads.isHidden(I)?($("#unhidethread"+I+this_board_dir).slideUp(),$("#thread"+I+this_board_dir).slideDown(),HiddenThreads.unhide(I)):($("#unhidethread"+I+this_board_dir).slideDown(),$("#thread"+I+this_board_dir).slideUp(),HiddenThreads.hide(I)),!1}function toggleblotter(){$(".blotter-entries").each(function(){$(this).slideToggle(function(){$(this).is(":hidden")?Cookie("ku_showblotter","0",365):Cookie("ku_showblotter","1",365)})})}function hideblotter(){$(".blotter-entries").each(function(){$(this).hide()})}function expandthread(I,P,N){N.preventDefault();var R=$("#thread"+I+P);return R.length&&function(){var H=+R.find(".postnode.op").find("input[type=checkbox]").val(),G=+R.find(".postnode:not(.op):first").find("input[type=checkbox]").val(),q=R.find(".omittedposts");q.find("a").hide();var U=q.find("span");U.length||(U=$("<span></span>").prependTo(q)),U.text(_l.loading+"..."),HTMLoader.getThread(P,+I,[H,G],function(W,z){z?(R.find(".omittedposts").replaceWith(z),replyMap.showReplies()):(U.text(_l.oops+(!1===W?"":" ("+W+")")),q.find("a").text(_l.tryAgain).show())})}(),!1}function getnewposts(){var I=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,P=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null===I){if(ispage)return"error";I=$("input[name=replythread]").val()}var N=$(".qrl[data-parent=\""+I+"\"]").last(),R=N.data("postnum")||N.data("parent");if(!R)return"error";var H,G,q;if(!ispage)G=$("#newposts_get"),G.find("a").hide(),q=G.find("span"),q.length||(q=$("<span></span>").prependTo(G)),q.text(_l.loading+"...").show(),H=document.querySelector(".replies");else if(H=document.querySelector("#thread"+I+this_board_dir+" .replies"),!H)return"error";return HTMLoader.getThread(this_board_dir,+I,[+R,Infinity],function(U,W){if(ispage||(q.hide(),G.find("a").show()),W){if(H.insertAdjacentHTML("beforeend",W),P){var z=H.querySelectorAll(".reply"),V="last"==P?z[z.length-1]:Array.prototype.find.call(z,function(Y){return Y.querySelector("a[name=\""+P+"\"]")});if(!V)return"error";var K=V.getBoundingClientRect(),J=document.documentElement.clientHeight;if(K.bottom>J||0>K.top){var Y=K.top+document.documentElement.scrollTop,Z=J-K.height;window.scrollTo(0,Y-(Z?Math.ceil(Z/2):0))}}replyMap.showReplies()}else popupMessage(""===W?_l.noNewPosts:_l.oops+(!1===U?"":" ("+U+")"))},!1,!0),!1}function showLinks(){var P=$(this).attr("href");return $("#directLink").val(ku_boardspath+P),$("#quoteLink").val(">>"+P.split("/res/")[0]+"/"+P.split("#")[1]),$("#viewlink").css({top:$(this).offset().top+$(this).height(),left:$(this).offset().left}).fadeIn("fast"),!1}"pinned"===localStorage.pinPreference&&(localStorage.pinForm=0),"unpinned"===localStorage.pinPreference&&(localStorage.pinForm=1),localStorage.removeItem("pinPreference");var goingExternal=!1;function quickreply(){var P=$(this).data("boardname");P===this_board_dir&&(P=!1);var N=$(this).data("parent"),R=$(this).data("postnum")||N,H=!!+localStorage.pinForm,G="none"===$("#postclone").css("display");return $("#postclone").show(),isTouch?$("#postclone").css({bottom:"0px",left:"0px",position:"fixed",opacity:1}):H?$("#postclone").css({top:$(this).offset().top+$(this).height(),left:Math.round($(window).width()/2-$("#postclone").width()/2),position:"absolute"}):G&&$("#postclone").css({top:$(this).offset().top+$(this).height()-$(document).scrollTop(),left:Math.round($(window).width()/2-$("#postclone").width()/2),position:"fixed"}),$("#postclone input[name=\"replythread\"]").val(N),P?($("#postclone input[name=\"board\"]").val(P),$("#postclone .posttypeindicator").html("<a href=\""+ku_boardspath+"/"+P+"/res/"+N+".html?i#"+R+"\"> &gt;&gt;/"+P+"/"+N+"</a>")):$("#postclone .posttypeindicator").html("<a class=\"xlink\" href=\"#"+R+"\"> &gt;&gt;"+N+"</a>"),insert(">>"+R+"\n"),!1}function getwatchedthreads(I,P){""!=$("#watchedthreadlist").get()&&($("#watchedthreadlist").html(_l.loading+"..."),$.ajax({url:ku_boardspath+"/threadwatch.php?board="+P+"&threadid="+I,success:function success(N){$("#watchedthreadlist").html(N||_l.oops+" ("+_l.blankResponse+")")},error:function error(N,R){$("#watchedthreadlist").html(_l.oops+" ("+R+")")}}))}function popupMessage(I,P){null==P&&(P=1e3),""==$("#popupMessage").get()&&($("body").children().last().after("<div id=\"popupMessage\" class=\"reply postername\"></div>"),$("#popupMessage").hide()),$("#popupMessage").html(I).fadeIn(150),"none"===P?$("#popupMessage").click(function(){$(this).fadeOut(300)}):$("#popupMessage").delay(P).fadeOut(300)}function addtowatchedthreads(I,P){""!=$("#watchedthreadlist").get()&&$.ajax({url:ku_boardspath+"/threadwatch.php?do=addthread&board="+P+"&threadid="+I,success:function success(){popupMessage(_l.watchlistAdd),getwatchedthreads("0",P)},error:function error(N,R){popupMessage(_l.oops+" ("+R+")")}})}function removefromwatchedthreads(I,P){""!=$("#watchedthreadlist").get()&&$.ajax({url:ku_boardspath+"/threadwatch.php?do=removethread&board="+P+"&threadid="+I,success:function success(){popupMessage(_l.watchlistRemove),getwatchedthreads("0",P)},error:function error(N,R){popupMessage(_l.oops+" ("+R+")")}})}function hidewatchedthreads(){Cookie("showwatchedthreads","0",30),$("#watchedthreads").fadeOut()}function showwatchedthreads(){Cookie("showwatchedthreads","1",30),window.location.reload(!0)}var Captcha={init:function init(){$(".captchawrap").click(this.refresh.bind(this)),injector.inject("captcha-rotting",".cw-running .rotting-indicator {\n  -webkit-animation-duration: "+captchaTimeout+"s;\n       -o-animation-duration: "+captchaTimeout+"s;\n          animation-duration: "+captchaTimeout+"s;\n}\n.cw-running .captchaimage, \n.cw-running .rotten-msg {\n  -webkit-animation-delay: "+captchaTimeout+"s;\n       -o-animation-delay: "+captchaTimeout+"s;\n          animation-delay: "+captchaTimeout+"s;}")},refresh:function refresh(){if($(".captchawrap").length){this.shownOnce=!0;var _I=$(".captchawrap").css("color").match(/([0-9]+(?:\.[0-9]+)?)/g);_I=3<=_I.length?"&color="+_I.slice(0,3).join(","):"",$(".captchaimage").attr("src",ku_boardspath+"/captcha.php?"+Math.random()+_I),$(".captchawrap").removeClass("cw-initial cw-running").each(function(){void this.offsetWidth}).addClass("cw-running"),Array.prototype.forEach.call(document.querySelectorAll("input[name=\"captcha\"]"),function(P){return P.value=null})}},refreshOnce:function refreshOnce(){return this.shownOnce||this.refresh(),!1},shownOnce:!1};function checkcaptcha(I){if(0<$("input[name=captcha]").length){if(""==$("#"+I+" input[name=captcha]").val())return popupMessage(_l.enterCaptcha),!1;if(0<+$(".rotten-msg").css("opacity"))return popupMessage(_l.captcharot),!1}return!0}function handleSubmit(I){var P=I.querySelector("input[name=captcha]");return P&&!P.value.length?popupMessage(_l.enterCaptcha):void("postclone"===I.id&&ffdata.save(),Ajax.submitPost(I))}var Ajax={submitPost:function submitPost(I){var P=new FormData(I),N=new XMLHttpRequest;P.append("AJAX",1),N.open("POST",I.action),N.onload=function(){if(200!==N.status)return void popupMessage(_l.xhrError);Captcha.refresh();var H=null;try{H=JSON.parse(N.response)}catch(G){return popupMessage(_l.xhrError),void console.error("Malformed response (JSON expected):",N.response)}if(H.error)return void(H.error_type?("ban"==H.error_type&&popupMessage(H.error+" (<a href=\""+ku_cgipath+"/banned.php\" target=\"_blank\">"+_l.details+"</a>)","none"),"duplicate_file"==H.error_type&&(popupMessage(H.error+"<br>"+H.error_verbose,"none"),I.querySelector("input[name=\"imagefile\"]").value=null)):popupMessage(H.error));resetForm(I),"postclone"==I.id&&$(I).hide();var G=I.querySelector("input[name=\"redirecttothread\"]").checked;if(0==H.thread_replyto)document.location.href=G?ku_boardspath+"/"+H.board+"/res/"+H.post_id+".html":ku_boardspath+"/"+H.board;else if(ispage){var q=getnewposts(H.thread_replyto,+H.post_id);"error"==q&&(document.location.href=ku_boardspath+"/"+H.board+"/res/"+H.thread_replyto+".html")}else getnewposts(null,+H.post_id)},N.send(P)}};function expandimg(I,P,N,R,H,G,q){var U=document.getElementById("thumb"+I);if(null==U)return!1;if("undefined"!=typeof event&&2===event.which)return!0;if("full"!=U.getElementsByTagName("img")[0].getAttribute("alt").substring(0,4)){if($(U).html("<img src=\""+P+"\" alt=\"full"+I+"\" class=\"thumb\" height=\""+H+"\" width=\""+R+"\">"),Settings.expandImgFull())return!1;for(var U=document.getElementById("thumb"+I),W=U.getElementsByTagName("img")[0],z=document.documentElement?document.documentElement.clientWidth:document.body.clientWidth,V=50,K=W;null!=K;)V+=K.offsetLeft,K=K.offsetParent;var J=z-V;if(W.width>J){var Y=W.width/W.height,Z=1-J/W.width,ee=document.createElement("div");ee.setAttribute("class","filesize"),ee.style.textDecoration="underline";var te=document.createTextNode(_l.imageDownscaledBy+" "+Math.round(100*Z)+"% "+_l.toFit);ee.appendChild(te),U.insertBefore(ee,W),$(W).width(J),$(W).height(J/Y)}}else U.innerHTML="<img src=\""+N+"\" alt=\""+I+"\" class=\"thumb\" height=\""+q+"\" width=\""+G+"\">";return!1}var PostPreviews={zindex:3,cached:{},parent:{},_parseURL:function _parseURL(I){var P=I.match(/\/(.+)\/res\/([0-9]+)\.html#([0-9]+)|postbynumber\.php\?b=(.+)&p=([0-9]+)/i);return P?{board:P[1]||P[4],parent:P[2]||"?",post:P[3]||P[5]}:null},_mouseover:function _mouseover(I){var _this=this;I.stopPropagation();var P=this.getAttribute("href"),N=$(this).hasClass("catalog-entry"),R=PostPreviews._parseURL(P);if(!R)return!1;var H=R.board,G=R.parent,q=R.post,U="preview_"+H+"_"+q,W=$("#"+U);0==W.length&&($("body").children().first().before("<div id=\""+U+"\"></div>"),W=$("#"+U),W.addClass("reflinkpreview content-background pre-hidden actual-reflinkpreview"),W.mouseleave(PostPreviews._mouseout),W.mouseover(PostPreviews.onMouseOver));var z=$(this).parents("div[id^=preview]");if(0<z.length){if(U==z.attr("id"))return;for(var V in PostPreviews.parent)if(V==U||PostPreviews.parent[V]==U)return;PostPreviews.parent[U]=z.attr("id")}else PostPreviews.parent=[];var K;I.clientY<$(window).height()/1.5?(W.css({top:I.pageY+5}),K="top "):(W.css({bottom:$(window).height()-I.pageY+5}),K="bottom "),I.clientX<$(window).width()/1.5?(W.css({left:I.pageX+15}),K+="left"):(W.css({right:$(window).width()-I.pageX+15}),K+="right"),W.css({zIndex:PostPreviews.zindex++,"transform-origin":K}),this.style.cursor="progress",HTMLoader.getPost(H,G,q,function(J,Y){W.html(Y?Y:_l.oops+(!1===J?"":" ("+J+")")).removeClass("pre-hidden"),_this.style.cursor="pointer"}),I.preventDefault()},onMouseOver:function onMouseOver(){var I=$(this);if($(this).is("a")){var P=PostPreviews._parseURL(this.getAttribute("href"));if(!P)return;var N=P.board,R=P.post;I=$("#preview_"+N+"_"+R).first()}for(;0<I.length;)clearTimeout(I[0].fadeout),I=$("#"+PostPreviews.parent[I.attr("id")])},_mouseout:function _mouseout(){var I=$(this);if($(this).is("a")){this.predelay&&clearTimeout(this.predelay);var P=PostPreviews._parseURL(this.getAttribute("href"));if(!P)return;var N=P.board,R=P.post;I=$("#preview_"+N+"_"+R).first()}for(var _loop=function(){clearTimeout(I[0].fadeout);var P=I;I[0].fadeout=setTimeout(function(){P.addClass("pre-hidden"),setTimeout(function(){delete PostPreviews.parent[P.attr("id")],P.remove()},PostPreviews._timings.transition)},PostPreviews._timings.fade),I=$("#"+PostPreviews.parent[I.attr("id")])};0<I.length;)_loop()},_timings:{predelay:50,transition:200,fade:400}};function postpreview(){}function set_inputs(I){var P=document.getElementById(I);if(P){var N=P.querySelector("input[name=name]");N&&!N.value&&(N.value=getCookie("name")),P.em.value||(P.em.value=getCookie("email")),P.postpassword.value||(P.postpassword.value=get_password("postpassword"))}}function set_delpass(I){var P=document.getElementById(I).postpassword;P&&!P.value&&(P.value=get_password("postpassword"))}(function(I){I.event.special.load={add:function add(P){1===this.nodeType&&"img"===this.tagName.toLowerCase()&&""!==this.src&&(this.complete||4===this.readyState?P.handler.apply(this):"uninitialized"===this.readyState&&0===this.src.indexOf("data:")?I(this).trigger("error"):I(this).bind("load",P.handler))}}})(jQuery);var Settings={_checkbox:function _checkbox(I,P,N){return null==localStorage?void trace(_l.noLocalStorage):(null==localStorage[P]&&(localStorage[P]=N),!0==I?localStorage[P]=$("#settings_"+P).is(":checked"):"true"==localStorage[P]?$("#settings_"+P).attr("checked","checked"):$("#settings_"+P).removeAttr("checked"),"true"==localStorage[P]||!0==localStorage[P])},fxEnabled:function fxEnabled(I){var P=Settings._checkbox(I,"fxEnabled",!0);return null!=I&&($.fx.off=!P),P},showReplies:function showReplies(I){var P=Settings._checkbox(I,"showReplies",!1);return null!=I&&(scrollAnchor.save("replymap",".postnode",window,"v"),P?(replyMap.showReplies(),injector.remove("hide-replies")):injector.inject("hide-replies",".replieslist {display: none}"),scrollAnchor.restore("replymap")),P},sfwMode:function sfwMode(I){var P=Settings._checkbox(I,"sfwMode",!1);return P?injector.inject("sfwMode",".thumb { opacity: 0.05;} .thumb:hover { opacity: 1;}"):injector.remove("sfwMode"),P},expandImgFull:function expandImgFull(I){return Settings._checkbox(I,"expandImgFull",!1)}},rswap={i:!0,swap:function swap(){this.i?$("#delform").before($("#rswapper")).after($(".postarea")):$("#delform").before($(".postarea")).after($("#rswapper")),this.i=!this.i}},isTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||!1;"desktop"==localStorage.interfaceType&&(isTouch=!1),"touch"==localStorage.interfaceType&&(isTouch=!0);var captchalang=getCookie("captchalang")||"ru";function setCaptchaLang(I){in_array(I,["ru","en","num"])&&(captchalang=I,set_cookie("captchalang",I,365))}function readyset(){if(ispage||$(".mgoback").show(),isTouch?$("#js_settings").prepend("<a href=\"javascript: localStorage.setItem('interfaceType', 'desktop'); location.reload();\">"+_l.returnDesktop+"</a><br>"):$("#js_settings").prepend("<a href=\"javascript: localStorage.setItem('interfaceType', 'touch'); location.reload();\">"+_l.returnTouch+"</a><br>"),$("#js_settings").prepend(_l.captchalang+": <a href=\"javascript:setCaptchaLang('ru');\">Cyrillic</a> | <a href=\"javascript:setCaptchaLang('en');\">Latin</a> | <a href=\"javascript:setCaptchaLang('num');\">Numeral</a><br />"),Styles.$cancelLink&&$("#js_settings").prepend(Styles.$cancelLink),LatexIT.init(),checkhighlight(),checkgotothread(),checknamesave(),bnrs.init(),cloud20.init(),$("#boardselect").on("input",function(){cloud20.filter($(this).val())}),getCookie("ku_menutype")){var I=Cookie("ku_menutype");"default"!=I&&""!=I&&(document.getElementById("overlay_menu").style.position=I)}if(processNodeInsertion(),isTouch?($("body").addClass("touch-mode"),$(".sect-exr:not([data-toexpand=\"_options\"])").parent().hide(),$(".sect-exr").click(function(){return $("#js_settings").is(":visible")?menu_show("_off_"):menu_show("ms-_options"),!1}),$("body").click(function(){menu_show("_off_"),$("[id^=preview]").remove()}),$(".mobile-nav").show(),$("body").on("click","a[class^='ref']",PostPreviews._mouseover),injector.inject("mb","body {margin-bottom: 350px;}")):($(".mobile-nav").hide(),$(".sect-exr").mouseenter(function(){menu_show("ms-"+$(this).data("toexpand"))}),$("#overlay_menu").mouseleave(function(){menu_show("_off_")}),$("body").on("mouseenter","a[class^='ref']",function(G){var _this2=this;this.predelay=setTimeout(function(){return PostPreviews._mouseover.bind(_this2)(G)},PostPreviews._timings.predelay)}),$("body").on("mouseleave","a[class^='ref']",PostPreviews._mouseout)),$("body").on("click",".uib-mup",function(){return markup($(this).parents("form"),$(this).data("mups"),$(this).data("mupe"),$(this).data("imups"),$(this).data("imupe")),!1}),$(".opt-exp").click(function(){$(this).find(".expandee").toggleClass("expanded")}).mouseleave(function(){$(this).find(".expandee").removeClass("expanded")}),$(".code_markup_select").change(function(){markup($(this).parents("form"),"[code="+$(this).val()+"]","[/code]")}),$("body").on("click",".uib-bul",function(){return bullets($(this).parents("form"),$(this).data("bul"),$(this).data("imups"),$(this).data("imupe")),!1}),$("body").on("click",".uib-tx",function(){var G=$(this).data("target");return head.js("http://latex.codecogs.com/editor3.js",function(){OpenLatexEditor(G,"phpBB","en-us",!1,"","full")}),!1}),$("body").on("click",".movie",function(G){expandwebm($(this),G)}),$("body").on("click",".qrl",quickreply),$("#postclone label").each(function(){var G=$(this).attr("for")+"_clone";$(this).attr("for",G),$(this).find("input").attr("id",G)}),$("#postform textarea").attr("id","top-textarea"),$("#postform .uib-tx").data("target","top-textarea"),$("#postclone textarea").attr("id","pop-textarea"),$("#postclone .uib-tx").data("target","pop-textarea"),!isTouch){$("input, textarea, select, label").hover(function(){$("#postclone").dragsOff()},function(){$("#postclone").drags()});var P=+localStorage.pinForm?"pinned":"unpinned",N="<a href=\"#\" class=\"pinner "+P+"\" onclick=\"javascript:$('#postclone').pin();return false;\" title=\"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C / \u041E\u0442\u043A\u0440\u0435\u043F\u0438\u0442\u044C\"><svg class=\"icon b-icon\"><use class=\"use-pin\" xlink:href=\"#i-pin\"></use><use class=\"use-unpin\" xlink:href=\"#i-unpin\"></use></svg></a>"}else var N="";if(ffdata.load(),$("<span class=\"extrabtns postboxcontrol\">"+N+"&nbsp;<a href=\"#\" onclick=\"javascript:$('#postclone').hide();return false;\" title=\"\u0417\u0430\u043A\u0440\u044B\u0442\u044C\"><svg class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a></span>").appendTo("#postclone"),$("body").on("submit","#postform, #postclone",function(G){G.preventDefault(),handleSubmit(this)}),$("#delform").after("<div id=\"rswapper\">[<a onclick=\"javascript:rswap.swap();return false;\" href=\"#\">"+(ispage?_l.NewThread:_l.reply)+"</a>]<hr /></div>"),Settings.sfwMode(!1),localStorage)for(var R in Settings)"_"!=R.substring(0,1)&&($("#js_settings").append("<label><input type=\"checkbox\" onchange=\"javascript:Settings."+R+"(true)\" name=\"settings_"+R+"\" id=\"settings_"+R+"\" value=\"true\"> "+_l["settings_"+R]+"</label><br />"),Settings[R](!1));else $("#js_settings").append("<span style=\"color:#F00\">"+_l.noLocalStorage+"</span><br />\u0422\u0432\u043E\u0439 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u2014 \u0433\u043E\u0432\u043D\u043E. \u0421\u043A\u0430\u0447\u0430\u0439 <a href=\"/web/20110329072959/http://google.com/chrome\" target=\"_blank\">Chome</a>, \u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440.");var H=document.getElementById("message");H&&(H.onfocus=function(){is_entering=!0},H.onblur=function(){is_entering=!1}),$("body").on("click",".posttypeindicator a",function(){var G=$(this),q=$("[name=\""+G.attr("href").substr(1)+"\"]").offset()||$("[name=\""+G.text().split(">>")[1]+"\"]").offset()||!1;return q&&$("html, body").animate({scrollTop:q.top-($("#overlay_menu").height()+10)},250),!1}),$("body").on("click",".dice",function(){"undefined"==typeof $(this).data("html")&&$(this).data("html",$(this).html());var G=strip($(this).html());$(this).html($(this).attr("title")),$(this).attr("title",G)}),$("<div id=\"viewlink\"></div>").addClass("content-background reflinkpreview qreplyform").html("<a style=\"float:left;\" href=\"#\" onclick=\"javascript:$('#viewlink').hide();return false;\"><svg style=\"margin-left:0\" class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a><div style=\"display:inline-block\"><input type=\"text\" id=\"directLink\"><br /><input type=\"text\" id=\"quoteLink\"></div>").hide().appendTo("body"),$("body").on("click",".shl",showLinks),$("#directLink, #quoteLink").on("click",function(){$(this).select()}),$("body").on("click",".embed",function(){$(this).unwrap()}),$(document).on("animationstart webkitAnimationStart MSAnimationStart oanimationstart",function(G){var q=$(G.target);"nodeInserted"!=G.originalEvent.animationName||q.hasClass("_inserted_")||processNodeInsertion(q)}),$("body").on("mouseenter","._country_",function(){"undefined"==typeof $(this).attr("title")&&$(this).attr("title",countries[$(this).attr("src").split("flags/")[1].split(".png")[0].toUpperCase()])}),dcxt.performTasks(),$("body").on("click",".audiowrap",function(G){G.preventDefault();var q=$(this).attr("href");$(this).replaceWith("<audio src=\""+q+"\" controls autoplay=\"true\"></audio>")}),$("input[name=embed]").on("input",function(){var G=embedLinks.process($(this).val());G&&$(this).val(G.code).parents(".postform").find("[name=embedtype]").val(G.site)}),"undefined"!=typeof is_catalog&&is_catalog&&catalog.init(),$(".userdelete").addClass("content-background reflinkpreview"),$("body").on("change","input[name=\"post[]\"]",function(){$(".userdelete").hasClass("ud-active")?!$("input[name=\"post[]\"]").is(":checked")&&$(".userdelete").removeClass("ud-active"):$(".userdelete").addClass("ud-active")}),$("<div id=\"tripinfo\"></div>").addClass("content-background reflinkpreview qreplyform").hide().appendTo("body"),$("#delform").on("click",".postertrip",function(G){G.preventDefault();var q=$(this).text().split("!")[1],U=$(this).offset(),W=$(this).height();$.getJSON("/tripinfo.php",{trip:q}).done(function(z){var V=[];_.each(z.active_on,function(K){V.push("<a target=\"_blank\" href=\""+ku_boardspath+"/"+K+"/\">/"+K+"/</a>")}),$("#tripinfo").html("<div><b class=\"postertrip\">!"+q+"</b> [<a href=\"https://www.google.com/search?q=!"+q+"\" target=\"_blank\">G</a>]</div><a style=\"float:left;\" href=\"#\" onclick=\"javascript:$('#tripinfo').hide();return false;\"><svg style=\"position: absolute; top: 3px; right: 3px;\" class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a><div class=\"trip-info-line\">"+_l.threads+": "+z.threads+", "+_l.comments+": "+z.comments+"</div><div class=\"trip-info-line\">"+_l.active_since+": "+catalog.formatDate(z.active_since,!0)+"</div><div class=\"trip-info-line\">"+_l.last_active+": "+catalog.formatDate(z.last_active,!0)+"</div>"+(V.length?"<div class=\"trip-info-line\">"+_l.active_on+": "+V.join(", ")+"</div>":"")).css({top:U.top+W,left:U.left}).fadeIn("fast")}).fail(function(z){console.error(z)})}),$("body").on("click",".csswrap",function(G){G.preventDefault();var q=$(this).attr("href");Styles.testStyle(q)}),$("input[name=disable_name]").on("change",function(){var G=$(this).is(":checked");$(this).parents("form").find("input[name=name]").attr("disabled",G),localStorage.setItem("post_anonymously",+G)}).prop("checked",!!+localStorage.post_anonymously).trigger("change"),unreadCounter.update(),Captcha.init()}function processNodeInsertion(I){"undefined"==typeof I?I=$("*"):(I.addClass("_inserted_"),I=I.parents(":eq(1)")),I.find(".prettyprint").length&&prettyprint_mod(null,I[0]),LatexIT.render(I),processEmbeds(I),delandbanlinks(I)}var dcxt={tries:10,enabled:!1,tasks:[],changed:0,openSettings:function openSettings(){$("#de-content-cfg").length||(injector.inject("dcxt-hide","#de-content-cfg {opacity: 0!important}"),$("#de-btn-settings")[0].click())},closeSettings:function closeSettings(){$("#de-content-cfg").length&&($("#de-btn-settings")[0].click(),injector.remove("dcxt-hide"))},addTask:function addTask(I){this.enabled?I():this.tasks.push(I)},performTasks:function performTasks(){!this.enabled&&$("#de-btn-settings").length?(this.enabled=!0,$("#gotothread").prop("checked",!0),_.each(this.tasks,function(I){I()}),this.tasks=[],this.changed&&location.reload()):this.tries&&(setTimeout(function(){dcxt.performTasks()},500),this.tries--)}},updater={ajaxPosting:!1,newThreads:[],showNewThreads:function showNewThreads(){$("#wild_thread_appeared").remove(),_.each(this.newThreads,function(I){$.get(ku_boardspath+"/read.php?b="+this_board_dir+"&t="+this_board_dir+"&p="+I+"&single&replink=1",function(P){$("#delform").prepend(P+"<br clear=\"lesuft\" /><hr />")})}),this.newThreads=[]},update:function update(I){_typeof(I.token)!==void 0&&($("input[name=token][value="+I.token+"]").length?(clearfields($("input[name=token][value="+I.token+"]").parents("form")),!this.ajaxPosting&&getnewposts()):getnewposts());var P=localStorage.lastvisits?JSON.parse(localStorage.lastvisits)||{}:{};"undefined"!=typeof I.timestamp&&(P[boardid]=I.timestamp,localStorage.setItem("lastvisits",JSON.stringify(P)))},bpageNotify:function bpageNotify(I){if(!$("input[name=token][value="+I.token+"]").length)if("newthreads"==I.room){if(dcxt.enabled)return;updater.newThreads.push(I.newthread),$("#wild_thread_appeared").length||$(".postarea").after("<a class=\"xlink\" href=\"javascript:updater.showNewThreads();return false;\" id=\"wild_thread_appeared\">"+_l.newThreadsAvailable+"<hr /></a>")}else{var P=$("[id^=replies"+I.room+"]");P.find(".fresh-replies").text(_l.newReplies+": "+(+P.find(".fresh-replies").text().split(":")[1]+1)).length||P.append("<a href=\"/"+this_board_dir+"/res/"+I.room+".html\" class=\"xlink fresh-replies\">"+_l.newReplies+": 1</a>").find(".fresh-replies").click(function(N){N.preventDefault();var R=$(this),H=/\d+/.exec(P.find(".reply").last().attr("id"));$.ajax({url:ku_boardspath+"/expand.php?after="+H+"&board="+this_board_dir+"&threadid="+I.room,success:function success(G){G?(P.append($(G)),replyMap.showReplies()):popupMessage(_l.noNewPosts),R.remove()},error:function error(G,q){popupMessage(_l.oops+" ("+q+")")}})})}},send:function send(I){return this.ajaxPosting||xsend(I.attr("id")),!1}};function strip(I){var P=document.createElement("DIV");return P.innerHTML=I,P.textContent||P.innerText||""}function processEmbeds(I){I.find(".embed:not(.title-given)").each(function(){var P=$(this),N=P.data("id");"youtube"===P.data("site")&&($.get("https://www.googleapis.com/youtube/v3/videos?part=id%2Csnippet&id="+N+"&key="+ku_youtube_apikey,function(R){if(!R.error&&R.items.length){var H=R.items[0].snippet.title;P.append($("<a target=\"_blank\" title=\""+_l.watchOn+" Youtube\"></a>").addClass("yt-title-overlay").text(H).attr("href","http://www.youtube.com/watch?v="+N).click(function(G){G.stopPropagation()}))}}),P.addClass("title-given")),"vimeo"===P.data("site")&&($.get("http://vimeo.com/api/v2/video/"+N+".json",function(R){var H=R[0].title,G=R[0].thumbnail_large;P.css({"background-image":"url("+G+")"}).append($("<a target=\"_blank\" title=\""+_l.watchOn+" Vimeo\"></a>").addClass("vi-title-overlay").text(H).attr("href","http://vimeo.com/"+N).click(function(q){q.stopPropagation()}))}),P.addClass("title-given")),"coub"===P.data("site")&&($.get(ku_boardspath+"/corpsy.php?code="+N,function(R){var H=R.title,G=R.thumbnail_url;P.css({"background-image":"url("+G+")"}).append($("<a target=\"_blank\" title=\""+_l.watchOn+" Coub\"></a>").addClass("co-title-overlay").text(H).attr("href","http://coub.com/view/"+N).click(function(q){q.stopPropagation()}))}),P.addClass("title-given"))})}var kumod=getCookie("kumod");""!==kumod&&("allboards"===kumod?kumod_set=!0:kumod_set=in_array(this_board_dir,kumod.split("|")));var mp3playerid=0;function expandmp3(I,P){mp3playerid==I?(document.getElementById("player"+I).innerHTML="",document.getElementById("player"+I).style.display="none",mp3playerid=0):(0!=mp3playerid&&(document.getElementById("player"+mp3playerid).innerHTML="",document.getElementById("player"+mp3playerid).style.display="none"),document.getElementById("player"+I).innerHTML="<embed src=\"/web/20110329072959/http://www.0chan.ru/mediaplayer.swf?type=mp3&file="+P+"\" width=\"320\" height=\"20\">",document.getElementById("player"+I).style.display="block",mp3playerid=I)}var swfplayerid=0;function expandswf(I,P,N,R){swfplayerid==I?(document.getElementById("swfplayer"+I).innerHTML="",document.getElementById("swfplayer"+I).style.display="none",swfplayerid=0):(0!=swfplayerid&&(document.getElementById("swfplayer"+swfplayerid).innerHTML="",document.getElementById("swfplayer"+swfplayerid).style.display="none"),document.getElementById("swfplayer"+I).innerHTML="<embed src=\""+P+"\" width=\""+N+"\" height=\""+R+"\">",document.getElementById("swfplayer"+I).style.display="block",swfplayerid=I)}function expandwebm(I,P){if("1"!==I.data("expanded")){P.preventDefault();var N=I.attr("href"),R=I.data("height"),H=I.data("width"),G=I.data("thumb"),q=I.data("id"),U="_vframe_"+makeid()+new Date().getTime();I.replaceWith(function(){return"<span id=\""+U+"\" data-thumb=\""+G+"\" data-width=\""+H+"\"\" data-height=\""+R+"\" data-href=\""+N+"\">"+this.innerHTML+"</span>"}),I=$("#"+U),I.find("img").hide();var W=I.find("video").show(),z="";if(W.length?W.get(0).play():I.find("span").append("<video class=\"thumb\" src=\""+N+"\" controls loop autoplay height=\""+R+"\" width=\""+H+"\"></video>").promise().done(function(){W=I.find("video")}),!Settings.expandImgFull()){for(var V=50,K=W[0],J=document.documentElement?document.documentElement.clientWidth:document.body.clientWidth;null!=K;)V+=K.offsetLeft,K=K.offsetParent;var Y=J-V;if(H>Y){W.width(Y),W.height(Y/(H/R)),z=_l.videoDownscaledBy+" "+Math.round(100*(1-Y/H))+"% "+_l.toFit}}I.parent().find(".filesize").append("<span class=\"videocloser\"><b> [<a href=\"#\"> x </a>]</b> "+z+"</span>"),I.parent().find(".videocloser").click(function(){var te="_vframe_"+makeid()+new Date().getTime();return I.replaceWith(function(){return"<a class=\"movie\" id=\""+te+"\" data-thumb=\""+G+"\" data-width=\""+H+"\"\" data-height=\""+R+"\" href=\""+N+"\">"+this.innerHTML+"</a>"}).data("expanded","0"),I=$("#"+te),I.find("video").hide()[0].pause(),I.find("img").show(),$(this).remove(),!1})}}function makeid(){for(var I="",P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",N=0;5>N;N++)I+=P.charAt(Math.floor(Math.random()*P.length));return I}function checknamesave(){var I=""!=getCookie("name");var P=document.getElementById("save");null!=P&&(P.checked=I)}function checkgotothread(){var I;I=!("on"!=getCookie("tothread")),$("#gotothread").attr("checked",I)}function navigatepages(I){if(document.getElementById&&!is_entering&&(window.event&&(I=window.event),I.ctrlKey)){var P=null,N=null,R=document.location.toString();if(-1!=R.indexOf("/res/"))13==(I.keyCode?I.keyCode:I.which?I.which:null)&&$("textarea[name=\"message\"]:focus").parents("form").submit();else{if(-1==R.indexOf(".html")||-1!=R.indexOf("board.html"))var H=0,G=R.substr(0,R.lastIndexOf("/")+1);else{var H=R.substr(R.lastIndexOf("/")+1);H=+H.substr(0,H.indexOf(".html"));var G=R.substr(0,R.lastIndexOf("/")+1)}if(0==H)var q=G;else var q=G+H+".html";var V;if(V=/#s([0-9]+)/.exec(R))var U=+V[1];else var U=-1;for(var W=0;0<document.getElementsByName("s"+ ++W).length;);switch(I.keyCode?I.keyCode:I.which?I.which:null){case 13:$("textarea[name=\"message\"]:focus").parents("form").submit();break;case 37:P=document.getElementById("prevPage");break;case 39:P=document.getElementById("nextPage");break;case 40:if(U==W-1)break;else var z=U+1;N=q+"#s"+z;break;case 38:if(-1==U||0==U)break;else var z=U-1;N=q+"#s"+z;break;case 36:document.location=G;}P&&P.action&&(document.location=P.action),N&&(document.location.href=N)}}}window.document.addEventListener?window.document.addEventListener("keydown",navigatepages,!1):window.document.attachEvent("onkeydown",navigatepages),NodeList.prototype.forEach=Array.prototype.forEach;var replyMap={showReplies:function showReplies(I){var _this3=this;(I||document).querySelectorAll(".postnode").forEach(function(P){var N=P.querySelector(".reflink a:last-child").innerHTML,R=P.querySelector(".postmessage"),H=P.querySelector(".replieslist");_this3.posts[N]?_this3.posts[N].container=H:_this3.posts[N]={container:H,replies:[]};var G=R.querySelectorAll("a[class^=ref\\|"+this_board_dir+"]");G.length&&G.forEach(function(q){var U=q.className.split(" ")[0].split("|"),W=U[3],z=""===U[2]?ku_boardspath+"/postbynumber.php?b="+U[1]+"&p="+U[3]:"/"+U[1]+"/res/"+U[2]+".html#"+N,V="<a class=\"ref-reply\" href=\""+z+"\" onclick=\"javascript:highlight('"+N+"', true);\">&gt;&gt;"+N+"</a>";_this3.posts[W]?!_.includes(_this3.posts[W].replies,V)&&_this3.posts[W].replies.push(V):_this3.posts[W]={replies:[V]},_this3.posts[W].skip=!1})}),_.each(this.posts,function(P){!P.skip&&P.replies.length&&P.container&&(P.container.innerHTML="<br>"+_l.replies+": "+P.replies.join(", "),P.skip=!0)})},posts:{}},scrollAnchor={save:function save(I,P,N,R){N=N||window,R=R||"vh";var H=[window.innerWidth/2,window.innerHeight/2],G=[],q=N==window?{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight}:N.getBoundingClientRect();N!=window&&(0>=q.left&&0>=q.right||0>=q.top&&0>=q.bottom||q.left>=window.innerWidth||q.top>=window.innerHeight)&&(H=[q.left+q.width/2,q.top+q.height/2]);var U=(N==window?document:N).querySelectorAll(P);if(U.length){U.forEach(function(V){var K=V.getBoundingClientRect(),J=Math.pos(K.width-(Math.pos(q.left-K.left)+Math.pos(K.right-q.right)))/K.width,Y=Math.pos(K.height-(Math.pos(q.top-K.top)+Math.pos(K.bottom-q.bottom)))/K.height,Z=Math.abs(H[0]-(K.left+K.width/2)),Q=Math.abs(H[1]-(K.top+K.height/2));G.push({el:V,primaryVisibility:"h"==R[0]?J:Y,secondaryVisibility:"v"==R[0]?J:Y,primaryOffset:"h"==R[0]?Z:Q,secondaryOffset:"v"==R[0]?Z:Q})}),G.sort(function(V,K){return K.primaryVisibility===V.primaryVisibility?1<R.length&&K.secondaryVisibility!==V.secondaryVisibility?K.secondaryVisibility-V.secondaryVisibility:V.primaryOffset===K.primaryOffset?1<R.length?V.secondaryOffset-K.secondaryOffset:void 0:V.primaryOffset-K.primaryOffset:K.primaryVisibility-V.primaryVisibility});var _W=G[0].el,_z=_W.getBoundingClientRect();this.saved[I]={anchor:_W,left:_z.left,top:_z.top,parent:N,dimensions:R}}},restore:function restore(I){var P=this.saved[I];P&&window.requestAnimationFrame(function(){var N=P.anchor.getBoundingClientRect();P.parent.scrollBy(-1===P.dimensions.indexOf("h")?0:N.left-P.left,-1===P.dimensions.indexOf("v")?0:N.top-P.top)})},saved:{}};Math.pos=function(I){return 0<=I?I:0},function(){for(var I=0,P=["ms","moz","webkit","o"],N=0;N<P.length&&!window.requestAnimationFrame;++N)window.requestAnimationFrame=window[P[N]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[P[N]+"CancelAnimationFrame"]||window[P[N]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(R){var G=new Date().getTime(),q=Math.max(0,16-(G-I)),U=window.setTimeout(function(){R(G+q)},q);return I=G+q,U}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(R){clearTimeout(R)})}();var menu_current="",menu_last="";function menu_show(I){if(""!=menu_current){var P="_off_"==I?125:0;$("#"+menu_current).delay(P).slideUp(100),menu_last=menu_current}""!=I&&(menu_last==I&&"undefined"!=typeof $("#"+I).queue()&&0<$("#"+I).queue().length?$("#"+I).clearQueue():$("#"+I).slideDown(150)),menu_current=I}function menu_pin(){"absolute"==document.getElementById("overlay_menu").style.position?(document.getElementById("overlay_menu").style.position="fixed",Cookie("ku_menutype","fixed",365)):(document.getElementById("overlay_menu").style.position="absolute",Cookie("ku_menutype","absolute",365))}function set_oldmenu(I){I&&Cookie("ku_oldmenu","yes",90);var P=document.getElementById("boardlist_header"),N=document.getElementById("boardlist_footer");P&&N&&(P.innerHTML=N.innerHTML+" <a href=\"#\" onclick=\"javascript:set_cookie('ku_oldmenu', 'no', 90);parent.document.location.reload(true);\">[overlay]</a>")}var LatexIT={mode:"gif",init:function init(){document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(this.mode="svg")},odc:"javascript:LatexIT.replaceWithSrc(this);",dcls:"Double click to show source",pre:function pre(eqn){var txt=eqn.innerHTML;if(!txt.match(/<img.*?>/i)&&!txt.match(/<object.*?>/i)){txt=txt.replace(/<br>/gi,"").replace(/<br \/>/gi,"").replace(/&amp;/mg,"&");var atxt="[tex]"+txt+"[/tex]";txt=escape(txt.replace(/\\/mg,"\\"));var c=eval("LatexIT.normalize"+$(eqn).parent().css("color")),extxt="{\\color[rgb]{"+c.r+","+c.g+","+c.b+"}"+txt+"}";txt=" <img src=\"http://latex.codecogs.com/"+this.mode+".latex?"+extxt+"\" title=\""+this.dcls+"\" alt=\""+atxt+"\" ondblclick=\""+this.odc+"\" border=\"0\" class=\"latex\" /> "}return txt},replaceWithSrc:function replaceWithSrc(I){var P=$(I).attr("alt");$(I).parent().html(P)},render:function render(I){for(var P="undefined"==typeof I?window.document:I[0],N=P.getElementsByTagName("*"),R=0;R<N.length;R++)("latex"==N[R].getAttribute("lang")||"latex"==N[R].getAttribute("xml:lang"))&&(N[R].innerHTML=this.pre(N[R]))},normalizergb:function normalizergb(I,P,N){return{r:(I/255).toFixed(3),g:(P/255).toFixed(2),b:(N/255).toFixed(2)}},normalizergba:function normalizergba(I,P,N){return this.normalizergb(I,P,N)}};function in_array(I,P){return"object"==("undefined"==typeof P?"undefined":_typeof(P))?_.includes(P,I):I===P}function prettyprint_mod(){prettyPrint.apply(this,arguments),$(".prettyprint").each(function(){$(this).parents().filter(".reply").addClass("prettyprint-container")}),$(".replies table tbody tr").each(function(){$(this).css({display:"block"})}),$(".prettyprint:not(.inline-pp)").next("br").each(function(){$(this).css({display:"none"})})}(function(I){function P(N,R){if(N.fireEvent)N.fireEvent("on"+R);else{var H=document.createEvent("Events");H.initEvent(R,!0,!1),N.dispatchEvent(H)}}I.fn.drags=function(N){if(N=I.extend({handle:"",cursor:"move"},N),""===N.handle)var R=this;else var R=this.find(N.handle);return R.css("cursor",N.cursor).on("mousedown",function(H){if(""===N.handle)var G=I(this).addClass("draggable");else var G=I(this).addClass("active-handle").parent().addClass("draggable");var q=G.css("z-index"),U=G.outerHeight(),W=G.outerWidth(),z=G.offset().top+U-H.pageY,V=G.offset().left+W-H.pageX;G.css("z-index",1e3).parents().on("mousemove",function(K){I(".draggable").offset({top:K.pageY+z-U,left:K.pageX+V-W}).on("mouseup",function(){I(this).removeClass("draggable").css("z-index",q)})}),H.preventDefault()}).on("mouseup",function(){""===N.handle?I(this).removeClass("draggable"):I(this).removeClass("active-handle").parent().removeClass("draggable")})},I.fn.dragsOff=function(N){if(N=I.extend({handle:"",cursor:"default"},N),""===N.handle){var R=this;I(this).removeClass("draggable")}else{var R=this.find(N.handle);I(this).removeClass("active-handle").parent().removeClass("draggable")}return R.css("cursor","default").off("mousedown").off("mouseup").off("mousemove")},I.fn.pin=function(){if("fixed"!==this.css("position")){var N={top:this.position().top-I(document).scrollTop(),left:this.position().left-I(document).scrollLeft()};this.css({position:"fixed",left:N.left,top:N.top}),this.find(".pinner").removeClass("pinned").addClass("unpinned"),localStorage.pinForm=0}else{var N={top:this.position().top+I(document).scrollTop(),left:this.position().left+I(document).scrollLeft()};this.css({position:"absolute",left:N.left,top:N.top}),this.find(".pinner").removeClass("unpinned").addClass("pinned"),localStorage.pinForm=1}},I.fn.unwrap=function(){I(this).off().removeClass("wrapper").addClass("unwrapping").empty().css({"background-image":"none"});var N=I(this).data("id"),R="",R={youtube:"<iframe style=\"display:none\" class=\"embedded-content\" width=\"368\" height=\"237\" src=\"//www.youtube.com/embed/"+N+"?wmode=transparent\" frameborder=\"0\" allowfullscreen></iframe>",vimeo:"<iframe style=\"display:none\" src=\"//player.vimeo.com/video/"+N+"?badge=0\" width=\"368\" height=\"210\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>",coub:"<iframe src=\"http://coub.com/embed/"+N+"?muted=false&autostart=false&originalSize=false&hideTopBar=false&noSiteButtons=false&startWithHD=false\" allowfullscreen=\"true\" frameborder=\"0\" width=\"368\" height=\"207\"></iframe>"}[I(this).data("site")]||!1;if(!R)return!1;var G=I(this),q=I(R).appendTo(G).load(function(){I(this).show(),G.removeClass("unwrapping")})},I.fn.triggerNative=function(N){return this.each(function(){var R=I(this).get(0);P(R,N)})}})(jQuery);function xsend(I){return"undefined"==typeof I&&(I="postform"),$("#"+I).ajaxSubmit({beforeSubmit:function beforeSubmit(){$("#"+I).addClass("form-sending")},success:function success(P){$("#"+I).removeClass("form-sending");var G=$("<html></html>").append(P);""===G.find("h1").text()?""!==G.find(".big-shit").text()&&("\u0412\u044B \u0437\u0430\u0431\u0430\u043D\u0435\u043D\u044B!"===G.find(".big-shit").text()&&(window.location.href=ku_cgipath+"/banned.php"),popupMessage(G.find(".big-shit").text()),clearfields($(I),!0)):(popupMessage(G.find("h2").text()),clearfields($(I),!0))}}),!1}function clearfields(I,P){"undefined"==typeof P&&(P=!1),P||(I.find("[name=\"message\"]").val(""),I.find("[name=\"captcha\"]").val(""),I.find("[name=\"subject\"]").val(""),I.find("[name=\"imagefile\"]").val(""),I.find("[name=\"name\"]").val(""),I.find("[name=\"embed\"]").val(""),I.find("[name=\"token\"]").val(randomString())),dcxt.enabled||($(".captchawrap").stop(),clearTimeout(rottencaptcha),rotCaptcha())}function resetForm(I){var P=I.querySelectorAll("input[type=text]:not([name=name]), input[type=file], textarea");Array.prototype.forEach.call(P,function(N){return N.value=null})}var injector={inject:function inject(I,P){var N="injector:"+I,R=document.getElementById(N);if(R)return void(R.innerHTML=P);var H=document.head||document.getElementsByTagName("head")[0],G=document.createElement("style");G.type="text/css",G.id=N,G.styleSheet?G.styleSheet.cssText=P:G.appendChild(document.createTextNode(P)),H.appendChild(G)},remove:function remove(I){var P="injector:"+I,N=document.getElementById(P);if(N){var R=document.head||document.getElementsByTagName("head")[0];R&&R.removeChild(document.getElementById(P))}}};function randomString(){for(var I="",P="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",R=10;0<R;--R)I+=P[Math.round(Math.random()*(P.length-1))];return I}var cloud20={init:function init(){$.getJSON(ku_cgipath+"/boards20.json",function(I){cloud20.allboards=I,cloud20.filter("")})},filter:function filter(I){var P=[];"undefined"==typeof this.allboards||(""==I?P=this.allboards:(I=I.toLowerCase(),_.each(this.allboards,function(N){(-1!==N.name.toLowerCase().search(I)||-1!==N.desc.toLowerCase().search(I))&&P.push(N)})),this.display(P))},display:function display(I){var P="",N="";_.each(I,function(R){P+="<a class=\"menu-item\" title=\""+R.desc+"\" href=\""+ku_boardsfolder+R.name+"/\">/"+R.name+"/ - "+R.desc+"</a>",N+="<option value=\""+R.name+"\">/"+R.name+"/ - "+R.desc+"</option>"}),$("#boards20").html(P),$(".boardsel20").append(N)}},countries={A1:"Anonymous Proxy",A2:"Satellite Provider",O1:"Other Country",AD:"Andorra",AE:"United Arab Emirates",AF:"Afghanistan",AG:"Antigua and Barbuda",AI:"Anguilla",AL:"Albania",AM:"Armenia",AO:"Angola",AP:"Asia/Pacific Region",AQ:"Antarctica",AR:"Argentina",AS:"American Samoa",AT:"Austria",AU:"Australia",AW:"Aruba",AX:"Aland Islands",AZ:"Azerbaijan",BA:"Bosnia and Herzegovina",BB:"Barbados",BD:"Bangladesh",BE:"Belgium",BF:"Burkina Faso",BG:"Bulgaria",BH:"Bahrain",BI:"Burundi",BJ:"Benin",BL:"Saint Bartelemey",BM:"Bermuda",BN:"Brunei Darussalam",BO:"Bolivia",BQ:"Bonaire, Saint Eustatius and Saba",BR:"Brazil",BS:"Bahamas",BT:"Bhutan",BV:"Bouvet Island",BW:"Botswana",BY:"Belarus",BZ:"Belize",CA:"Canada",CC:"Cocos (Keeling) Islands",CD:"Congo, The Democratic Republic of the",CF:"Central African Republic",CG:"Congo",CH:"Switzerland",CI:"Cote d'Ivoire",CK:"Cook Islands",CL:"Chile",CM:"Cameroon",CN:"China",CO:"Colombia",CR:"Costa Rica",CU:"Cuba",CV:"Cape Verde",CW:"Curacao",CX:"Christmas Island",CY:"Cyprus",CZ:"Czech Republic",DE:"Germany",DJ:"Djibouti",DK:"Denmark",DM:"Dominica",DO:"Dominican Republic",DZ:"Algeria",EC:"Ecuador",EE:"Estonia",EG:"Egypt",EH:"Western Sahara",ER:"Eritrea",ES:"Spain",ET:"Ethiopia",EU:"Europe",FI:"Finland",FJ:"Fiji",FK:"Falkland Islands (Malvinas)",FM:"Micronesia, Federated States of",FO:"Faroe Islands",FR:"France",GA:"Gabon",GB:"United Kingdom",GD:"Grenada",GE:"Georgia",GF:"French Guiana",GG:"Guernsey",GH:"Ghana",GI:"Gibraltar",GL:"Greenland",GM:"Gambia",GN:"Guinea",GP:"Guadeloupe",GQ:"Equatorial Guinea",GR:"Greece",GS:"South Georgia and the South Sandwich Islands",GT:"Guatemala",GU:"Guam",GW:"Guinea-Bissau",GY:"Guyana",HK:"Hong Kong",HM:"Heard Island and McDonald Islands",HN:"Honduras",HR:"Croatia",HT:"Haiti",HU:"Hungary",ID:"Indonesia",IE:"Ireland",IL:"Israel",IM:"Isle of Man",IN:"India",IO:"British Indian Ocean Territory",IQ:"Iraq",IR:"Iran, Islamic Republic of",IS:"Iceland",IT:"Italy",JE:"Jersey",JM:"Jamaica",JO:"Jordan",JP:"Japan",KE:"Kenya",KG:"Kyrgyzstan",KH:"Cambodia",KI:"Kiribati",KM:"Comoros",KN:"Saint Kitts and Nevis",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KY:"Cayman Islands",KZ:"Kazakhstan",LA:"Lao People's Democratic Republic",LB:"Lebanon",LC:"Saint Lucia",LI:"Liechtenstein",LK:"Sri Lanka",LR:"Liberia",LS:"Lesotho",LT:"Lithuania",LU:"Luxembourg",LV:"Latvia",LY:"Libyan Arab Jamahiriya",MA:"Morocco",MC:"Monaco",MD:"Moldova, Republic of",ME:"Montenegro",MF:"Saint Martin",MG:"Madagascar",MH:"Marshall Islands",MK:"Macedonia",ML:"Mali",MM:"Myanmar",MN:"Mongolia",MO:"Macao",MP:"Northern Mariana Islands",MQ:"Martinique",MR:"Mauritania",MS:"Montserrat",MT:"Malta",MU:"Mauritius",MV:"Maldives",MW:"Malawi",MX:"Mexico",MY:"Malaysia",MZ:"Mozambique",NA:"Namibia",NC:"New Caledonia",NE:"Niger",NF:"Norfolk Island",NG:"Nigeria",NI:"Nicaragua",NL:"Netherlands",NO:"Norway",NP:"Nepal",NR:"Nauru",NU:"Niue",NZ:"New Zealand",OM:"Oman",PA:"Panama",PE:"Peru",PF:"French Polynesia",PG:"Papua New Guinea",PH:"Philippines",PK:"Pakistan",PL:"Poland",PM:"Saint Pierre and Miquelon",PN:"Pitcairn",PR:"Puerto Rico",PS:"Palestinian Territory",PT:"Portugal",PW:"Palau",PY:"Paraguay",QA:"Qatar",RE:"Reunion",RO:"Romania",RS:"Serbia",RU:"Russian Federation",RW:"Rwanda",SA:"Saudi Arabia",SB:"Solomon Islands",SC:"Seychelles",SD:"Sudan",SE:"Sweden",SG:"Singapore",SH:"Saint Helena",SI:"Slovenia",SJ:"Svalbard and Jan Mayen",SK:"Slovakia",SL:"Sierra Leone",SM:"San Marino",SN:"Senegal",SO:"Somalia",SR:"Suriname",SS:"South Sudan",ST:"Sao Tome and Principe",SV:"El Salvador",SX:"Sint Maarten",SY:"Syrian Arab Republic",SZ:"Swaziland",TC:"Turks and Caicos Islands",TD:"Chad",TF:"French Southern Territories",TG:"Togo",TH:"Thailand",TJ:"Tajikistan",TK:"Tokelau",TL:"Timor-Leste",TM:"Turkmenistan",TN:"Tunisia",TO:"Tonga",TR:"Turkey",TT:"Trinidad and Tobago",TV:"Tuvalu",TW:"Taiwan",TZ:"Tanzania, United Republic of",UA:"Ukraine",UG:"Uganda",UM:"United States Minor Outlying Islands",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VA:"Holy See (Vatican City State)",VC:"Saint Vincent and the Grenadines",VE:"Venezuela",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",VN:"Vietnam",VU:"Vanuatu",WF:"Wallis and Futuna",WS:"Samoa",YE:"Yemen",YT:"Mayotte",ZA:"South Africa",ZM:"Zambia",ZW:"Zimbabwe",XX:"OMCK",T1:"Tor"},bnrs={initiated:!1,init:function init(){$.getJSON(ku_boardspath+"/bnrs.json",function(I){var P=[];1<I.length?_.each(I,function(N){N.link!==this_board_dir&&P.push(N)}):P=I,bnrs.data=P,bnrs.initiated=!0,bnrs.display()})},display:function display(){if(this.initiated&&this.data.length){var I=[];"undefined"==typeof this.current?I=this.data:_.each(this.data,function(H){H.path!==bnrs.current&&I.push(H)});var P=randomItem(I);this.current=P.path;var N=-1===P.link.indexOf("http")?ku_boardspath+"/"+P.link:P.link,R="<a class=\"bnrsupdate\" href=\"#\" onclick=\"javascript:bnrs.display();return false;\"></a><a href=\""+N+"\"><img src=\""+ku_boardspath+"/images/bnrs/"+P.path+"\" /></a>";$(".bnr").length?$(".bnr").html(R):$(".logo").before("<div class=\"bnr-wrap\"><div class=\"bnr\">"+R+"</div></div>")}}};function getRandomInt(I,P){return Math.floor(Math.random()*(P-I+1))+I}function randomItem(I){return I[getRandomInt(0,I.length-1)]}!function(I){"use strict";"function"==typeof define&&define.amd?define(["jquery"],I):I("undefined"==typeof jQuery?window.Zepto:jQuery)}(function(I){"use strict";function P(q){var U=q.data;q.isDefaultPrevented()||(q.preventDefault(),I(q.target).ajaxSubmit(U))}function N(q){var U=q.target,W=I(U);if(!W.is("[type=submit],[type=image]")){var z=W.closest("[type=submit]");if(0===z.length)return;U=z[0]}var V=this;if(V.clk=U,"image"==U.type)if(void 0!==q.offsetX)V.clk_x=q.offsetX,V.clk_y=q.offsetY;else if("function"==typeof I.fn.offset){var K=W.offset();V.clk_x=q.pageX-K.left,V.clk_y=q.pageY-K.top}else V.clk_x=q.pageX-U.offsetLeft,V.clk_y=q.pageY-U.offsetTop;setTimeout(function(){V.clk=V.clk_x=V.clk_y=null},100)}function R(){if(I.fn.ajaxSubmit.debug){var q="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(q):window.opera&&window.opera.postError&&window.opera.postError(q)}}var H={};H.fileapi=void 0!==I("<input type='file'/>").get(0).files,H.formdata=void 0!==window.FormData;var G=!!I.fn.prop;I.fn.attr2=function(){if(!G)return this.attr.apply(this,arguments);var q=this.prop.apply(this,arguments);return q&&q.jquery||"string"==typeof q?q:this.attr.apply(this,arguments)},I.fn.ajaxSubmit=function(q){function U(be){var ye,ve,xe=I.param(be,q.traditional).split("&"),ke=xe.length,we=[];for(ye=0;ke>ye;ye++)xe[ye]=xe[ye].replace(/\+/g," "),ve=xe[ye].split("="),we.push([decodeURIComponent(ve[0]),decodeURIComponent(ve[1])]);return we}function z(be){function ye(Ve){var Xe=null;try{Ve.contentWindow&&(Xe=Ve.contentWindow.document)}catch(Ke){R("cannot get iframe.contentWindow document: "+Ke)}if(Xe)return Xe;try{Xe=Ve.contentDocument?Ve.contentDocument:Ve.document}catch(Ke){R("cannot get iframe.contentDocument: "+Ke),Xe=Ve.document}return Xe}function ve(){function Ve(){try{var et=ye(Ae).readyState;R("state = "+et),et&&"uninitialized"==et.toLowerCase()&&setTimeout(Ve,50)}catch(tt){R("Server abort: ",tt," (",tt.name,")"),xe(Pe),De&&clearTimeout(De),De=void 0}}var Xe=Y.attr2("target"),Ke=Y.attr2("action"),Ye=Y.attr("enctype")||Y.attr("encoding")||"multipart/form-data";Ie.setAttribute("target",Ce),(!V||/post/i.test(V))&&Ie.setAttribute("method","POST"),Ke!=Te.url&&Ie.setAttribute("action",Te.url),Te.skipEncodingOverride||V&&!/post/i.test(V)||Y.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),Te.timeout&&(De=setTimeout(function(){Be=!0,xe(Oe)},Te.timeout));var Ze=[];try{if(Te.extraData)for(var Qe in Te.extraData)Te.extraData.hasOwnProperty(Qe)&&Ze.push(I.isPlainObject(Te.extraData[Qe])&&Te.extraData[Qe].hasOwnProperty("name")&&Te.extraData[Qe].hasOwnProperty("value")?I("<input type=\"hidden\" name=\""+Te.extraData[Qe].name+"\">").val(Te.extraData[Qe].value).appendTo(Ie)[0]:I("<input type=\"hidden\" name=\""+Qe+"\">").val(Te.extraData[Qe]).appendTo(Ie)[0]);Te.iframeTarget||_e.appendTo("body"),Ae.attachEvent?Ae.attachEvent("onload",xe):Ae.addEventListener("load",xe,!1),setTimeout(Ve,15);try{Ie.submit()}catch(et){var $e=document.createElement("form").submit;$e.apply(Ie)}}finally{Ie.setAttribute("action",Ke),Ie.setAttribute("enctype",Ye),Xe?Ie.setAttribute("target",Xe):Y.removeAttr("target"),I(Ze).remove()}}function xe(Ve){if(!Me.aborted&&!Ge){if(He=ye(Ae),He||(R("cannot access response document"),Ve=Pe),Ve===Oe&&Me)return Me.abort("timeout"),void je.reject(Me,"timeout");if(Ve==Pe&&Me)return Me.abort("server abort"),void je.reject(Me,"error","server abort");if(He&&He.location.href!=Te.iframeSrc||Be){Ae.detachEvent?Ae.detachEvent("onload",xe):Ae.removeEventListener("load",xe,!1);var Xe,Ke="success";try{if(Be)throw"timeout";var Je="xml"==Te.dataType||He.XMLDocument||I.isXMLDoc(He);if(R("isXml="+Je),!Je&&window.opera&&(null===He.body||!He.body.innerHTML)&&--qe)return R("requeing onLoad callback, DOM not available"),void setTimeout(xe,250);var Ye=He.body?He.body:He.documentElement;Me.responseText=Ye?Ye.innerHTML:null,Me.responseXML=He.XMLDocument?He.XMLDocument:He,Je&&(Te.dataType="xml"),Me.getResponseHeader=function(at){var nt={"content-type":Te.dataType};return nt[at.toLowerCase()]},Ye&&(Me.status=+Ye.getAttribute("status")||Me.status,Me.statusText=Ye.getAttribute("statusText")||Me.statusText);var Ze=(Te.dataType||"").toLowerCase(),Qe=/(json|script|text)/.test(Ze);if(Qe||Te.textarea){var $e=He.getElementsByTagName("textarea")[0];if($e)Me.responseText=$e.value,Me.status=+$e.getAttribute("status")||Me.status,Me.statusText=$e.getAttribute("statusText")||Me.statusText;else if(Qe){var et=He.getElementsByTagName("pre")[0],tt=He.getElementsByTagName("body")[0];et?Me.responseText=et.textContent?et.textContent:et.innerText:tt&&(Me.responseText=tt.textContent?tt.textContent:tt.innerText)}}else"xml"==Ze&&!Me.responseXML&&Me.responseText&&(Me.responseXML=Ue(Me.responseText));try{Fe=ze(Me,Ze,Te)}catch(at){Ke="parsererror",Me.error=Xe=at||Ke}}catch(at){R("error caught: ",at),Ke="error",Me.error=Xe=at||Ke}Me.aborted&&(R("upload aborted"),Ke=null),Me.status&&(Ke=200<=Me.status&&300>Me.status||304===Me.status?"success":"error"),"success"===Ke?(Te.success&&Te.success.call(Te.context,Fe,"success",Me),je.resolve(Me.responseText,"success",Me),Se&&I.event.trigger("ajaxSuccess",[Me,Te])):Ke&&(void 0===Xe&&(Xe=Me.statusText),Te.error&&Te.error.call(Te.context,Me,Ke,Xe),je.reject(Me,"error",Xe),Se&&I.event.trigger("ajaxError",[Me,Te,Xe])),Se&&I.event.trigger("ajaxComplete",[Me,Te]),Se&&! --I.active&&I.event.trigger("ajaxStop"),Te.complete&&Te.complete.call(Te.context,Me,Ke),Ge=!0,Te.timeout&&clearTimeout(De),setTimeout(function(){Te.iframeTarget?_e.attr("src",Te.iframeSrc):_e.remove(),Me.responseXML=null},100)}}}var ke,we,Te,Se,Ce,_e,Ae,Me,Le,Ee,Be,De,Ie=Y[0],je=I.Deferred();if(je.abort=function(Ve){Me.abort(Ve)},be)for(we=0;we<te.length;we++)ke=I(te[we]),G?ke.prop("disabled",!1):ke.removeAttr("disabled");if(Te=I.extend(!0,{},I.ajaxSettings,q),Te.context=Te.context||Te,Ce="jqFormIO"+new Date().getTime(),Te.iframeTarget?(_e=I(Te.iframeTarget),Ee=_e.attr2("name"),Ee?Ce=Ee:_e.attr2("name",Ce)):(_e=I("<iframe name=\""+Ce+"\" src=\""+Te.iframeSrc+"\" />"),_e.css({position:"absolute",top:"-1000px",left:"-1000px"})),Ae=_e[0],Me={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function getAllResponseHeaders(){},getResponseHeader:function getResponseHeader(){},setRequestHeader:function setRequestHeader(){},abort:function abort(Ve){var Xe="timeout"===Ve?"timeout":"aborted";R("aborting upload... "+Xe),this.aborted=1;try{Ae.contentWindow.document.execCommand&&Ae.contentWindow.document.execCommand("Stop")}catch(Ke){}_e.attr("src",Te.iframeSrc),Me.error=Xe,Te.error&&Te.error.call(Te.context,Me,Xe,Ve),Se&&I.event.trigger("ajaxError",[Me,Te,Xe]),Te.complete&&Te.complete.call(Te.context,Me,Xe)}},Se=Te.global,Se&&0==I.active++&&I.event.trigger("ajaxStart"),Se&&I.event.trigger("ajaxSend",[Me,Te]),Te.beforeSend&&!1===Te.beforeSend.call(Te.context,Me,Te))return Te.global&&I.active--,je.reject(),je;if(Me.aborted)return je.reject(),je;Le=Ie.clk,Le&&(Ee=Le.name,Ee&&!Le.disabled&&(Te.extraData=Te.extraData||{},Te.extraData[Ee]=Le.value,"image"==Le.type&&(Te.extraData[Ee+".x"]=Ie.clk_x,Te.extraData[Ee+".y"]=Ie.clk_y)));var Oe=1,Pe=2,Ne=I("meta[name=csrf-token]").attr("content"),Re=I("meta[name=csrf-param]").attr("content");Re&&Ne&&(Te.extraData=Te.extraData||{},Te.extraData[Re]=Ne),Te.forceSync?ve():setTimeout(ve,10);var Fe,He,Ge,qe=50,Ue=I.parseXML||function(Ve,Xe){return window.ActiveXObject?(Xe=new ActiveXObject("Microsoft.XMLDOM"),Xe.async="false",Xe.loadXML(Ve)):Xe=new DOMParser().parseFromString(Ve,"text/xml"),Xe&&Xe.documentElement&&"parsererror"!=Xe.documentElement.nodeName?Xe:null},We=I.parseJSON||function(Ve){return window.eval("("+Ve+")")},ze=function(Ve,Xe,Ke){var Je=Ve.getResponseHeader("content-type")||"",Ye="xml"===Xe||!Xe&&0<=Je.indexOf("xml"),Ze=Ye?Ve.responseXML:Ve.responseText;return Ye&&"parsererror"===Ze.documentElement.nodeName&&I.error&&I.error("parsererror"),Ke&&Ke.dataFilter&&(Ze=Ke.dataFilter(Ze,Xe)),"string"==typeof Ze&&("json"===Xe||!Xe&&0<=Je.indexOf("json")?Ze=We(Ze):("script"==Xe||!Xe&&0<=Je.indexOf("javascript"))&&I.globalEval(Ze)),Ze};return je}if(!this.length)return R("ajaxSubmit: skipping submit process - no element selected"),this;var V,K,J,Y=this;"function"==typeof q?q={success:q}:void 0===q&&(q={}),V=q.type||this.attr2("method"),K=q.url||this.attr2("action"),J="string"==typeof K?I.trim(K):"",J=J||window.location.href||"",J&&(J=(J.match(/^([^#]+)/)||[])[1]),q=I.extend(!0,{url:J,success:I.ajaxSettings.success,type:V||I.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},q);var Z={};if(this.trigger("form-pre-serialize",[this,q,Z]),Z.veto)return R("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(q.beforeSerialize&&!1===q.beforeSerialize(this,q))return R("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var Q=q.traditional;void 0===Q&&(Q=I.ajaxSettings.traditional);var ee,te=[],ae=this.formToArray(q.semantic,te);if(q.data&&(q.extraData=q.data,ee=I.param(q.data,Q)),q.beforeSubmit&&!1===q.beforeSubmit(ae,this,q))return R("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[ae,this,q,Z]),Z.veto)return R("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var ne=I.param(ae,Q);ee&&(ne=ne?ne+"&"+ee:ee),"GET"==q.type.toUpperCase()?(q.url+=(0<=q.url.indexOf("?")?"&":"?")+ne,q.data=null):q.data=ne;var se=[];if(q.resetForm&&se.push(function(){Y.resetForm()}),q.clearForm&&se.push(function(){Y.clearForm(q.includeHidden)}),!q.dataType&&q.target){var ie=q.success||function(){};se.push(function(be){var ye=q.replaceTarget?"replaceWith":"html";I(q.target)[ye](be).each(ie,arguments)})}else q.success&&se.push(q.success);if(q.success=function(be,ye,ve){for(var xe=q.context||this,ke=0,we=se.length;we>ke;ke++)se[ke].apply(xe,[be,ye,ve||Y,Y])},q.error){var oe=q.error;q.error=function(be,ye,ve){var xe=q.context||this;oe.apply(xe,[be,ye,ve,Y])}}if(q.complete){var le=q.complete;q.complete=function(be,ye){var ve=q.context||this;le.apply(ve,[be,ye,Y])}}var de=I("input[type=file]:enabled",this).filter(function(){return""!==I(this).val()}),ce=0<de.length,pe="multipart/form-data",ue=Y.attr("enctype")==pe||Y.attr("encoding")==pe,me=H.fileapi&&H.formdata;R("fileAPI :"+me);var he;!1!==q.iframe&&(q.iframe||(ce||ue)&&!me)?q.closeKeepAlive?I.get(q.closeKeepAlive,function(){he=z(ae)}):he=z(ae):he=(ce||ue)&&me?function(be){for(var ye=new FormData,ve=0;ve<be.length;ve++)ye.append(be[ve].name,be[ve].value);if(q.extraData){var xe=U(q.extraData);for(ve=0;ve<xe.length;ve++)xe[ve]&&ye.append(xe[ve][0],xe[ve][1])}q.data=null;var ke=I.extend(!0,{},I.ajaxSettings,q,{contentType:!1,processData:!1,cache:!1,type:V||"POST"});q.uploadProgress&&(ke.xhr=function(){var Te=I.ajaxSettings.xhr();return Te.upload&&Te.upload.addEventListener("progress",function(Se){var Ce=0,_e=Se.loaded||Se.position,Ae=Se.total;Se.lengthComputable&&(Ce=Math.ceil(100*(_e/Ae))),q.uploadProgress(Se,_e,Ae,Ce)},!1),Te}),ke.data=null;var we=ke.beforeSend;return ke.beforeSend=function(Te,Se){Se.data=q.formData?q.formData:ye,we&&we.call(this,Te,Se)},I.ajax(ke)}(ae):I.ajax(q),Y.removeData("jqxhr").data("jqxhr",he);for(var ge=0;ge<te.length;ge++)te[ge]=null;return this.trigger("form-submit-notify",[this,q]),this},I.fn.ajaxForm=function(q){if(q=q||{},q.delegation=q.delegation&&I.isFunction(I.fn.on),!q.delegation&&0===this.length){var U={s:this.selector,c:this.context};return!I.isReady&&U.s?(R("DOM not ready, queuing ajaxForm"),I(function(){I(U.s,U.c).ajaxForm(q)}),this):(R("terminating; zero elements found by selector"+(I.isReady?"":" (DOM not ready)")),this)}return q.delegation?(I(document).off("submit.form-plugin",this.selector,P).off("click.form-plugin",this.selector,N).on("submit.form-plugin",this.selector,q,P).on("click.form-plugin",this.selector,q,N),this):this.ajaxFormUnbind().bind("submit.form-plugin",q,P).bind("click.form-plugin",q,N)},I.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},I.fn.formToArray=function(q,U){var W=[];if(0===this.length)return W;var z,V=this[0],K=this.attr("id"),J=q?V.getElementsByTagName("*"):V.elements;if(J&&!/MSIE [678]/.test(navigator.userAgent)&&(J=I(J).get()),K&&(z=I(":input[form=\""+K+"\"]").get(),z.length&&(J=(J||[]).concat(z))),!J||!J.length)return W;var Y,Z,Q,ee,te,ae,ne;for(Y=0,ae=J.length;ae>Y;Y++)if(te=J[Y],Q=te.name,Q&&!te.disabled)if(q&&V.clk&&"image"==te.type)V.clk==te&&(W.push({name:Q,value:I(te).val(),type:te.type}),W.push({name:Q+".x",value:V.clk_x},{name:Q+".y",value:V.clk_y}));else if(ee=I.fieldValue(te,!0),ee&&ee.constructor==Array)for(U&&U.push(te),Z=0,ne=ee.length;ne>Z;Z++)W.push({name:Q,value:ee[Z]});else if(H.fileapi&&"file"==te.type){U&&U.push(te);var se=te.files;if(se.length)for(Z=0;Z<se.length;Z++)W.push({name:Q,value:se[Z],type:te.type});else W.push({name:Q,value:"",type:te.type})}else null!==ee&&"undefined"!=typeof ee&&(U&&U.push(te),W.push({name:Q,value:ee,type:te.type,required:te.required}));if(!q&&V.clk){var ie=I(V.clk),oe=ie[0];Q=oe.name,Q&&!oe.disabled&&"image"==oe.type&&(W.push({name:Q,value:ie.val()}),W.push({name:Q+".x",value:V.clk_x},{name:Q+".y",value:V.clk_y}))}return W},I.fn.formSerialize=function(q){return I.param(this.formToArray(q))},I.fn.fieldSerialize=function(q){var U=[];return this.each(function(){var W=this.name;if(W){var z=I.fieldValue(this,q);if(z&&z.constructor==Array)for(var V=0,K=z.length;K>V;V++)U.push({name:W,value:z[V]});else null!==z&&"undefined"!=typeof z&&U.push({name:this.name,value:z})}}),I.param(U)},I.fn.fieldValue=function(q){for(var U=[],W=0,z=this.length;z>W;W++){var V=this[W],K=I.fieldValue(V,q);null!==K&&"undefined"!=typeof K&&(K.constructor!=Array||K.length)&&(K.constructor==Array?I.merge(U,K):U.push(K))}return U},I.fieldValue=function(q,U){var W=q.name,z=q.type,V=q.tagName.toLowerCase();if(void 0===U&&(U=!0),U&&(!W||q.disabled||"reset"==z||"button"==z||("checkbox"==z||"radio"==z)&&!q.checked||("submit"==z||"image"==z)&&q.form&&q.form.clk!=q||"select"==V&&-1==q.selectedIndex))return null;if("select"==V){var K=q.selectedIndex;if(0>K)return null;for(var te,J=[],Y=q.options,Z="select-one"==z,Q=Z?K+1:Y.length,ee=Z?K:0;Q>ee;ee++)if(te=Y[ee],te.selected){var ae=te.value;if(ae||(ae=te.attributes&&te.attributes.value&&!te.attributes.value.specified?te.text:te.value),Z)return ae;J.push(ae)}return J}return I(q).val()},I.fn.clearForm=function(q){return this.each(function(){I("input,select,textarea",this).clearFields(q)})},I.fn.clearFields=I.fn.clearInputs=function(q){var U=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var W=this.type,z=this.tagName.toLowerCase();U.test(W)||"textarea"==z?this.value="":"checkbox"==W||"radio"==W?this.checked=!1:"select"==z?this.selectedIndex=-1:"file"==W?/MSIE/.test(navigator.userAgent)?I(this).replaceWith(I(this).clone(!0)):I(this).val(""):q&&(!0===q&&/hidden/.test(W)||"string"==typeof q&&I(this).is(q))&&(this.value="")})},I.fn.resetForm=function(){return this.each(function(){"function"!=typeof this.reset&&("object"!=_typeof(this.reset)||this.reset.nodeType)||this.reset()})},I.fn.enable=function(q){return void 0===q&&(q=!0),this.each(function(){this.disabled=!q})},I.fn.selected=function(q){return void 0===q&&(q=!0),this.each(function(){var U=this.type;if("checkbox"==U||"radio"==U)this.checked=q;else if("option"==this.tagName.toLowerCase()){var W=I(this).parent("select");q&&W[0]&&"select-one"==W[0].type&&W.find("option").selected(!1),this.selected=q}})},I.fn.ajaxSubmit.debug=!1});var ffdata={pos:["top","left"],save:function save(){var I={};_.each(ffdata.pos,function(N){I[N]=$("#postclone").css(N)});var P=new Date().getTime();return I.savedon=P,ffdata.savedOn=P,$("#postform [name=ffdata_savedon]").val(P),localStorage.setItem("ffdata_"+this_board_dir+"_"+(ispage?"page":$("#postform [name=replythread]").val()),JSON.stringify(I)),!0},savedOn:!1,unload:function unload(){$("#postform [name=ffdata_savedon]").val(ffdata.savedOn||new Date().getTime())},load:function load(){var I="ffdata_"+this_board_dir+"_"+(ispage?"page":$("#postform [name=replythread]").val());if(localStorage[I])try{(function(){var P=JSON.parse(localStorage[I]);P.savedon&&P.savedon==$("#postform [name=ffdata_savedon]").val()?(_.each(ffdata.pos,function(N){P.hasOwnProperty(N)&&$("#postclone").css(N,P[N])}),$("#postclone").show()):localStorage.removeItem(I)})()}catch(P){localStorage.removeItem(I),console.log("unable to load form data",P)}}},embedLinks={sites:[{id:"youtube",rx:/(?:youtu(?:\.be|be\.com)\/(?:.*v(?:\/|=)|(?:.*\/)?)([\w'-]+))/},{id:"vimeo",rx:/[\w\W]*vimeo\.com\/(?:.*?)([0-9]+)(?:.*)?/},{id:"coub",rx:/[\w\W]*coub\.com\/view\/([\w\W]*)[\w\W]*/}],process:function process(I){var P=null;return _.each(this.sites,function(N){var R=N.rx.exec(I);null!=R&&(P={site:N.id,code:R[1]})}),P}};window.onbeforeunload=ffdata.unload;var catalog={conf:{sortBy:"bumped",layout:"text",respectStickied:!0,showHidden:!0,expandOnHover:!0},saveConfig:function saveConfig(){localStorage.catalogSettings=JSON.stringify(this.conf)},init:function init(){if(localStorage.catalogSettings)try{var I=JSON.parse(localStorage.catalogSettings);_.each(I,function(U,W){this.conf[W]=U},this)}catch(U){console.error("Invalid catalog config"),localStorage.removeItem("catalogSettings")}_.each([["bumped","bumpOrder"],["replied","lastReply"],["timestamp","creationDate"],["reply_count","replyCount"]],function(U){"<option value=\""+U[0]+"\""+(U[0]==this.conf.sortBy?" selected":"")+">"+_l[U[1]]+"</option>"}.bind(this));var N="<div class=\"button-group\" data-select=\"sortBy\">";_.each([["bumped","bumpOrder","bump","i-20"],["timestamp","creationDate","creation","i-20"],["replied","lastReply","reply","i-16in20"],["reply_count","replyCount","replies","i-20"]],function(U){N+="<div class=\"bg-button"+(U[0]==this.conf.sortBy?" bgb-selected":"")+"\" data-val=\""+U[0]+"\" title=\""+_l.sortBy+" "+_l[U[1]]+"\">      <svg class=\"icon "+U[3]+"\"><use xlink:href=\"#i-"+U[2]+"\"></use></svg></div>"}.bind(this)),N+="</div>";var R="<div class=\"button-group"+("bumped"===this.conf.sortBy?"":" disabled")+"\" data-select=\"respectStickied\" id=\"pinControl\">";_.each([[1,"doStick","pin","i-16in20"],[0,"doNotStick","unpin","i-16in20"]],function(U){R+="<div class=\"bg-button"+(U[0]==this.conf.respectStickied?" bgb-selected":"")+"\" data-val=\""+U[0]+"\" title=\""+_l[U[1]]+"\">      <svg class=\"icon "+U[3]+"\"><use xlink:href=\"#i-"+U[2]+"\"></use></svg></div>"}.bind(this)),R+="</div>";var H="<div class=\"button-group\" data-select=\"showHidden\">";_.each([[0,"hideHidden","hide","i-16in20"],[1,"showHidden","unhide","i-16in20"]],function(U){H+="<div class=\"bg-button"+(U[0]==this.conf.showHidden?" bgb-selected":"")+"\" data-val=\""+U[0]+"\" title=\""+_l[U[1]]+"\">      <svg class=\"icon "+U[3]+"\"><use xlink:href=\"#i-"+U[2]+"\"></use></svg></div>"}.bind(this)),H+="</div>";var G="<div class=\"button-group\" data-select=\"layout\">";_.each([["text","smallPics","grid-small","i-20"],["gallery","largePics","gallery-grid","i-20"]],function(U){G+="<div class=\"bg-button"+(U[0]==this.conf.layout?" bgb-selected":"")+"\" data-val=\""+U[0]+"\" title=\""+_l[U[1]]+"\">      <svg class=\"icon "+U[3]+"\"><use xlink:href=\"#i-"+U[2]+"\"></use></svg></div>"}.bind(this)),G+="</div>";var q="<input name=\"subject\" autocomplete=\"false\" class=\"button-group\" type=\"text\" id=\"cat-search\" placeholder=\""+_l.search+"...\" /><input type=\"text\" name=\"FUCKYOUCHROMEFUCKYOU\" style=\"display:none;\"/>";$("#catalog-controls").html(N+R+q+H+G),this.load(),this.conf.expandOnHover&&$("#catalog-contents").addClass("expand-on-hover-enabled"),$("#catalog-contents").on("click",".namedate-overlay",function(){$(this).toggleClass("date-on name-on")}).on("click",".ce-text .bigThumb",function(U){U.stopPropagation(),U.preventDefault();var W=$(this).parents(".cat-entry");W.toggleClass("thumbExpanded")}).on("click",".bigThumb audio, .bigThumb video",function(U){U.stopPropagation()}).on("animationstart webkitAnimationStart MSAnimationStart oanimationstart",function(U){var W=$(U.target);"embed-image-insert"!=U.originalEvent.animationName||W.hasClass("_inserted_")||this.getEmbedThumb(W)}.bind(this)).on("mousedown",".cat-prv",function(U){U.preventDefault(),PostPreviews._mouseover.bind(this)(U)}).on("click",".cat-prv",function(U){U.stopPropagation(),U.preventDefault()}).on("mouseleave",".cat-prv",function(U){PostPreviews._mouseout.bind(this)(U)}).on("click",".i-hide",function(U){var W=$(U.currentTarget),z=W.parents(".cat-entry"),V=z.data("id"),K=_.findIndex(this.model,{id:V}),J=this.model[K];J.hidden=!J.hidden,J.hidden?(W[0].classList.add("hidden-on"),W.html("<use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-unhide\"></use>"),HiddenThreads.hide(V),z.addClass("thread-hidden")):(W[0].classList.remove("hidden-on"),W.html("<use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-hide\"></use>"),HiddenThreads.unhide(V),z.removeClass("thread-hidden")),this.model[K]=J,delete this.rendered[this.conf.layout][V]}.bind(this)),$(".bg-button").click(function(U){var W=$(U.currentTarget);if(!W.hasClass("bgb-selected")){var z=W.parent(),V=W.data("val"),K=z.data("select");z.find(".bg-button").removeClass("bgb-selected"),W.addClass("bgb-selected"),"sortBy"!==K&&"layout"!==K?V=!!V:"bumped"==V?$("#pinControl").removeClass("disabled"):$("#pinControl").addClass("disabled"),this.conf[K]=V,this.saveConfig(),"showHidden"===K?V?$("#catalog-contents").removeClass("hideHidden"):$("#catalog-contents").addClass("hideHidden"):this.build()}}.bind(this)),$("#refresh_catalog").click(function(U){U.preventDefault(),this.load()}.bind(this)),$("#cat-search").on("input",function(){var U=$(this).val().toLowerCase().replace(/\"/,"\\\"");try{injector.remove("cat-search")}catch(W){}U.length?injector.inject("cat-search","#catalog-contents .cat-entry:not([data-search *= \""+U+"\"]) { display:none; }"):injector.remove("cat-search")}).trigger("input")},load:function load(){this.rendered={text:{},gallery:{}},this.model=null,$.getJSON("catalog.json?v="+new Date().getTime()).done(this.build.bind(this)).fail(function(I){throw I})},fileTypes:{image:["jpg","gif","png","webm"],iconsAvailable:["swf","mp3","ogg","cob","vim","you"],audio:["mp3","ogg"],embed:["cob","vim","you"]},authorities:["","Admin","Mod","?","God"],formatDate:function formatDate(I,P){"undefined"==typeof P&&(P=!1);var N=new Date(1e3*I),R=this.dateLocal.dows.hasOwnProperty(locale)?this.dateLocal.dows[locale][N.getDay()]:this.dateLocal.dows.en[N.getDay()],H=_.padLeft(N.getFullYear()%100,2,0),G=_.padLeft(N.getMonth()+1,2,0),q="ru"===locale?this.dateLocal.mons.ru[N.getMonth()]:N.getMonth()+1,U=_.padLeft(N.getDate(),2,0),W=_.padLeft(N.getHours(),2,0),z=_.padLeft(N.getMinutes(),2,0),V=_.padLeft(N.getSeconds(),2,0);return(P?"ru"===locale?U+"."+G+"."+H+" \u0432 ":G+"/"+U+"/"+H+" @ ":"ru"===locale?R+" "+U+" "+q+"\u2019"+H+" \u0432 ":G+"/"+U+"/"+H+" ("+R+") @ ")+W+":"+z+":"+V},dateLocal:{dows:{ru:["\u041F\u043D\u0434","\u0412\u0442\u0440","\u0421\u0440\u0434","\u0427\u0442\u0432","\u041F\u0442\u043D","\u0421\u0431\u0442","\u0412\u0441\u043A"],en:["Sun","Mon","Tue","Wen","Thu","Fri","Sat"]},mons:{ru:["\u042F\u043D\u0432","\u0424\u0435\u0432","\u041C\u0430\u0440","\u0410\u043F\u0440","\u041C\u0430\u0439","\u0418\u044E\u043D","\u0418\u044E\u043B","\u0410\u0432\u0433","\u0421\u0435\u043D","\u041E\u043A\u0442","\u041D\u043E\u044F","\u0414\u0435\u043A"]}},build:function build(I){if("undefined"==typeof I&&(I=this.model),!!I){if(_.each(I,function(R,H){_.each(["id","reply_count","bumped","replied","reply_count","timestamp","page","locked","stickied","deleted_timestamp"],function(G){R[G]=~~R[G]}),I[H]=R}),"bumped"===this.conf.sortBy&&this.conf.respectStickied)this.model=_.sortByOrder(I,["stickied","bumped"],["desc","desc"]);else{var P=[this.conf.sortBy];"bumped"!==this.conf.sortBy&&P.push("bumped"),this.model=_.sortByOrder(I,P,_.repeat("desc",P.length))}var N="";_.each(this.model,function(R){N+=this.buildEntry(R)},this),$("#catalog-contents").html(N)}},getEmbedThumb:function getEmbedThumb(I){var P=I.data("site"),N=I.data("id"),H=I.parents(".cat-entry"),G=H.data("id");"cob"==P&&$.get(ku_boardspath+"/corpsy.php?code="+N,function(q){I.replaceWith("<img src=\""+q.thumbnail_url+"\">"),this.rendered[this.conf.layout][G]=H[0].outerHTML}.bind(this)),"vim"==P&&$.get("http://vimeo.com/api/v2/video/"+N+".json",function(q){I.replaceWith("<img src=\""+q[0].thumbnail_medium+"\">"),this.rendered[this.conf.layout][G]=H[0].outerHTML}.bind(this))},buildEntry:function buildEntry(I){if(this.rendered[this.conf.layout].hasOwnProperty(I.id))return this.rendered[this.conf.layout][I.id];if(!I.processed){I.url="/"+this_board_dir+"/res/"+I.id+".html";if(!I.file||"removed"===I.file)I.smallThumb="<a href=\""+I.url+"\" class=\"smallThumb\">          <div class=\"nofile-removed ctx\">"+(I.file?"\u0423\u0434\u0430\u043B\u0435\u043D":"No File")+"</div></a>";else{if(_.includes(this.fileTypes.image,I.file_type))I.fileTypeClass="image",I.smallThumb="<a href=\""+I.url+"\" class=\"smallThumb\">            <img src=\"thumb/"+I.file+"c."+("webm"===I.file_type?"jpg":I.file_type)+"\"></a>",I.bigThumb="<img src=\"thumb/"+I.file+"s."+("webm"===I.file_type?"jpg":I.file_type)+"\">";else{var R=_.includes(this.fileTypes.iconsAvailable,I.file_type)?"/inc/filetypes/"+I.file_type+".png":"/inc/filetypes/generic"+(_.includes(this.fileTypes.embed,I.file_type)?"-embed":"")+".png",H=_.includes(this.fileTypes.embed,I.file_type)||_.includes(this.fileTypes.audio,I.file_type);I.smallThumb="<a href=\""+I.url+"\" class=\"smallThumb\">            <img src=\""+R+"\"></a>"}_.includes(this.fileTypes.embed,I.file_type)&&(I.bigThumb="you"==I.file_type?"<img src=\"http://i.ytimg.com/vi/"+I.file+"/mqdefault.jpg\">":"<div class=\"cat-bt-embed\" data-site=\""+I.file_type+"\" data-id=\""+I.file+"\"></div>"),_.includes(this.fileTypes.audio,I.file_type)&&(I.bigThumb="<audio src=\"src/"+I.file+"."+I.file_type+"\" controls></audio>")}I.file&&"removed"!==I.file&&(I.bigThumb="<a target=\"_blank\" href=\""+I.url+"\" class=\"bigThumb\">"+I.bigThumb+"</a>"),I.op="<a target=\"_blank\" title=\""+_l.goToThread+"\" target=\"_blank\" href=\""+I.url+"\" class=\"op-number ctx\">#"+I.id+"</a>",I.preview="<a href=\""+I.url+"#"+I.id+"\" class=\"actor cat-prv\">        <svg class=\"icon\"><use xlink:href=\"#i-eye\"></use></svg>      </a>";var G="<svg class=\"icon\"><use xlink:href=\"#i-reply\"></use></svg>      <span class=\"ctx reply-count\">"+I.reply_count+"</span>";I.last_reply&&(G="<a href=\""+I.url+"#"+I.last_reply+"\" class=\"actor cat-prv\">"+G+"</a>");var q="<div class=\"infolabel\">"+G+"</div>",U="<div class=\"infolabel\">        <svg class=\"icon\"><use xlink:href=\"#i-picture\"></use></svg>        <span class=\"ctx image-count\">"+I.images+"</span>      </div>",W="<div class=\"infolabel il-page\">        <a title=\""+_l.threadOnPage+" "+I.page+"\" target=\"_blank\" href=\"/"+this_board_dir+"/"+(0<I.page?I.page+".html":"")+"#"+I.id+"\" class=\"actor\">          <svg class=\"icon\"><use xlink:href=\"#i-page\"></use></svg>          <span class=\"ctx page-number\">"+I.page+"</span>        </a>      </div>";I.countersCombined=q+U+W,I.posterauthority=+I.posterauthority,I.nameDatePriority="date",("name"==localStorage.cat_nameDatePriority||"date"!=localStorage.cat_nameDatePriority&&(I.name||I.tripcode||I.posterauthority))&&(I.nameDatePriority="name");var z=(I.name?"<span class=\"ctx postername\">"+I.name+"</span>":"")+(I.tripcode?"<span class=\"ctx postertrip\">!"+I.tripcode+"</span>":"")+(I.posterauthority?"<span class=\"ctx admin\">&nbsp;##"+this.authorities[I.posterauthority]+"##</span>":"");I.poster="<div class=\"cat-poster\"><span class=\"ctx\">by&nbsp;</span>"+(z||"<span class=\"ctx c-postername\">"+(this_board_defaultName||_l.anonymous)+"</span>")+"</div>";I.date="<div class=\"ctx cat-date cat-date-long\">"+this.formatDate(I.timestamp)+"</div>",I.dateCompact="<div class=\"ctx cat-date cat-date-short\">"+this.formatDate(I.timestamp,1)+"</div>",I.searchData=_.escape(stripHTML(I.subject+" "+I.message).toLowerCase()),I.message=I.message.replace(/\\"/mg,"\""),I.processed=!0,this.model[_.findIndex(this.model,{id:I.id})]=I}I=this.buildIndicators(I);var K=this.layouts[this.conf.layout].bind(this)(I);return this.rendered[this.conf.layout][I.id]=K,K},buildIndicators:function buildIndicators(I){I.hidden=_.includes((localStorage["hiddenThreads."+this_board_dir]||"").split(","),""+I.id);var P=I.stickied?"<svg class=\"foradmin-act icon i-layer-1 i-pin\"><use xlink:href=\"#i-pin\"></use></svg>":"",N=I.locked?"<svg class=\"foradmin-act icon i-layer-1 i-lock\"><use xlink:href=\"#i-lock\"></use></svg>":"",R=I.deleted_timestamp?"<svg class=\"foradmin-act icon i-layer-1 i-deathmark\"><use xlink:href=\"#i-skull\"></use></svg>":"",H="<svg class=\"actor icon i-layer-1 i-hide"+(I.hidden?" hidden-on":"")+"\"><use xlink:href=\"#i-"+(I.hidden?"unhide":"hide")+"\"></use></svg>";return I.indicatorsCombined="<div class=\"indicators\">"+"<svg class=\"actor icon i-burger foradmin-show\"><use xlink:href=\"#i-burger\"></use></svg>"+"<span class=\"i-layer-1\">"+R+P+N+H+"</span><span class=\"i-layer-2\">"+"<svg class=\"actor icon i-layer-2 i-delete foradmin-show\"><use xlink:href=\"#i-x\"></use></svg>"+"<svg class=\"actor icon i-layer-2 i-dnb foradmin-show\"><use xlink:href=\"#i-and\"></use></svg>"+"<svg class=\"actor icon i-layer-2 i-ban foradmin-show\"><use xlink:href=\"#i-ban\"></use></svg>"+"</span></div>",I},layouts:{text:function text(I){return"<div data-id=\""+I.id+"\" class=\"cat-entry ce-text"+(I.hidden?" thread-hidden":"")+"\" data-search=\""+I.searchData+"\">        <div class=\"cat-card\">          <div class=\"ce-heda\">"+I.smallThumb+"<div class=\"cat-infoline ci-op-link\">"+I.op+I.indicatorsCombined+"</div>            <div class=\"cat-infoline namedate-overlay "+I.nameDatePriority+"-on\">"+I.poster+I.date+"</div>            <div class=\"cat-infoline\">"+I.preview+I.countersCombined+"</div>          </div>          <div class=\"ce-opcontent ctx\">            <h5>"+I.subject+"</h5>"+I.message+"</div>        </div>"+I.bigThumb+"</div>"},gallery:function gallery(I){return"<div data-id=\""+I.id+"\" class=\"cat-entry ce-gallery"+(I.hidden?" thread-hidden":"")+"\" data-search=\""+I.searchData+"\">        <div class=\"cat-card\">"+I.bigThumb+"<div class=\"cat-infoline\">            <div class=\"ci-op-link\">"+I.op+"</div>            <div class=\"counters\">"+I.countersCombined+"</div>          </div>          <div class=\"cat-infoline\">"+I.preview+"<div class=\"namedate-overlay "+I.nameDatePriority+"-on\">"+I.poster+I.dateCompact+"</div>"+I.indicatorsCombined+"</div>          <div class=\"ce-opcontent ctx\">            <h5>"+I.subject+"</h5>"+I.message+"</div>        </div>      </div>"}}};function stripHTML(I){var P=document.implementation.createHTMLDocument("New").body;return P.innerHTML=I,P.textContent||P.innerText||""}function localMod(){delandbanlinks($("*"),1)}var unreadCounter={init:function init(I){I||(I=+document.querySelector("meta[property=\"i0:buildtime\"]").content),this.lastvisits=localStorage.lastvisits?JSON.parse(localStorage.lastvisits)||{}:{};var P=this.lastvisits.hasOwnProperty(boardid)?parseInt(this.lastvisits[boardid]):0;P<I&&(this.lastvisits[boardid]=I,localStorage.setItem("lastvisits",JSON.stringify(this.lastvisits)))},update:function update(){this.lastvisits||this.init(),$.ajax({url:"/newpostscount.php",data:this.lastvisits,dataType:"json",success:function success(I){$(".newposts-counter").remove(),$(".got-updates").removeClass("got-updates"),_.each(I,function(P,N){if(0<+P){var R="<span class=\"newposts-counter\">\xA0("+P+")</span>",H=$(".menu-item[href=\"/"+N+"/\"]");H.length&&(H.append(R),$(".sect-exr[data-toexpand=\""+H.parents(".menu-sect").attr("id").split("ms-")[1]+"\"]").parent().addClass("got-updates")),$(".mobile-nav option[value=\""+N+"\"]").append(R)}})}})}},HTMLoader={loadThread:function loadThread(I,P,N,R){var _this4=this;$.get("?"===P?ku_boardspath+"/postbynumber.php?b="+I+"&p="+R:ku_boardspath+"/"+I+"/res/"+P+".html").then(function(H){var G=$.parseHTML(H);if("?"===P){var U=_.find(G,function(W){return"META"===W.tagName&&"i0:thrno"===W.getAttribute("property")});U&&(P=+U.getAttribute("content"))}var q=_.find($.parseHTML(H),{className:"maintable"});q&&q instanceof Node&&function(){var U=q.querySelectorAll(".postnode"),W=[];U.length&&U.forEach(function(z){var V=+z.querySelector("input[type=checkbox]").value;W.push(V),_this4.cached[I+"_"+V]=z.outerHTML}),"?"!==P&&(_this4.threadMaps[I+"_"+P]=W)}();N()}).fail(function(H){N(H.status||"null")})},getPost:function getPost(I,P,N,R,H){var _this5=this,G=this.cached[I+"_"+N];if(G)return void R(!1,G);if(!H){var q=!1;if(I===this_board_dir){var U=$("a[name="+N+"]");if(U.length){var W=U.parents(".postnode")[0].outerHTML;this.cached[I+"_"+N]=W,q=!0,R(!1,W)}}q||this.loadThread(I,P,function(U){U?R(U):_this5.getPost(I,P,N,R,!0)},N)}else R(null)},getThread:function getThread(I,P,N,R,H,G){var _this6=this,q=!G&&this.threadMaps[I+"_"+P];q?(N&&(q=q.filter(function(U){return U>N[0]&&U<N[1]})),R(!1,q.reduce(function(U,W){return U+_this6.cached[I+"_"+W]},""))):H?R(null):this.loadThread(I,P,function(U){U?R(U):_this6.getThread(I,P,N,R,!0)})},cached:{},threadMaps:{}};
//# sourceMappingURL=kusaba.new.js.map